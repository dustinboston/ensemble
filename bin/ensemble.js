var xo=Object.defineProperty;var bo=(e,t)=>{for(var o in t)xo(e,o,{get:t[o],enumerable:!0})};import*as fo from"qjs:os";import*as pe from"qjs:std";var E={};bo(E,{AtomNode:()=>Ee,BooleanNode:()=>Te,DomNode:()=>Ve,ErrorNode:()=>Ne,FunctionNode:()=>De,KeywordNode:()=>Fe,ListNode:()=>me,MapNode:()=>Le,NilNode:()=>Ie,NumberNode:()=>ee,StringNode:()=>de,SymbolNode:()=>ye,VectorNode:()=>fe,append:()=>ko,assertArgumentCount:()=>n,assertAstNode:()=>N,assertAtomNode:()=>W,assertBooleanNode:()=>wo,assertDefined:()=>Pe,assertDomNode:()=>So,assertEq:()=>Mo,assertEqual:()=>ft,assertErrorNode:()=>ke,assertEvenArgumentCount:()=>ve,assertFunctionNode:()=>L,assertGreaterThanEqual:()=>Lo,assertIsOneOf:()=>Do,assertKeywordNode:()=>Co,assertListNode:()=>G,assertMapKeyNode:()=>$,assertMapNode:()=>B,assertMetadataType:()=>Ge,assertMinimumArgumentCount:()=>D,assertNilNode:()=>Ze,assertNullOrUndefined:()=>To,assertNumberNode:()=>u,assertRegExp:()=>ne,assertSequential:()=>H,assertSequentialValues:()=>X,assertStringNode:()=>y,assertSymWithValue:()=>ce,assertSymbol:()=>et,assertSymbolNode:()=>K,assertTrue:()=>Vo,assertUndefined:()=>Eo,assertVariableArgumentCount:()=>A,assertVectorNode:()=>h,continueResult:()=>Se,convertMapKeyToString:()=>Z,convertStringToMapKey:()=>tt,copy:()=>O,copyAtomNode:()=>At,copyBooleanNode:()=>vt,copyDomNode:()=>xt,copyErrorNode:()=>bt,copyFunctionNode:()=>gt,copyKeywordNode:()=>St,copyListNode:()=>wt,copyMapNode:()=>ht,copyNilNode:()=>Ct,copyNumberNode:()=>Mt,copyStringNode:()=>Et,copySymbolNode:()=>Tt,copyVectorNode:()=>Vt,createAtomNode:()=>re,createBooleanNode:()=>c,createDomNode:()=>Ae,createErrorNode:()=>k,createFunctionNode:()=>R,createKeywordNode:()=>le,createListNode:()=>b,createMapNode:()=>T,createNilNode:()=>f,createNumberNode:()=>a,createStringNode:()=>d,createSymbolNode:()=>S,createVectorNode:()=>m,deleteMapElement:()=>qe,getBareMapKey:()=>we,getMapElement:()=>Ke,getMapKeys:()=>$e,getMapValues:()=>Ro,hasMapElement:()=>Be,htmlEncode:()=>qo,isAstNode:()=>_,isAstTruthy:()=>Re,isAtomNode:()=>oe,isBooleanNode:()=>J,isDefined:()=>ge,isDomNode:()=>te,isEqualTo:()=>se,isErrorNode:()=>Y,isFunctionNode:()=>U,isKeywordNode:()=>P,isListNode:()=>C,isMapKeyNode:()=>mt,isMapNode:()=>g,isNilNode:()=>M,isNumberNode:()=>v,isSameClass:()=>Nt,isSequentialNode:()=>q,isStringNode:()=>w,isSymbolNode:()=>I,isTypedVector:()=>Fo,isVectorNode:()=>V,listStartsWithSymbol:()=>ze,mapFlat:()=>Qe,normalizeWhitespace:()=>Bo,prepend:()=>Io,returnResult:()=>ie,setMapElement:()=>Ue,slash:()=>je,splitAtFirstDot:()=>Uo,toAst:()=>p,toErrorNode:()=>$o,unwrap:()=>z,unwrapAtomNode:()=>Dt,unwrapBooleanNode:()=>Ft,unwrapDomNode:()=>Ko,unwrapErrorNode:()=>Lt,unwrapFunctionNode:()=>It,unwrapKeywordNode:()=>kt,unwrapListNode:()=>Rt,unwrapMapNode:()=>Oe,unwrapNilNode:()=>Ut,unwrapNumberNode:()=>ae,unwrapStringNode:()=>he,unwrapSymbolNode:()=>qt,unwrapVectorNode:()=>Bt});var Ee=class{constructor(t){this.value=t}},Te=class{constructor(t){this.value=t}},Ve=class{constructor(t,o=new Map,s=[],r){this.value=t;this.attributes=o;this.children=s;this.metadata=r}},go=["Error","AggregateError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],Ne=class e{constructor(t,o,s=f()){this.value=t;o!==void 0&&e.isErrorName(o)&&(this.name=o),s!==void 0&&(this.cause=s)}name=d("Error");cause;static isErrorName(t){let o=t.value;return go.includes(o)}static assertErrorName(t){if(!e.isErrorName(t))throw new TypeError("Error type must be 'Error', 'AggregateError', 'RangeError', 'ReferenceError', 'SyntaxError', 'TypeError', or 'URIError'.")}},De=class{constructor(t,o,s=!1,r){this.value=t;this.closureMeta=o;this.isMacro=s;this.metadata=r}},Fe=class{constructor(t){this._value=t;this._value=t.replaceAll(":","")}get value(){return this._value+":"}set value(t){this._value=t.replaceAll(":","")+":"}get bare(){return this._value}},me=class{constructor(t,o){this.value=t;this.metadata=o}},Le=class{constructor(t=new Map,o){this.value=t;this.metadata=o}},Ie=class{constructor(t=null){this.value=t}},ee=class{constructor(t){this.value=t}},ye=class{constructor(t){this.value=t}},de=class{constructor(t){this.value=t}},fe=class{constructor(t,o){this.value=t;this.metadata=o}};function So(e){if(!te(e))throw new TypeError("Invalid DomNode")}function N(e){if(!_(e))throw new TypeError("Invalid AstNode")}function W(e){if(!oe(e))throw new TypeError("Invalid AtomNode")}function wo(e){if(!J(e))throw new TypeError("Invalid BooleanNode")}function B(e){if(!g(e))throw new TypeError("Invalid MapNode")}function ke(e){if(!Y(e))throw new TypeError("Invalid ErrorNode")}function L(e){if(!U(e))throw new TypeError("Invalid FunctionNode")}function Co(e){if(!P(e))throw new TypeError("Invalid KeywordNode")}function G(e){if(!C(e))throw new TypeError("Invalid ListNode")}function Ze(e){if(!M(e))throw new TypeError("Invalid NilNode")}function u(e){if(!v(e))throw new TypeError("Invalid NumberNode")}function y(e){if(!w(e))throw new TypeError("Invalid StringNode")}function K(e){if(!I(e))throw new TypeError("Invalid SymbolNode")}function h(e){if(!V(e))throw new TypeError("Invalid VectorNode")}function ne(e){if(!(e instanceof RegExp))throw new Error("Expected a RegExp object.")}function et(e){if(typeof e!="symbol")throw new Error("Expected a Symbol object.")}function Ae(e,t,o,s){return new Ve(e,t,o,s)}function re(e){return new Ee(e)}function c(e){return new Te(e)}function T(e,t){return new Le(e,t)}function k(e,t,o){return N(e),new Ne(e,t,o)}function R(e,t,o,s){return new De(e,t,o,s)}function le(e){return new Fe(e)}function b(e,t){return new me(e,t)}function f(e){return new Ie(e)}function a(e){return new ee(e)}function d(e){return new de(e)}function S(e){return new ye(e)}function m(e=[],t){return new fe(e,t)}function te(e){return e instanceof Ve}function _(e){return oe(e)||J(e)||te(e)||Y(e)||U(e)||P(e)||C(e)||g(e)||M(e)||v(e)||w(e)||I(e)||V(e)}function oe(e){return e instanceof Ee}function J(e){return e instanceof Te&&typeof e.value=="boolean"}function g(e){return e instanceof Le&&e.value instanceof Map}function Y(e){return e instanceof Ne&&_(e.value)}function U(e){return e instanceof De&&typeof e.value=="function"}function P(e){return e instanceof Fe&&typeof e.value=="string"&&e.value.endsWith(":")}function C(e){return e instanceof me&&e.value.every(_)}function M(e){return e instanceof Ie&&e.value===null}function v(e){return e instanceof ee&&typeof e.value=="number"}function w(e){return e instanceof de&&typeof e.value=="string"}function I(e){return e instanceof ye&&typeof e.value=="string"}function V(e){return e instanceof fe&&e.value.every(_)}function Nt(e,t){return Object.getPrototypeOf(e)===Object.getPrototypeOf(t)}function Mo(e,t){if(!se(e,t))throw new Error("Values are not equal")}function Pe(e){if(e===void 0)throw new Error("Value is undefined")}function Eo(e){if(e!==void 0)throw new Error("Value is not undefined")}function To(e){if(e!=null)throw new Error("Value is not null or undefined")}function ge(e){return e!==void 0}function Vo(e){if(e===!1)throw new Error("Value is not true")}function Re(e,t=!1){if(J(e))return e.value;let o=e;return oe(o)?_(o.value)?Re(o.value):!!o.value:M(e)?!1:v(e)?t?!!e.value:!0:!!e.value}function q(e){return C(e)||V(e)}function H(e){if(!C(e)&&!V(e))throw new TypeError("Invalid sequential type")}function $(e){if(!(w(e)||I(e)||P(e)))throw new TypeError("Invalid dictionary key")}function mt(e){return w(e)||I(e)||P(e)}function Ge(e){if(!U(e)&&!C(e)&&!V(e)&&!g(e)&&!te(e))throw new TypeError("Invalid metadata type")}function n(e,t,o){if(e!==t){let s=`Wanted ${t} arguments but got ${e}`;throw o&&(s+=` ${o}`),new Error(s)}}function A(e,t,o){if(e<t||e>o)throw new Error("Unexpected number of arguments")}function D(e,t){if(e<t)throw new Error("Unexpected minimum number of arguments")}function ve(e){if(e%2!==0)throw new Error("Uneven number of arguments")}function X(e,t){for(let o of e)if(!(o instanceof t))throw new TypeError("All values must be of the same type")}function Do(e,t){if(!t.some(o=>e instanceof o))throw new TypeError("Invalid type")}function Fo(e,t){return e.value.every(o=>o instanceof t)}function se(e,t){if(q(e)&&q(t)){if(e.value.length!==t.value.length)return c(!1);for(let s=0;s<e.value.length;s++)if(!se(e.value[s],t.value[s]).value)return c(!1);return c(!0)}if(g(e)&&g(t)){if(e.value.size!==t.value.size)return c(!1);for(let[s,r]of e.value){let i=t.value.get(s);if(i===void 0||!se(r,i).value)return c(!1)}return c(!0)}if(!Nt(e,t))return c(!1);let o=e.value===t.value;return c(o)}function ze(e,t){let o=C(e)&&I(e.value[0]);return o&&t!==void 0?e.value[0].value===t:o}function ft(e,t){if(e!==t)throw new Error(`Unexpected value '${e}', wanted ${t}`)}function Lo(e,t){if(e>=t)throw new Error("Unexpected value")}function ce(e,t){ft(e.value,t)}function Se(e,t){return{continue:{ast:e,env:t},return:void 0}}function ie(e){return{continue:void 0,return:e}}var Io=(e,t)=>[t,...e],ko=(e,t)=>[...e,t];function O(e){if(oe(e))return At(e);if(J(e))return vt(e);if(g(e))return ht(e);if(Y(e))return bt(e);if(U(e))return gt(e);if(P(e))return St(e);if(C(e))return wt(e);if(M(e))return Ct(e);if(v(e))return Mt(e);if(w(e))return Et(e);if(I(e))return Tt(e);if(V(e))return Vt(e);if(te(e))return xt(e);throw new Error("Unmatched object")}function At(e){return re(O(e.value))}function vt(e){return c(e.value)}function ht(e){let t=T(new Map(e.value));return t.metadata=O(e.metadata??f()),t}function xt(e){let t=e.value,o=e.attributes,s=e.children,r=Ae(t,new Map(o),s.map(O));return r.metadata=O(e.metadata??f()),r}function bt(e){return k(O(e.value))}function gt(e){let t=R(e.value);if(t.isMacro=e.isMacro,t.metadata=O(e.metadata??f()),e.closureMeta){let o=e.closureMeta;t.closureMeta={ast:O(o.ast),env:o.env,parameters:o.parameters.map(s=>S(s.value))}}return t}function St(e){return le(e.value)}function wt(e){let t=b(e.value.map(o=>O(o)));return t.metadata=O(e.metadata??f()),t}function Ct(e){return f()}function Mt(e){return a(e.value)}function Et(e){return d(e.value)}function Tt(e){return S(e.value)}function Vt(e){let t=m(e.value.map(o=>O(o)));return t.metadata=O(e.metadata??f()),t}function Ue(e,t,o){e.set(Z(t),o)}function qe(e,t){e.delete(Z(t))}function Be(e,t){return e.has(Z(t))}function Ke(e,t){return e.get(Z(t))}function $e(e){let t=[...e.keys()];return b(t.map(o=>tt(o)))}function Z(e){let t=e;if(P(t))return t.value;let o=e;return w(o)?`"${o.value}"`:e.value}function tt(e){return e.endsWith(":")?le(e):e.startsWith('"')?d(e.slice(1,-1)):S(e)}function we(e){let t=mt(e)?e.value:e;return t.startsWith(":")||t.endsWith(":")?t.replaceAll(":",""):t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):t}function Ro(e){let t=[...e.values()];return b(t)}function Qe(e){let t=[];for(let[o,s]of e.entries())t.push(tt(o),s);return t}function Uo(e){let t=e.indexOf(".");return[e.slice(0,t),e.slice(t+1)]}function qo(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&apos;")}function Bo(e){return e.replaceAll(`
`," ").replaceAll(/\s{2,}/g," ")}function je(e){return e.replaceAll("\\","\\\\").replaceAll('"','\\"').replaceAll(`
`,"\\n")}function z(e){if(oe(e))return Dt(e);if(J(e))return Ft(e);if(g(e))return Oe(e);if(Y(e))return Lt(e);if(U(e))return It(e);if(P(e))return kt(e);if(C(e))return Rt(e);if(M(e))return Ut();if(v(e))return ae(e);if(w(e))return he(e);if(I(e))return qt(e);if(V(e))return Bt(e);throw new Error("Could not unwrap object.")}function Dt(e){return z(e.value)}function Ft(e){return e.value}function Ko(e){return e.value}function Lt(e){let t=w(e.value)?e.value.value:String(z(e.value));return new Error(t)}function It(e){return(...t)=>p(z(e.value(...t)))}function kt(e){return e.value}function Rt(e){return e.value.map(z)}function Oe(e){let t={};for(let[o,s]of e.value.entries())t[o]=z(s);return t}function Ut(){return null}function ae(e){return e.value}function he(e){return e.value}function qt(e){return e.value}function Bt(e){return e.value.map(z)}function p(e){if(_(e))return e;switch(typeof e){case"undefined":return f();case"number":return a(e);case"string":return e.startsWith('"')?d(e):e.startsWith(":")?le(e):S(e);case"boolean":return c(e);case"symbol":return d(JSON.stringify(e));case"function":return R((...t)=>{try{return p(e(...t.map(o=>o.value)))}catch(o){return o instanceof Error?k(d(o.message)):k(d(JSON.stringify(o)))}});case"object":{if(e instanceof Error)return k(d(e.message));if(e===null)return f();if(Array.isArray(e)){let s=e.map(r=>p(r));return b(s)}if(e instanceof Map){let s=new Map;for(let[r,i]of e.entries()){let l=String(r),x=p(i);s.set(l,x)}return T(s)}let t=e,o=new Map;for(let[s,r]of Object.entries(t)){let i=String(s),l=p(r);o.set(i,l)}return T(o)}default:{let t=String(e);return k(d(`unknown type ${t}`))}}}function $o(e){return Y(e)?e:_(e)?k(e):e instanceof Error?k(d(e.message)):k(d(String(e)))}var ue=class{value=new Map;outer;binds=[];exprs=[];constructor(t=void 0,o=[],s=[]){this.outer=t,this.binds=o,this.exprs=s;for(let r=0;r<o.length;r++){let i=o[r];if(i.value==="&"){let x=o[r+1];if(x){let F=s.slice(r),ho=Z(x);this.value.set(ho,b(F));break}}let l=Z(i);this.value.set(l,s[r])}}serialize(){let t=T(),o=T();this.outer&&(o=this.outer.serialize());let s=this.value.entries();for(let[r,i]of s)t.value.set(r,i);return t.value.set("__outer__",o),t}set(t,o){let s=Z(t);return this.value.set(s,o),o}findEnv(t){let o=Z(t);if(this.value.has(o))return this;if(ge(this.outer))return this.outer.findEnv(t)}get(t){let o=this.findEnv(t);if(o===void 0)throw new Error(`'${t.value}' not found`);let s=Z(t),r=o.value.get(s);return Pe(r),r}};function j(e,t=!1){if(w(e))return t?`"${je(e.value)}"`:e.value;if(P(e)||J(e)||v(e)||I(e))return String(e.value);let o=e;if(oe(o))return`(atom ${j(o.value)})`;if(Y(e))return j(e.value,t);if(U(e))return"#<fn>";if(q(e)){let s=C(e),r=e.value.map(i=>j(i,t)).join(" ");return s?`(${r})`:`[${r}]`}if(te(e))return xe(e,t);if(g(e))return`{${Qe(e.value).map(r=>j(r,t)).join(" ")}}`;if(M(e))return"nil";throw new Error(`unmatched object ${JSON.stringify(e)}`)}var jo=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]);function xe(e,t=!1){if(te(e)){let s=e.value,r=jo.has(s),i="";if(e.attributes.size>0&&(i=" "+Array.from(e.attributes).map(([x,F])=>x==="style"?Wo(F,t):`${we(x)}="${xe(F,t)}"`).join(" ")),r)return`<${s}${i} />`;let l=[];if(e.children.length>0){let x=[];s==="style"?x=e.children.map(F=>Oo(F,t)):s==="script"?x=e.children.map(F=>Je(F,t)):x=e.children.map(F=>xe(F,t)),l.push(x.join(" "))}return s==="!doctype"?`<!doctype html>
${l.join(" ")}`:`<${s}${i}>${l.join(" ")}</${s}>`}if(w(e))return t?`"${je(e.value)}"`:e.value;if(P(e)||J(e)||v(e)||I(e))return String(e.value);let o=e;if(oe(o))return`(atom ${xe(o.value)})`;if(Y(e))return xe(e.value,t);if(U(e))return"#<fn>";if(q(e)){let s=C(e),r=e.value.map(i=>xe(i,t)).join(" ");return s?`(${r})`:`[${r}]`}if(g(e))return`{${Qe(e.value).map(r=>xe(r,t)).join(" ")}}`;if(M(e))return"nil";throw new Error(`unmatched object ${JSON.stringify(e)}`)}function Je(e,t=!1){if(te(e))return`(const el = document.createElement("${e.value}"); document.body.appendChild(el);)`;if(C(e)){let o=e.value,s=o[0],r=o.slice(1);return`(${s.value}(${r.map(i=>Je(i)).join(", ")}))`}return V(e)?`[${e.value.map(s=>Je(s)).join(",")}]`:U(e)?`(${e.value.toString()})`:w(e)||P(e)||I(e)?`"${e.value}"`:J(e)||v(e)?String(e.value):g(e)?`{${Object.entries(e.value).map(([s,r])=>{let i=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(s)?s:`"${s}"`,l=Je(r,t);return`${i}: ${l}`}).join(", ")}}`:M(e)?"null":"/* javascript */"}function Ce(e,t=!1){if(w(e))return t?je(e.value):e.value;if(P(e))return e.value.slice(1);if(v(e))return String(e.value);if(I(e))return e.value;if(Y(e))return Ce(e.value,t);if(C(e)||V(e))return e.value.map(o=>Ce(o,t)).join(" ");if(g(e))return[...e.value].map(([o,s])=>{let r=we(o);return M(s)?r:g(s)?`${r} {${Ce(s,t)}}`:`${we(o)}: ${Ce(s,t)};`}).join(" ");if(J(e)||oe(e)||U(e)||te(e)||M(e))return"";throw new Error("unmatched object")}function Oo(e,t=!1){return Ce(e,t)}function Wo(e,t=!1){return g(e)?_o(e,t):"{}"}function _o(e,t=!1){return[...e.value].map(([o,s])=>`${we(o)}: ${Ce(s,t)};`).join("")}var Po=/[\s,]*(~@|[[\]{}()'`~^@]|"(?:\\.|[^\\"])*"?|;.*|\/\/.*|[^\s[\]{}('"`,;)]*)/g,Go=/^-?\d+(\.\d+)?$/,zo=/"(?:\\.|[^\\"])*"/,nt=class{constructor(t,o=0){this.tokens=t;this.pos=o}next=()=>this.tokens[this.pos++];peek=()=>this.tokens[this.pos]};function Qo(e){return[...e.matchAll(Po)].filter(o=>!o[1].startsWith(";")&&!o[1].startsWith("//")&&o[1]!=="").map(o=>o[1])}function He(e){let t=Qo(e);return t.length===0?f():Ye(new nt(t))}function Ye(e){let t=e.peek();if(t===void 0)throw new Error("EOF");function o(s,r){return b([S(s),Ye(e),...r?[r]:[]])}switch(t){case"'":return e.next(),o("quote");case"`":return e.next(),o("quasiquote");case"~":return e.next(),o("unquote");case"~@":return e.next(),o("splice-unquote");case"^":{e.next();let s=Ye(e);return o("with-meta",s)}case"@":return e.next(),o("deref");case")":case"]":case"}":throw new Error(`unexpected '${t}'`);case"(":return st(e,")");case"[":return st(e,"]");case"{":return st(e,"}");default:return Jo(e)}}function Jo(e){let t=e.next();if(t===void 0)throw new Error("unexpected EOF");if(t==="nil")return f();if(t==="false")return c(!1);if(t==="true")return c(!0);if(Go.test(t))return a(Number.parseFloat(t));if(zo.test(t))return d(Yo(t));if(t.startsWith(":")||t.endsWith(":"))return le(t);if(t.startsWith('"'))throw new Error(`expected '"', got EOF`);return S(t)}function Yo(e){return e.slice(1,-1).replaceAll(/\\(.)/g,(t,o)=>o==="n"?`
`:o)}function st(e,t){let o=[];for(e.next();;){let s=e.peek();if(s===void 0)throw new Error(`expected '${t}', got EOF`);if(s===t){e.next();break}o.push(Ye(e))}switch(t){case")":return b(o);case"]":return m(o);case"}":{let s=T();for(let r=0;r<o.length;r+=2){let i=o[r];$(i);let l=o[r+1],x=Z(i);s.value.set(x,l)}return s}default:throw new Error("unknown end value")}}var ut=new Map,Ho=[["=",pt],["throw",Ms],["nil?",Is],["true?",ks],["false?",Rs],["symbol",$t],["Symbol.new",$t],["symbol?",qs],["keyword",Bs],["keyword?",Ks],["number?",$s],["macro?",js],["pr-str",it],["str",at],["prn",Xo],["println",Kt],["console.log",Kt],["read-string",Zo],["string?",Us],["trim",es],["<",ts],["<=",os],[">",ss],[">=",ns],["+",rs],["-",us],["*",ps],["/",is],["time-ms",as],["assoc",Ps],["contains?",Qs],["dissoc",Gs],["get",zs],["hash-map",jt],["keys",Js],["map?",_s],["vals",Ys],["list",ys],["list?",ds],["apply",Es],["fn?",yt],["concat",cs],["conj",Vs],["cons",ls],["count",xs],["empty?",hs],["first",fs],["last",As],["join",Xs],["map",Ts],["nth",ms],["rest",vs],["seq",Ds],["sequential?",Hs],["vec",Ns],["vector",Os],["vector?",Ws],["meta",Fs],["with-meta",Ls],["atom",bs],["atom?",gs],["deref",Ss],["reset!",ws],["swap!",Cs]];for(let[e,t]of Ho)ut.set(S(e),R(t));function pt(...e){return n(e.length,2),se(e[0],e[1])}function it(...e){let t=e.map(o=>j(o,!0)).join(" ");return d(t)}function at(...e){let t=e.map(o=>j(o,!1)).join("");return d(t)}function Xo(...e){let t=e.map(o=>j(o,!0)).join(" ");return console.log(t),f()}function Kt(...e){let t=e.map(o=>j(o,!1)).join(" ");return console.log(t),f()}function Zo(...e){n(e.length,1);let t=e[0];return y(t),He(t.value)}function es(...e){n(e.length,1);let t=e[0];return y(t),d(t.value.trim())}function ts(...e){n(e.length,2,`
args: ${JSON.stringify(e,null,"  ")}`);let t=e[0];u(t);let o=e[1];return u(o),c(t.value<o.value)}function os(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),c(t.value<=o.value)}function ss(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),c(t.value>o.value)}function ns(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),c(t.value>=o.value)}function rs(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),a(t.value+o.value)}function us(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),a(t.value-o.value)}function ps(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),a(t.value*o.value)}function is(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),a(t.value/o.value)}function as(...e){return n(e.length,0),a(new Date().getTime())}function ys(...e){for(let t of e)N(t);return b(e)}function ds(...e){return n(e.length,1),c(C(e[0]))}function ls(...e){return n(e.length,2),H(e[1]),new me([e[0],...e[1].value])}function cs(...e){let t=[];for(let o of e)H(o),t.push(...o.value);return b(t)}function Ns(...e){return C(e[0])?m(e[0].value):e[0]}function ms(...e){if(n(e.length,2),q(e[0])&&v(e[1])){let t=e[1].value,o=e[0],s=e[0].value.length;if(s>0&&t<s)return o.value[t]}throw new Error("out of range")}function fs(...e){return n(e.length,1),q(e[0])&&e[0].value.length>0?e[0].value[0]:f()}function As(...e){return n(e.length,1),q(e[0])&&e[0].value.length>0?e[0].value[e[0].value.length-1]:f()}function vs(...e){return n(e.length,1),q(e[0])?b(e[0].value.slice(1)):b([])}function hs(...e){n(e.length,1);let t=e[0];return H(t),c(t.value.length===0)}function xs(...e){n(e.length,1);let t=e[0];if(M(t))return a(0);if(g(e[0]))return a(e[0].value.size);if(q(e[0]))return a(e[0].value.length);throw new TypeError("Invalid argument type")}function bs(...e){n(e.length,1);let t=e[0];return re(t)}function gs(...e){n(e.length,1);let t=e[0];return c(oe(t))}function Ss(...e){n(e.length,1);let t=e[0];return W(t),t.value}function ws(...e){n(e.length,2);let t=e[0],o=e[1];return W(t),t.value=o,o}function Cs(...e){D(e.length,2);let t=e[0];W(t);let o=e[1];L(o);let s=e.slice(2);return t.value=o.value(t.value,...s),t.value}function Ms(...e){throw n(e.length,1),N(e[0]),k(e[0])}function Es(...e){let t=e.length;D(t,2),L(e[0]);let o=e[t-1];return H(o),e[0].value(...e.slice(1,-1),...o.value)}function Ts(...e){let t=e.length;n(t,2),L(e[0]),H(e[1]);let o=e[0],r=e[1].value.map(i=>o.value(i));return b(r)}function Vs(...e){D(e.length,2),H(e[0]);let[t,...o]=e;return C(t)?b([...o.reverse(),...t.value]):m([...e[0].value,...o])}function Ds(...e){n(e.length,1);let t=e[0];return C(t)&&t.value.length>0?t:V(t)&&t.value.length>0?b([...t.value]):w(t)&&t.value.length>0?b(t.value.split("").map(o=>d(o))):f()}function Fs(...e){return n(e.length,1),Ge(e[0]),e[0].metadata??f()}function Ls(...e){n(e.length,2),Ge(e[0]),N(e[1]);let t=O(e[0]);return t.metadata=e[1],t}function Is(...e){return n(e.length,1),c(M(e[0]))}function ks(...e){return n(e.length,1),c(J(e[0])&&e[0].value)}function Rs(...e){return n(e.length,1),c(J(e[0])&&!e[0].value)}function Us(...e){return n(e.length,1),c(w(e[0]))}function $t(...e){return n(e.length,1),y(e[0]),S(e[0].value)}function qs(...e){return n(e.length,1),c(I(e[0]))}function Bs(...e){n(e.length,1),$(e[0]);let t=e[0];if(P(t))return t;let o=e[0];return le(`:${o.value}`)}function Ks(...e){return n(e.length,1),c(P(e[0]))}function $s(...e){return n(e.length,1),c(v(e[0]))}function yt(...e){return n(e.length,1),c(U(e[0])&&!e[0].isMacro)}function js(...e){return n(e.length,1),c(U(e[0])?e[0].isMacro:!1)}function Os(...e){return m(e)}function Ws(...e){return n(e.length,1),c(V(e[0]))}function jt(...e){if(e.length===0)return T();if(e.length===1&&g(e[0]))return T(new Map(e[0].value));ve(e.length);let t=T();for(let o=0;o<e.length;o+=2){let s=e[o];$(s),Ue(t.value,s,e[o+1])}return t}function _s(...e){return n(e.length,1),c(g(e[0]))}function Ps(...e){D(e.length,1),B(e[0]);let t=e.slice(1),o=T(new Map(e[0].value)),s=jt(...t);for(let[r,i]of s.value.entries())o.value.set(r,i);return o}function Gs(...e){D(e.length,1),B(e[0]);let t=T(new Map(e[0].value));for(let o of e.splice(1))$(o),qe(t.value,o);return t}function zs(...e){n(e.length,2);let t=e[0];if(!g(t))return f();let o=e[1];$(o);let s=Ke(t.value,o);return s!==void 0?s:f()}function Qs(...e){n(e.length,2);let t=e[0],o=e[1];return B(t),$(o),c(Be(t.value,o))}function Js(...e){return n(e.length,1),B(e[0]),$e(e[0].value)}function Ys(...e){return n(e.length,1),B(e[0]),b([...e[0].value.values()])}function Hs(...e){return c(q(e[0]))}function Xs(...e){A(e.length,1,2),H(e[0]);let t=w(e[1])?e[1].value:" ",o=e[0].value.map(s=>j(s,!1)).join(t);return d(o)}var Zs=new Set(["!doctype","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","imgmap","input","kbd","label","legend","li","link","main","mark","menu","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","portal","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"]),Xe=new Map;for(let e of Zs)Xe.set(S(e),R(en(e)));function en(e){return(...t)=>tn(S(e),...t)}function tn(...e){D(e.length,1);let t=e[0];K(t);let o=new Map,s=[];return g(e[1])?(e[1].value.forEach((r,i)=>o.set(i,r)),e.slice(2).forEach(r=>s.push(r))):e.slice(1).forEach(r=>s.push(r)),Ae(t.value,o,s)}function on(...e){n(e.length,1),y(e[0]);let t=e[0].value,o=document.querySelector(t);if(o===null)return f();let r=Array.from(o.attributes).reduce((i,l)=>i.set(l.name,d(l.value)),new Map);return Ae(o.tagName,r,[])}Xe.set(S("document.querySelector"),R(on));var zt=[["Array",sn],["Array.from",Wt],["Array.isArray",rn],["Array.of",Wt],["Array.prototype.at",nn],["Array.prototype.concat",un],["Array.prototype.copyWithin",pn],["Array.prototype.entries",an],["Array.prototype.every",yn],["Array.prototype.fill",dn],["Array.prototype.filter",ln],["Array.prototype.find",cn],["Array.prototype.findIndex",Nn],["Array.prototype.findLast",mn],["Array.prototype.findLastIndex",fn],["Array.prototype.flat",An],["Array.prototype.flatMap",vn],["Array.prototype.includes",hn],["Array.prototype.indexOf",xn],["Array.prototype.join",bn],["Array.prototype.keys",gn],["Array.prototype.length",Mn],["Array.prototype.map",Sn],["Array.prototype.pop",wn],["Array.prototype.push",Cn],["Array.prototype.reduce",En],["Array.prototype.reverse",_t],["Array.prototype.shift",Tn],["Array.prototype.slice",Vn],["Array.prototype.some",Dn],["Array.prototype.sort",Pt],["Array.prototype.splice",Gt],["Array.prototype.toReversed",_t],["Array.prototype.toSorted",Pt],["Array.prototype.toSpliced",Gt],["Array.prototype.unshift",Fn],["Array.prototype.values",Ln],["Array.prototype.with",In],["Array.toString",it]];function sn(...e){if(D(e.length,1),e.length===1&&v(e[0])){let t=Array(e[0].value).fill(f());return m(t)}return m(e)}function Wt(...e){A(e.length,1,3),h(e[0]),e.length>=2&&L(e[1]),e.length===3&&N(e[2]);let t=Array.from(e[0].value,e[1]?.value,e[2]?.value);return m(t)}function nn(...e){n(e.length,2),h(e[0]),u(e[1]);let t=e[0].value,o=e[1].value,s=t.at(o);return s?p(s):f()}function rn(...e){n(e.length,1),N(e[0]);let t=V(e[0]);return c(t)}function un(...e){D(e.length,1),X(e,fe);let t=e[0].value.concat(...e.slice(1).map(o=>o.value));return m(t)}function pn(...e){A(e.length,1,4),h(e[0]),u(e[1]),u(e[2]);let t=e[0].value,o=e[1].value,s=e[2].value,r=v(e[3])?e[3].value:void 0,i=t.copyWithin(o,s,r);return m(i)}function an(...e){n(e.length,1),h(e[0]);let t=e[0].value.map((o,s)=>{let r=a(s);return m([r,o])});return m(t)}function yn(...e){n(e.length,2),h(e[0]),L(e[1]);let t=e[0].value,o=e[1].value,s=t.every((r,i,l)=>o(a(i),r,m(l)).value);return c(s)}function dn(...e){A(e.length,2,4),h(e[0]),N(e[1]);let t=e[0].value.map(z),o=e[1].value,s;e.length>=3&&(u(e[2]),s=e[2].value);let r;e.length===4&&(u(e[3]),r=e[3].value);let i=t.fill(o,s,r);return m(i.map(p))}function ln(...e){n(e.length,2),L(e[0]),h(e[1]);let t=e[0],s=e[1].value.filter(r=>!!t.value(r).value);return m(s)}function cn(...e){n(e.length,2),h(e[0]),L(e[1]);let t=e[0].value,o=e[1].value;return t.find((r,i,l)=>o(r,a(i),m(l)).value)??f()}function Nn(...e){n(e.length,2),h(e[0]),L(e[1]);let t=e[0].value,o=e[1].value,s=t.findIndex((r,i,l)=>o(r,a(i),m(l)).value);return a(s)}function mn(...e){n(e.length,2),h(e[0]),L(e[1]);let t=e[0].value,o=e[1].value;return t.findLast((r,i,l)=>o(r,a(i),m(l)).value)??f()}function fn(...e){n(e.length,2),h(e[0]),L(e[1]);let t=e[0].value,o=e[1].value,s=t.findLastIndex((r,i,l)=>o(r,a(i),m(l)).value);return a(s)}function An(...e){n(e.length,1),h(e[0]);let t=e[0].value;function o(r){return r.reduce((i,l)=>i.concat(V(l)?o(l.value):l),[])}let s=o(t);return m(s)}function vn(...e){n(e.length,2),h(e[0]),L(e[1]);let t=e[0].value,o=e[1].value;function s(l){return l.reduce((x,F)=>x.concat(V(F)?s(F.value):F),[])}let r=t.map((l,x,F)=>o(l,a(x),m(F))),i=s(r);return m(i)}function hn(...e){n(e.length,2),h(e[0]),N(e[1]);let t=e[0],o=e[1],s=t.value.some(r=>se(r,o).value);return c(s)}function xn(...e){n(e.length,2),h(e[0]),N(e[1]);let t=e[0],o=e[1];for(let[s,r]of t.value.entries())if(se(r,o).value)return a(s);return a(-1)}function bn(...e){A(e.length,1,2),H(e[0]);let t=w(e[1])?e[1].value:" ",o=e[0].value.map(s=>j(s,!1)).join(t);return d(o)}function gn(...e){n(e.length,1),h(e[0]);let o=e[0].value.map((s,r)=>a(r));return m(o)}function Sn(...e){A(e.length,2,3),h(e[0]),L(e[1]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=t.map((i,l,x)=>{let F=o(i,a(l),s);return p(F)});return m(r)}function wn(...e){n(e.length,1),h(e[0]);let t=e[0],o=t.value[t.value.length-1];return p(o)}function Cn(...e){if(D(e.length,2),!e.every(_))throw new TypeError("Invalid arguments.");return h(e[0]),m([...e[0].value,...e.slice(1)])}function Mn(...e){n(e.length,1),h(e[0]);let t=e[0];return a(t.value.length)}function En(...e){n(e.length,3),L(e[0]),h(e[1]);let t=e[0],o=e[1],s=e[2];for(let r of o.value)s=t.value(s,r);return s}function _t(...e){n(e.length,1),h(e[0]);let o=e[0].value.toReversed();return m(o)}function Tn(...e){n(e.length,1),h(e[0]);let o=e[0].value[0];return o||f()}function Vn(...e){A(e.length,1,3),h(e[0]);let t=0;e[1]!==void 0&&(u(e[1]),t=e[1].value);let o=e[0].value.length;return e[2]!==void 0&&(u(e[2]),o=e[2].value),m(e[0].value.slice(t,o))}function Dn(...e){n(e.length,2),h(e[0]),L(e[1]);let t=e[0].value,o=e[1].value,s=t.some((r,i,l)=>o(r,a(i),m(l)).value);return c(s)}function Pt(...e){n(e.length,2),h(e[0]),L(e[1]);let t=e[0].value,o=e[1].value,s=t.toSorted((r,i)=>{let l=o(r,i);return u(l),l.value});return m(s)}function Gt(...e){A(e.length,2,4),h(e[0]),u(e[1]);let t=e[0].value,o=e[1].value;if(e.length<3){let s=t.toSpliced(o);return m(s)}else{u(e[2]);let s=e[2].value,r=e.slice(3),i=t.toSpliced(o,s,...r);return m(i)}}function Fn(...e){n(e.length,2),h(e[1]);let t=[e[0],...e[1].value];return m(t)}function Ln(...e){n(e.length,1),h(e[0]);let o=e[0].value.map(s=>s);return m(o)}function In(...e){n(e.length,3),h(e[0]),u(e[1]),N(e[2]);let t=e[0],o=e[1],s=e[2],r=t.value.with(o.value,s);return m(r)}var Qt=[["Boolean",kn]];function kn(...e){return n(e.length,1),N(e[0]),c(!!e[0].value)}var Jt=[["decodeURI",Rn],["decodeURIComponent",Un],["encodeURI",qn],["encodeURIComponent",Bn]];function Rn(...e){n(e.length,1),y(e[0]);let t=decodeURI(e[0].value);return d(t)}function Un(...e){n(e.length,1),y(e[0]);let t=decodeURIComponent(e[0].value);return d(t)}function qn(...e){n(e.length,1),y(e[0]);let t=encodeURI(e[0].value);return d(t)}function Bn(...e){n(e.length,1),y(e[0]);let t=encodeURIComponent(e[0].value);return d(t)}var Yt=[["Date",Kn],["Date.now",$n],["Date.parse",jn],["Date.UTC",On],["Date.prototype.getDate",Wn],["Date.prototype.getDay",_n],["Date.prototype.getFullYear",Pn],["Date.prototype.getHours",Gn],["Date.prototype.getMilliseconds",zn],["Date.prototype.getMinutes",Qn],["Date.prototype.getMonth",Jn],["Date.prototype.getSeconds",Yn],["Date.prototype.getTime",Hn],["Date.prototype.getTimezoneOffset",Xn],["Date.prototype.getUTCDate",Zn],["Date.prototype.getUTCDay",er],["Date.prototype.getUTCFullYear",tr],["Date.prototype.getUTCHours",or],["Date.prototype.getUTCMilliseconds",sr],["Date.prototype.getUTCMinutes",nr],["Date.prototype.getUTCMonth",rr],["Date.prototype.getUTCSeconds",ur],["Date.prototype.setDate",pr],["Date.prototype.setFullYear",ir],["Date.prototype.setHours",ar],["Date.prototype.setMilliseconds",yr],["Date.prototype.setMinutes",dr],["Date.prototype.setMonth",lr],["Date.prototype.setSeconds",cr],["Date.prototype.setTime",Nr],["Date.prototype.setUTCDate",mr],["Date.prototype.setUTCFullYear",fr],["Date.prototype.setUTCHours",Ar],["Date.prototype.setUTCMilliseconds",vr],["Date.prototype.setUTCMinutes",hr],["Date.prototype.setUTCMonth",xr],["Date.prototype.setUTCSeconds",br],["Date.prototype.toDateString",gr],["Date.prototype.toISOString",Sr],["Date.prototype.toJSON",wr],["Date.prototype.toLocaleDateString",Cr],["Date.prototype.toLocaleString",Mr],["Date.prototype.toLocaleTimeString",Er],["Date.prototype.toString",Tr],["Date.prototype.toTimeString",Vr],["Date.prototype.toUTCString",Dr]];function Kn(...e){let t=e.map(z),o=t.length>0?new Date(...t):new Date;return a(o.getTime())}function $n(...e){return a(Date.now())}function jn(...e){n(e.length,1),y(e[0]);let t=Date.parse(e[0].value);return a(t)}function On(...e){let t=e.map(z),o=Date.UTC(...t);return Number.isNaN(o)?f():a(o)}function Wn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getDate())}function _n(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getDay())}function Pn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getFullYear())}function Gn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getHours())}function zn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getMilliseconds())}function Qn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getMinutes())}function Jn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getMonth())}function Yn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getSeconds())}function Hn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getTime())}function Xn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getTimezoneOffset())}function Zn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCDate())}function er(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCDay())}function tr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCFullYear())}function or(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCHours())}function sr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCMilliseconds())}function nr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCMinutes())}function rr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCMonth())}function ur(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCSeconds())}function pr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setDate(e[1].value),a(t.getTime())}function ir(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setFullYear(e[1].value),a(t.getTime())}function ar(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setHours(e[1].value),a(t.getTime())}function yr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setMilliseconds(e[1].value),a(t.getTime())}function dr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setMinutes(e[1].value),a(t.getTime())}function lr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setMonth(e[1].value),a(t.getTime())}function cr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setSeconds(e[1].value),a(t.getTime())}function Nr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setTime(e[1].value),a(t.getTime())}function mr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCDate(e[1].value),a(t.getTime())}function fr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCFullYear(e[1].value),a(t.getTime())}function Ar(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCHours(e[1].value),a(t.getTime())}function vr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCMilliseconds(e[1].value),a(t.getTime())}function hr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCMinutes(e[1].value),a(t.getTime())}function xr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCMonth(e[1].value),a(t.getTime())}function br(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCSeconds(e[1].value),a(t.getTime())}function gr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toDateString())}function Sr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toISOString())}function wr(...e){A(e.length,1,2),u(e[0]),e[1]&&y(e[1]);let t=new Date(e[0].value);return d(t.toJSON())}function Cr(...e){A(e.length,1,3),u(e[0]);let t=new Date(e[0].value),o=e.slice(1).map(z);return d(t.toLocaleDateString(...o))}function Mr(...e){A(e.length,1,3),u(e[0]);let t=new Date(e[0].value),o=e.slice(1).map(z);return d(t.toLocaleString(...o))}function Er(...e){A(e.length,1,3),u(e[0]);let t=new Date(e[0].value),o=e.slice(1).map(z);return d(t.toLocaleTimeString(...o))}function Tr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toString())}function Vr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toTimeString())}function Dr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toUTCString())}var Ht=[["Error",Fr],["Error.prototype.message",Lr],["Error.prototype.cause",Ir],["Error.prototype.name",kr]];function Fr(...e){A(e.length,1,3);let t=e[0];y(t);let o;if(e[1]!==void 0){if(!w(e[1])&&!M(e[1]))throw new TypeError("Second argument must be a string or nil.");w(e[1])&&(Ne.assertErrorName(e[1]),o=e[1])}let s;return e[2]!==void 0&&(N(e[2]),s=e[2]),k(t,o,s)}function Lr(...e){return n(e.length,1),ke(e[0]),e[0].value}function Ir(...e){return n(e.length,1),ke(e[0]),e[0].cause??f()}function kr(...e){return n(e.length,1),ke(e[0]),e[0].name}var Zt=[["Function",Xt],["Function.isFunction",yt],["Function.prototype.apply",Rr],["Function.prototype.bind",qr],["Function.prototype.call",Ur],["js-eval",Xt]];function Xt(...e){n(e.length,1),y(e[0]);try{let t=new Function(`'use strict'; return (${e[0].value})`)();return p(t)}catch(t){return t instanceof Error?k(d(t.message)):k(d(JSON.stringify(t)))}}function Rr(...e){n(e.length,2),L(e[0]),h(e[1]);let t=e[0].value.apply(null,e[1].value);return p(t)}function Ur(...e){D(e.length,1),L(e[0]);let t=e[0].value.call(null,...e.slice(1));return p(t)}function qr(...e){D(e.length,2),L(e[0]),N(e[1]);let t=e[0].value.bind(e[1],...e.slice(2));return p(t)}var eo=[["Map.isMap",Br],["Map.new",to],["Map.prototype.delete",jr],["Map.prototype.entries",Kr],["Map.prototype.get",Or],["Map.prototype.has",Wr],["Map.prototype.keys",_r],["Map.prototype.set",$r],["Map.prototype.size",Gr],["Map.prototype.values",Pr]];function Br(...e){return n(e.length,1),c(g(e[0]))}function to(...e){if(e.length===0)return T();if(e.length===1&&g(e[0]))return T(new Map(e[0].value));ve(e.length);let t=T();for(let o=0;o<e.length;o+=2){let s=e[o];$(s),Ue(t.value,s,e[o+1])}return t}function Kr(...e){n(e.length,1),B(e[0]);let t=e[0].value.entries(),o=m();for(let[s,r]of t){let i=m([p(s),p(r)]);o.value.push(i)}return o}function $r(...e){D(e.length,1),B(e[0]);let t=e.slice(1),o=T(new Map(e[0].value)),s=to(...t);for(let[r,i]of s.value.entries())o.value.set(r,i);return o}function jr(...e){D(e.length,1),B(e[0]);let t=T(new Map(e[0].value));for(let o of e.splice(1))$(o),qe(t.value,o);return t}function Or(...e){n(e.length,2);let t=e[0];if(!g(t))return f();let o=e[1];$(o);let s=Ke(t.value,o);return s!==void 0?s:f()}function Wr(...e){n(e.length,2);let t=e[0],o=e[1];return B(t),$(o),c(Be(t.value,o))}function _r(...e){return n(e.length,1),B(e[0]),$e(e[0].value)}function Pr(...e){return n(e.length,1),B(e[0]),b([...e[0].value.values()])}function Gr(...e){n(e.length,1);let t=e[0];if(M(t))return a(0);if(g(e[0]))return a(e[0].value.size);if(q(e[0]))return a(e[0].value.length);throw new TypeError("Invalid argument type")}var oo=[["Math.abs",zr],["Math.acos",Qr],["Math.acosh",Jr],["Math.asin",Yr],["Math.asinh",Hr],["Math.atan",Xr],["Math.atan2",Zr],["Math.atanh",eu],["Math.cbrt",tu],["Math.ceil",ou],["Math.clz32",su],["Math.cos",nu],["Math.cosh",ru],["Math.exp",uu],["Math.expm1",pu],["Math.floor",iu],["Math.fround",au],["Math.hypot",yu],["Math.imul",du],["Math.log",lu],["Math.log10",cu],["Math.log1p",Nu],["Math.log2",mu],["Math.max",fu],["Math.min",Au],["Math.pow",vu],["Math.random",hu],["Math.round",xu],["Math.sign",bu],["Math.sin",gu],["Math.sinh",Su],["Math.sqrt",wu],["Math.tan",Cu],["Math.tanh",Mu],["Math.trunc",Eu],["Math.E",Tu],["Math.LN10",Vu],["Math.LN2",Du],["Math.LOG10E",Fu],["Math.LOG2E",Lu],["Math.PI",Iu],["Math.SQRT1_2",ku],["Math.SQRT2",Ru]];function zr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.abs(t);return p(o)}function Qr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.acos(t);return p(o)}function Jr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.acosh(t);return p(o)}function Yr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.asin(t);return p(o)}function Hr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.asinh(t);return p(o)}function Xr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.atan(t);return p(o)}function Zr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=e[0].value,o=e[1].value,s=Math.atan2(t,o);return p(s)}function eu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.atanh(t);return p(o)}function tu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.cbrt(t);return p(o)}function ou(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.ceil(t);return p(o)}function su(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.clz32(t);return p(o)}function nu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.cos(t);return p(o)}function ru(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.cosh(t);return p(o)}function uu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.exp(t);return p(o)}function pu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.expm1(t);return p(o)}function iu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.floor(t);return p(o)}function au(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.fround(t);return p(o)}function yu(...e){X(e,ee);let t=e.map(ae),o=Math.hypot(...t);return p(o)}function du(...e){n(e.length,2),u(e[0]),u(e[1]);let t=e[0].value,o=e[1].value,s=Math.imul(t,o);return p(s)}function lu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.log(t);return p(o)}function cu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.log10(t);return p(o)}function Nu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.log1p(t);return p(o)}function mu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.log2(t);return p(o)}function fu(...e){X(e,ee);let t=e.map(ae),o=Math.max(...t);return p(o)}function Au(...e){X(e,ee);let t=e.map(ae),o=Math.min(...t);return p(o)}function vu(...e){if(e.length===2&&v(e[0])&&v(e[1])){let t=e[0].value,o=e[1].value,s=Math.pow(t,o);return p(s)}throw new TypeError('Invalid arguments to "Math.pow"')}function hu(...e){if(e.length===0){let t=Math.random();return p(t)}throw new TypeError('Invalid arguments to "Math.random"')}function xu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.round(t);return p(o)}function bu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.sign(t);return p(o)}function gu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.sin(t);return p(o)}function Su(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.sinh(t);return p(o)}function wu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.sqrt(t);return p(o)}function Cu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.tan(t);return p(o)}function Mu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.tanh(t);return p(o)}function Eu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.trunc(t);return p(o)}function Tu(...e){if(e.length===0)return p(Math.E);throw new TypeError('Invalid arguments to "Math.E"')}function Vu(...e){if(e.length===0)return p(Math.LN10);throw new TypeError('Invalid arguments to "Math.LN10"')}function Du(...e){if(e.length===0)return p(Math.LN2);throw new TypeError('Invalid arguments to "Math.LN2"')}function Fu(...e){if(e.length===0)return p(Math.LOG10E);throw new TypeError('Invalid arguments to "Math.LOG10E"')}function Lu(...e){if(e.length===0)return p(Math.LOG2E);throw new TypeError('Invalid arguments to "Math.LOG2E"')}function Iu(...e){if(e.length===0)return p(Math.PI);throw new TypeError('Invalid arguments to "Math.PI"')}function ku(...e){if(e.length===0)return p(Math.SQRT1_2);throw new TypeError('Invalid arguments to "Math.SQRT1_2"')}function Ru(...e){if(e.length===0)return p(Math.SQRT2);throw new TypeError('Invalid arguments to "Math.SQRT2"')}var so=[["Number",Uu],["Number.isFinite",qu],["Number.isInteger",Bu],["Number.isNaN",Ku],["Number.isSafeInteger",$u],["Number.parseFloat",ju],["Number.parseInt",Ou],["Number.prototype.toExponential",Hu],["Number.prototype.toFixed",Xu],["Number.prototype.toPrecision",Zu],["Number.prototype.toString",ep],["Number.EPSILON",Wu],["Number.MAX_SAFE_INTEGER",_u],["Number.MAX_VALUE",Pu],["Number.MIN_SAFE_INTEGER",Gu],["Number.MIN_VALUE",zu],["Number.NaN",Qu],["Number.NEGATIVE_INFINITY",Ju],["Number.POSITIVE_INFINITY",Yu]];function Uu(...e){if(e.length===1&&_(e[0])){let t=e[0].value,o=Number(t);return p(o)}throw new TypeError('Invalid arguments to "Number"')}function qu(...e){if(e.length===1&&_(e[0])){let t=e[0].value,o=Number.isFinite(t);return p(o)}throw new TypeError('Invalid arguments to "Number.isFinite"')}function Bu(...e){if(e.length===1&&_(e[0])){let t=e[0].value,o=Number.isInteger(t);return p(o)}throw new TypeError('Invalid arguments to "Number.isInteger"')}function Ku(...e){if(e.length===1&&_(e[0])){let t=e[0].value,o=Number.isNaN(t);return p(o)}throw new TypeError('Invalid arguments to "Number.isNaN"')}function $u(...e){if(e.length===1&&_(e[0])){let t=e[0].value,o=Number.isSafeInteger(t);return p(o)}throw new TypeError('Invalid arguments to "Number.isSafeInteger"')}function ju(...e){n(e.length,1),y(e[0]);let t=he(e[0]),o=Number.parseFloat(t);return p(o)}function Ou(...e){A(e.length,1,2),y(e[0]);let t=e[0].value;if(e.length===2){u(e[1]);let s=e[1].value,r=Number.parseInt(t,s);return a(r)}let o=Number.parseInt(t);return a(o)}function Wu(...e){if(e.length===0){let t=Number.EPSILON;return p(t)}throw new TypeError('Invalid arguments to "Number.EPSILON"')}function _u(...e){if(e.length===0){let t=Number.MAX_SAFE_INTEGER;return p(t)}throw new TypeError('Invalid arguments to "Number.MAX_SAFE_INTEGER"')}function Pu(...e){if(e.length===0){let t=Number.MAX_VALUE;return p(t)}throw new TypeError('Invalid arguments to "Number.MAX_VALUE"')}function Gu(...e){if(e.length===0){let t=Number.MIN_SAFE_INTEGER;return p(t)}throw new TypeError('Invalid arguments to "Number.MIN_SAFE_INTEGER"')}function zu(...e){if(e.length===0){let t=Number.MIN_VALUE;return p(t)}throw new TypeError('Invalid arguments to "Number.MIN_VALUE"')}function Qu(...e){if(e.length===0){let t=Number.NaN;return p(t)}throw new TypeError('Invalid arguments to "Number.NaN"')}function Ju(...e){if(e.length===0){let t=Number.NEGATIVE_INFINITY;return p(t)}throw new TypeError('Invalid arguments to "Number.NEGATIVE_INFINITY"')}function Yu(...e){if(e.length===0){let t=Number.POSITIVE_INFINITY;return p(t)}throw new TypeError('Invalid arguments to "Number.POSITIVE_INFINITY"')}function Hu(...e){if(A(e.length,1,2),u(e[0]),e.length===2){u(e[1]);let o=e[1].value,s=e[0].value.toExponential(o);return d(s)}let t=e[0].value.toExponential();return d(t)}function Xu(...e){if(A(e.length,1,2),u(e[0]),e.length===2){u(e[1]);let o=e[1].value,s=e[0].value.toFixed(o);return d(s)}let t=e[0].value.toFixed();return d(t)}function Zu(...e){if(A(e.length,1,2),u(e[0]),e.length===2){u(e[1]);let o=e[1].value,s=e[0].value.toPrecision(o);return d(s)}let t=e[0].value.toPrecision();return d(t)}function ep(...e){if(A(e.length,1,2),u(e[0]),e.length===2){u(e[1]);let o=e[1].value,s=e[0].value.toString(o);return d(s)}let t=e[0].value.toString();return d(t)}var no=[["===",pt],["!==",lp],["??",Ap],["**",vp],["%",sp],[">>",ap],["<<",ip],[">>>",yp],["/&",np],["/|",rp],["/^",up],["/~",pp],["&&",tp],["||",op],["!",dp],["++",cp],["--",Np],["typeof",mp],["instanceof",fp]];function tp(...e){for(let o of e)if(!Re(o,!0))return c(!1);return c(!0)}function op(...e){for(let t of e)if(Re(t))return c(!0);return c(!1)}function sp(e,t){if(v(e)&&v(t))return a((e.value%t.value+t.value)%t.value);throw new TypeError("not a number")}function np(e,t){if(v(e)&&v(t))return a(e.value&t.value);throw new TypeError("not a number")}function rp(e,t){if(v(e)&&v(t))return a(e.value|t.value);throw new TypeError("not a number")}function up(e,t){if(v(e)&&v(t))return a(e.value^t.value);throw new TypeError("not a number")}function pp(e){if(v(e))return a(~e.value);throw new TypeError("not a number")}function ip(e,t){if(v(e)&&v(t))return a(e.value<<t.value);throw new TypeError("not a number")}function ap(e,t){if(v(e)&&v(t))return a(e.value>>t.value);throw new TypeError("not a number")}function yp(e,t){if(v(e)&&v(t))return a(e.value>>>t.value);throw new TypeError("not a number")}function dp(e){return c(!e.value)}function lp(...e){n(e.length,2);let t=se(e[0],e[1]);return c(!t.value)}function cp(...e){A(e.length,1,2),u(e[0]);let t="postfix";if(e[1]!==void 0){if(y(e[1]),e[1].value!=="prefix"&&e[1].value!=="postfix")throw new TypeError(`Invalid affix ${String(e[1].value)}. The affix must be "prefix" or "postfix"`);t=e[1].value}if(t==="postfix")return m([a(e[0].value+1),a(e[0].value)]);if(t==="prefix")return m([a(e[0].value+1),a(e[0].value+1)]);throw new Error("Unhandled error in decrement")}function Np(...e){A(e.length,1,2),u(e[0]);let t="postfix";if(e[1]!==void 0){if(y(e[1]),e[1].value!=="prefix"&&e[1].value!=="postfix")throw new TypeError(`Invalid affix ${String(e[1].value)}. The affix must be "prefix" or "postfix"`);t=e[1].value}if(t==="postfix")return m([a(e[0].value-1),a(e[0].value)]);if(t==="prefix")return m([a(e[0].value-1),a(e[0].value-1)]);throw new Error("Unhandled error in decrement")}function mp(...e){n(e.length,2),N(e[0]),y(e[1]);let t=typeof e[0].value;if(t!=="bigint"&&t!=="boolean"&&t!=="function"&&t!=="number"&&t!=="object"&&t!=="string"&&t!=="symbol"&&t!=="undefined")throw new Error(`Invalid type: "${e[1].value}". Type must be one of bigint, boolean, function, number, object, string, symbol, or undefined`);return c(t===e[1].value)}function fp(...e){n(e.length,2),N(e[0]),y(e[1]);let t=e[0],o=e[1].value,s;if(o==="AstNode"||o==="AtomNode"||o==="BooleanNode"||o==="ErrorNode"||o==="FunctionNode"||o==="KeywordNode"||o==="ListNode"||o==="MapNode"||o==="NilNode"||o==="NumberNode"||o==="StringNode"||o==="SymbolNode"||o==="VectorNode")s=E[e[1].value];else if(Object.hasOwn(globalThis,e[1].value))s=globalThis[e[1].value];else throw new TypeError(`Unknown instance: "${e[1].value}"`);return c(t instanceof s)}function Ap(e,t){return e.value==null?t:e}function vp(e,t){if(v(e)&&v(t))return a(e.value**t.value);throw new TypeError("not a number")}var ro=[["RegExp.new",hp],["RegExp.prototype.exec",xp],["RegExp.prototype.test",bp]];function hp(...e){A(e.length,1,2),y(e[0]);let t=e[0].value;if(e.length===2){y(e[1]);let s=e[1].value,r=new RegExp(t,s);return re(r)}let o=new RegExp(t);return re(o)}function xp(...e){n(e.length,2),W(e[0]);let t=e[0].value;ne(t),y(e[1]);let o=e[1].value,s=t.exec(o);return s?m(s.map(p)):f()}function bp(...e){n(e.length,2),W(e[0]),ne(e[0].value),y(e[1]);let t=e[0].value.test(e[1].value);return c(t)}var io=[["String",at],["String.fromCharCode",gp],["String.fromCodePoint",Sp],["String.prototype.at",uo],["String.prototype.charAt",uo],["String.prototype.charCodeAt",po],["String.prototype.codePointAt",po],["String.prototype.concat",wp],["String.prototype.endsWith",Cp],["String.prototype.includes",Mp],["String.prototype.indexOf",Ep],["String.prototype.isWellFormed",Tp],["String.prototype.lastIndexOf",Vp],["String.prototype.length",Dp],["String.prototype.localeCompare",Fp],["String.prototype.match",Lp],["String.prototype.matchAll",Ip],["String.prototype.normalize",kp],["String.prototype.padEnd",Rp],["String.prototype.padStart",Up],["String.prototype.repeat",qp],["String.prototype.replace",Bp],["String.prototype.replaceAll",Kp],["String.prototype.search",$p],["String.prototype.slice",jp],["String.prototype.split",Op],["String.prototype.startsWith",Wp],["String.prototype.toLocaleLowerCase",_p],["String.prototype.toLocaleUpperCase",Pp],["String.prototype.toLowerCase",Gp],["String.prototype.toUpperCase",zp],["String.prototype.toWellFormed",Qp],["String.prototype.trim",Jp],["String.prototype.trimEnd",Yp],["String.prototype.trimStart",Hp],["String.raw",Xp]];function gp(...e){n(e.length,1),h(e[0]),X(e[0].value,ee);let t=e[0].value.map(ae),o=String.fromCharCode(...t);return d(o)}function Sp(...e){X(e,ee);let t=e.map(ae),o=String.fromCodePoint(...t);return d(o)}function uo(...e){n(e.length,2),y(e[0]),u(e[1]);let t=String.prototype.at.call(e[0].value,e[1].value);return t===void 0?f():d(t)}function po(...e){n(e.length,2),y(e[0]),u(e[1]);let t=String.prototype.codePointAt.call(e[0].value,e[1].value);return t===void 0?f():a(t)}function wp(...e){D(e.length,2),X(e,de);let t=e[0].value,o=e.slice(1).map(he),s=String.prototype.concat.call(t,...o);return d(s)}function Cp(...e){A(e.length,2,3),y(e[0]),y(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.endsWith.call(t,o,s);return p(r)}function Mp(...e){A(e.length,2,3),y(e[0]),y(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.includes.call(t,o,s);return p(r)}function Ep(...e){A(e.length,2,3),y(e[0]),y(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.indexOf.call(t,o,s);return p(r)}function Tp(...e){n(e.length,1),y(e[0]);let t=e[0].value,o=String.prototype.isWellFormed.call(t);return p(o)}function Vp(...e){A(e.length,2,3),y(e[0]),y(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.lastIndexOf.call(t,o,s);return p(r)}function Dp(...e){n(e.length,1),N(e[0]);let o=e[0].value.length;return p(o)}function Fp(...e){A(e.length,2,4),y(e[0]),y(e[1]);let t=e[0].value,o=e[1].value,s,r;if(e.length>2){let l=e[2];w(l)?s=l.value:V(l)?(X(l.value,de),s=l.value.map(he)):(Ze(l),s=void 0)}if(e.length>3){let l=e[3];B(l),r=Oe(l)}let i=String.prototype.localeCompare.call(t,o,s,r);return p(i)}function Lp(...e){n(e.length,2),y(e[0]),W(e[1]),ne(e[1].value);let t=e[0].value,o=e[1].value,s=String.prototype.match.call(t,o);return p(s)}function Ip(...e){n(e.length,2),y(e[0]),W(e[1]),ne(e[1].value);let t=e[0].value,o=e[1].value,s=String.prototype.matchAll.call(t,o);return p(s)}function kp(...e){A(e.length,1,2),N(e[0]),e.length===2&&y(e[1]);let t=e[0].value,o=e.length===2?e[1].value:void 0,s=String.prototype.normalize.call(t,o);return p(s)}function Rp(...e){A(e.length,2,3),N(e[0]),u(e[1]),e.length===3&&y(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.padEnd.call(t,o,s);return p(r)}function Up(...e){A(e.length,2,3),N(e[0]),u(e[1]),e.length===3&&y(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.padStart.call(t,o,s);return p(r)}function qp(...e){n(e.length,2),y(e[0]),u(e[1]);let t=e[0].value,o=e[1].value,s=String.prototype.repeat.call(t,o);return p(s)}function Bp(...e){n(e.length,3),y(e[0]);let t="";w(e[1])||(W(e[1]),ne(e[1].value)),t=e[1].value;let o;if(w(e[2]))o=e[2].value;else throw new Error("Function replacers are not implemented for String.prototype.replace");let r=e[0].value.replace(t,o);return p(r)}function Kp(...e){n(e.length,3),y(e[0]);let t="";w(e[1])||(W(e[1]),ne(e[1].value)),t=e[1].value;let o;if(w(e[2]))o=e[2].value;else throw new Error("Function replacers are not implemented for String.prototype.replaceAll");let r=e[0].value.replaceAll(t,o);return p(r)}function $p(...e){n(e.length,2),y(e[0]),W(e[1]),ne(e[1].value);let t=e[0].value,o=e[1].value,s=String.prototype.search.call(t,o);return p(s)}function jp(...e){A(e.length,1,3),N(e[0]),e.length>1&&u(e[1]),e.length>2&&u(e[2]);let t=e[0].value,o=e.length>1?e[1].value:void 0,s=e.length>2?e[2].value:void 0,r=String.prototype.slice.call(t,o,s);return p(r)}function Op(...e){A(e.length,2,3),y(e[0]),y(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=t.split(o,s);return p(r)}function Wp(...e){A(e.length,2,3),N(e[0]),y(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length>2?e[2].value:void 0,r=String.prototype.startsWith.call(t,o,s);return p(r)}function _p(...e){A(e.length,1,2),N(e[0]),e.length===2&&(M(e[1])||y(e[1]));let t=e[0].value,o=e.length===2&&!M(e[1])?e[1].value:void 0,s=String.prototype.toLocaleLowerCase.call(t,o);return p(s)}function Pp(...e){A(e.length,1,2),N(e[0]),e.length===2&&(M(e[1])||y(e[1]));let t=e[0].value,o=e.length===2&&!M(e[1])?e[1].value:void 0,s=String.prototype.toLocaleUpperCase.call(t,o);return p(s)}function Gp(...e){n(e.length,1),N(e[0]);let t=e[0].value,o=String.prototype.toLowerCase.call(t);return p(o)}function zp(...e){n(e.length,1),N(e[0]);let t=e[0].value,o=String.prototype.toUpperCase.call(t);return p(o)}function Qp(...e){n(e.length,1),N(e[0]);let t=e[0].value,o=String.prototype.toWellFormed.call(t);return p(o)}function Jp(...e){n(e.length,1),N(e[0]);let t=e[0].value,o=String.prototype.trim.call(t);return p(o)}function Yp(...e){n(e.length,1),N(e[0]);let t=e[0].value,o=String.prototype.trimEnd.call(t);return p(o)}function Hp(...e){n(e.length,1),N(e[0]);let t=e[0].value,o=String.prototype.trimStart.call(t);return p(o)}function Xp(...e){n(e.length,2),B(e[0]),h(e[1]);let t=Oe(e[0]),o=e[1].value,s=String.raw(t,...o);return p(s)}var ao=[["Symbol",Zp],["Symbol.for",ei],["Symbol.keyFor",ti]];function Zp(...e){A(e.length,0,1),e.length===1&&y(e[0]);let t=e.length===1?e[0].value:void 0,o=Symbol(t);return re(o)}function ei(...e){n(e.length,1),y(e[0]);let t=e[0].value,o=Symbol.for(t);return re(o)}function ti(...e){n(e.length,1),W(e[0]),et(e[0].value);let t=e[0].value,o=Symbol.keyFor(t);return o?d(o):f()}var oi=[...zt,...Qt,...Jt,...no,...Yt,...Ht,...Zt,...eo,...oo,...so,...ro,...io,...ao],_e=new Map;for(let[e,t]of oi)if(_e.set(S(e),R(t)),e.includes(".prototype.")){let o=e.replace(".prototype.","::");_e.set(S(o),R(t))}else if(e.includes(".prototype[")){let o=e.replace(".prototype[","::[");_e.set(S(o),R(t))}function si(e){G(e),A(e.value.length,2,3);let t=e.value[0];if(K(t),t.value!=="try"&&t.value!=="try*")throw new Error("use `try` or `try*` in try/catch expressions");if(N(e.value[1]),e.value[2]){G(e.value[2]),n(e.value[2].value.length,3),K(e.value[2].value[0]);let o=e.value[2].value[0];if(o.value!=="catch"&&o.value!=="catch*")throw new Error("use `catch` or `catch*` in try/catch expressions");K(e.value[2].value[1]),N(e.value[2].value[2])}}function ni(e){G(e),n(e.value.length,3),K(e.value[0]);let t=e.value[0];if(t.value!=="def!"&&t.value!=="globalThis"&&t.value!=="var")throw new Error("use `def!`, `globalThis`, or `var` in def! expressions");$(e.value[1]),N(e.value[2])}function ri(e){G(e),n(e.value.length,3),K(e.value[0]);let t=e.value[0];if(t.value!=="let*"&&t.value!=="let"&&t.value!=="const")throw new Error("use `let*`, `let`, or `const` in let* expressions");H(e.value[1]),N(e.value[2]),ve(e.value[1].value.length);for(let o=0;o<e.value[1].value.length;o+=2)K(e.value[1].value[o]),N(e.value[1].value[o+1])}function ui(e){G(e),n(e.value.length,2),K(e.value[0]),ce(e.value[0],"quote"),N(e.value[1])}function pi(e){let t="quasiquoteexpand";G(e),n(e.value.length,2),K(e.value[0]),ce(e.value[0],t),N(e.value[1])}function ii(e){let t="quasiquote";G(e),n(e.value.length,2),K(e.value[0]),ce(e.value[0],t),N(e.value[1])}function ai(e){let t="defmacro!";G(e),n(e.value.length,3),K(e.value[0]),ce(e.value[0],t),$(e.value[1]),N(e.value[2])}function yi(e){let t="do";G(e),D(e.value.length,1),K(e.value[0]),ce(e.value[0],t);for(let o of e.value.slice(1))N(o)}function di(e){let t="if";G(e),A(e.value.length,3,4),K(e.value[0]),ce(e.value[0],t),N(e.value[1]),N(e.value[2]),ge(e.value[3])&&N(e.value[3])}function li(e){G(e),n(e.value.length,3),K(e.value[0]);let t=e.value[0];if(!["fn*","function","=>"].includes(t.value))throw new Error("use `fn*`, `function`, of `=>` in fn* expressions");H(e.value[1]),X(e.value[1].value,ye),N(e.value[2])}function ci(e){return He(e)}function lt(e){if(g(e)||I(e))return b([S("quote"),e]);if(!q(e))return e;if(ze(e,"unquote"))return e.value[1];let s=b([]);for(let r=e.value.length-1;r>=0;r--){let i=e.value[r];s=ze(i,"splice-unquote")?b([S("concat"),i.value[1],s]):b([S("cons"),lt(i),s])}return V(e)&&(s=b([S("vec"),s])),s}function Ni(e,t){if(!C(e)||!(e.value[0]instanceof ye))return!1;let o=e.value[0],s=t.findEnv(o);if(!ge(s))return!1;let r=s.get(o);return U(r)?r.isMacro:!1}function lo(e,t){let o=e;for(;Ni(o,t);){let s=o,r=s.value[0];o=t.get(r).value(...s.value.slice(1))}return o}function dt(e,t){if(I(e))return t.get(e);if(V(e)){let o=e.value.map(s=>Q(s,t));return m(o)}if(C(e)){let o=e.value.map(s=>Q(s,t));return b(o)}if(g(e)){let o=new Map;for(let[s,r]of e.value.entries())o.set(s,Q(r,t));return T(o)}if(te(e)){let o=e.value,s=Array.from(e.attributes).reduce((i,[l,x])=>i.set(l,Q(x,t)),new Map),r=e.children.map(i=>Q(i,t));return Ae(o,s,r)}return e}function Q(e,t){for(;;){if(C(e)===!1)return dt(e,t);if(e.value.length===0)return e;if(e=lo(e,t),C(e)===!1)return dt(e,t);if(e.value.length===0)return e;let o=I(e.value[0])?e.value[0].value:"goto_default_clause",s;switch(o){case"var":case"def!":{s=mi(e,t);break}case"let":case"const":case"let*":{s=fi(e,t);break}case"quote":{s=Ai(e,t);break}case"quasiquoteexpand":{s=vi(e,t);break}case"quasiquote":{s=hi(e,t);break}case"defmacro!":{s=xi(e,t);break}case"macroexpand":{s=ie(lo(e.value[1],t));break}case"try":case"try*":{s=gi(e,t);break}case"do":{s=bi(e,t);break}case"if":{s=Si(e,t);break}case"=>":case"function":case"fn*":{s=wi(e,t);break}default:s=Ci(e,t)}if(s.return)return s.return;e=s.continue.ast,t=s.continue.env}}function mi(e,t){ni(e);let o=e.value[1],s=e.value[2],r=Q(s,t);return ie(t.set(o,r))}function fi(e,t){ri(e);let o=e.value[1],s=o.value.length,r=new ue(t);for(let i=0;i<s;i+=2){let l=o.value[i],x=o.value[i+1],F=Q(x,r);r.set(l,F)}return Se(e.value[2],r)}function Ai(e,t){return ui(e),ie(e.value[1])}function vi(e,t){return pi(e),ie(lt(e.value[1]))}function hi(e,t){ii(e);let o=lt(e.value[1]);return Se(o,t)}function xi(e,t){ai(e);let o=e.value[1],s=e.value[2],r=Q(s,t),i=O(r);return U(i)&&(i.isMacro=!0),ie(t.set(o,i))}function bi(e,t){yi(e);let o=f();for(let s=1;s<e.value.length;s++)o=Q(e.value[s],t);return{continue:{ast:o,env:t},return:void 0}}function gi(e,t){si(e);try{return{return:Q(e.value[1],t),continue:void 0}}catch(o){if(!e.value[2])throw o;let s=e.value[2].value[1],r=e.value[2].value[2],i;Y(o)?i=o:o instanceof Error?i=d(o.message):i=d(JSON.stringify(o));let l=k(i),x=new ue(t,[s],[l]);return{return:Q(r,x),continue:void 0}}}function Si(e,t){di(e);let o=e.value[1],s=Q(o,t);if(s.value!==!1&&s.value!==null){let r=e.value[2];return Se(r,t)}if(e.value[3]!==void 0){let r=e.value[3];return Se(r,t)}return ie(f())}function wi(e,t){li(e);let o=e.value[1].value,s=e.value[2],r=t,l=R((...x)=>{let F=new ue(r,o,x);return Q(s,F)},{ast:s,env:r,parameters:o});return ie(l)}function Ci(e,t){let o=dt(e,t);G(o);let s=o.value[0];if(U(s)){let r=o.value.slice(1);if(s.closureMeta){let l=s.closureMeta.ast,x=new ue(s.closureMeta.env,s.closureMeta.parameters,r);return{continue:{ast:l,env:x},return:void 0}}return{return:s.value(...r),continue:void 0}}return{return:s,continue:void 0}}function Mi(e){return j(e,!0)}function be(e,t){return Mi(Q(ci(e),t))}function co(){let e=new ue(void 0);for(let[t,o]of ut.entries())e.set(t,o);for(let[t,o]of _e.entries())e.set(t,o);for(let[t,o]of Xe.entries())e.set(t,o);return e.set(S("eval"),R((...t)=>(n(t.length,1),Q(t[0],e)))),e.set(S("dump"),R((...t)=>{let o=e.serialize();return console.log(j(o,!0)),f()})),be("(def! not (fn* (a) (if a false true)))",e),be(`(defmacro! cond
      (fn* (& xs)
       (if (> (count xs) 0) (list 'if (first xs)
                                  (if (> (count xs) 1) (nth xs 1)
                                      (throw "odd number of forms to cond"))
                                  (cons 'cond (rest (rest xs)))))))`,e),e}var Ao="user> ";function Ei(e,t){let o=null;try{o=pe.open(t,"w"),o!==null&&o.puts(e)}catch(s){throw o!==null&&o.close(),new Error(`Error writing to file: ${s}`)}}function No(...e){n(e.length,1);let t=e[0];y(t);let o=Vi(t.value);return o==null?f():d(o)}function Ti(...e){n(e.length,1),y(e[0]);let t=[],[o,s]=fo.readdir(e[0].value);if(+s>0)throw new Error(`Error reading directory: ${s}`);for(let r of o)r==="."||r===".."||t.push(d(r));return m(t)}function ct(...e){n(e.length,1);let t=e[0];y(t);let o=pe.loadFile(t.value);if(o===null)throw new Error("No such file or directory. xxx");return d(o)}function mo(...e){n(e.length,2);let t=e[0];y(t);let o=e[1];return y(o),Ei(o.value,t.value),f()}function Vi(e=Ao){pe.out.puts(e);let t=pe.in.getline()?.trim();console.log(t),console.log(e)}function*Di(e=Ao){for(;;){pe.out.puts(e);let t=pe.in.getline()?.trim();t&&(yield t)}}function Fi(e){return function(...o){n(o.length,1),y(o[0]);let s=ct(o[0]);y(s);let r=new ue(e),i=be(`(do ${s.value})
nil`,r);return d(i)}}function Li(){let e=co(),t=Fi(e),o=[["readFile",ct],["slurp",ct],["load-file",t],["import",t],["readln",No],["prompt",No],["readir",Ti],["spit",mo],["writeFile",mo]];for(let[s,r]of o)e.set(S(s),R(r));return e}function Ii(e=""){return e.replace(/\\/g,"/")}async function vo(...e){let t=Li(),o=Ii(e[0]),s=e.slice(1).map(r=>d(r));if(t.set(S("*ARGV*"),b(s)),t.set(S("*host-language*"),d("Ensemble")),o){be(`(import "${o}")`,t);return}be('(println (str "Welcome to " *host-language* "! Press Ctrl/Cmd+C to exit."))',t);for await(let r of Di("user> "))if(!(r===""||r===null))try{let i=be(r,t);console.log(i)}catch(i){Y(i)?console.log(`error: ${j(i,!1)}`):i instanceof Error&&console.log(i)}}vo(...scriptArgs);
