import*as Qo from"qjs:os";import*as re from"qjs:std";var Fe=class{constructor(t){this.value=t}},De=class{constructor(t){this.value=t}},Le=class{constructor(t,o=new Map,s=[],r){this.value=t;this.attributes=o;this.children=s;this.metadata=r}},rs=["Error","AggregateError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],Ae=class e{constructor(t,o,s=N()){this.value=t;o!==void 0&&e.isErrorName(o)&&(this.name=o),s!==void 0&&(this.cause=s)}name=d("Error");cause;static isErrorName(t){let o=t.value;return rs.includes(o)}static assertErrorName(t){if(!e.isErrorName(t))throw new TypeError("Error type must be 'Error', 'AggregateError', 'RangeError', 'ReferenceError', 'SyntaxError', 'TypeError', or 'URIError'.")}},Ie=class{constructor(t,o,s=!1,r){this.value=t;this.closureMeta=o;this.isMacro=s;this.metadata=r}},ke=class{constructor(t){this._value=t;this._value=t.replaceAll(":","")}get value(){return this._value+":"}set value(t){this._value=t.replaceAll(":","")+":"}get bare(){return this._value}},ve=class{constructor(t,o){this.value=t;this.metadata=o}},Re=class{constructor(t=new Map,o){this.value=t;this.metadata=o}},qe=class{constructor(t=null){this.value=t}},ee=class{constructor(t){this.value=t}},de=class{constructor(t){this.value=t}},ce=class{constructor(t){this.value=t}},he=class{constructor(t,o){this.value=t;this.metadata=o}};function f(e){if(!G(e))throw new TypeError("Invalid AstNode")}function O(e){if(!te(e))throw new TypeError("Invalid AtomNode")}function B(e){if(!b(e))throw new TypeError("Invalid MapNode")}function Ue(e){if(!X(e))throw new TypeError("Invalid ErrorNode")}function C(e){if(!R(e))throw new TypeError("Invalid FunctionNode")}function W(e){if(!M(e))throw new TypeError("Invalid ListNode")}function ct(e){if(!E(e))throw new TypeError("Invalid NilNode")}function u(e){if(!v(e))throw new TypeError("Invalid NumberNode")}function l(e){if(!w(e))throw new TypeError("Invalid StringNode")}function K(e){if(!I(e))throw new TypeError("Invalid SymbolNode")}function x(e){if(!D(e))throw new TypeError("Invalid VectorNode")}function ue(e){if(!(e instanceof RegExp))throw new Error("Expected a RegExp object.")}function Nt(e){if(typeof e!="symbol")throw new Error("Expected a Symbol object.")}function xe(e,t,o,s){return new Le(e,t,o,s)}function pe(e){return new Fe(e)}function c(e){return new De(e)}function F(e,t){return new Re(e,t)}function P(e,t,o){return f(e),new Ae(e,t,o)}function k(e,t,o,s){return new Ie(e,t,o,s)}function Ne(e){return new ke(e)}function g(e,t){return new ve(e,t)}function N(e){return new qe(e)}function a(e){return new ee(e)}function d(e){return new ce(e)}function S(e){return new de(e)}function m(e=[],t){return new he(e,t)}function se(e){return e instanceof Le}function G(e){return te(e)||H(e)||se(e)||X(e)||R(e)||z(e)||M(e)||b(e)||E(e)||v(e)||w(e)||I(e)||D(e)}function te(e){return e instanceof Fe}function H(e){return e instanceof De&&typeof e.value=="boolean"}function b(e){return e instanceof Re&&e.value instanceof Map}function X(e){return e instanceof Ae&&G(e.value)}function R(e){return e instanceof Ie&&typeof e.value=="function"}function z(e){return e instanceof ke&&typeof e.value=="string"&&e.value.endsWith(":")}function M(e){return e instanceof ve&&e.value.every(G)}function E(e){return e instanceof qe&&e.value===null}function v(e){return e instanceof ee&&typeof e.value=="number"}function w(e){return e instanceof ce&&typeof e.value=="string"}function I(e){return e instanceof de&&typeof e.value=="string"}function D(e){return e instanceof he&&e.value.every(G)}function us(e,t){return Object.getPrototypeOf(e)===Object.getPrototypeOf(t)}function Be(e){if(e===void 0)throw new Error("Value is undefined")}function we(e){return e!==void 0}function Ke(e,t=!1){if(H(e))return e.value;let o=e;return te(o)?G(o.value)?Ke(o.value):!!o.value:E(e)?!1:v(e)?t?!!e.value:!0:!!e.value}function U(e){return M(e)||D(e)}function J(e){if(!M(e)&&!D(e))throw new TypeError("Invalid sequential type")}function $(e){if(!(w(e)||I(e)||z(e)))throw new TypeError("Invalid dictionary key")}function ps(e){return w(e)||I(e)||z(e)}function et(e){if(!R(e)&&!M(e)&&!D(e)&&!b(e)&&!se(e))throw new TypeError("Invalid metadata type")}function n(e,t,o){if(e!==t){let s=`Wanted ${t} arguments but got ${e}`;throw o&&(s+=` ${o}`),new Error(s)}}function A(e,t,o){if(e<t||e>o)throw new Error("Unexpected number of arguments")}function T(e,t){if(e<t)throw new Error("Unexpected minimum number of arguments")}function be(e){if(e%2!==0)throw new Error("Uneven number of arguments")}function Y(e,t){for(let o of e)if(!(o instanceof t))throw new TypeError("All values must be of the same type")}function oe(e,t){if(U(e)&&U(t)){if(e.value.length!==t.value.length)return c(!1);for(let s=0;s<e.value.length;s++)if(!oe(e.value[s],t.value[s]).value)return c(!1);return c(!0)}if(b(e)&&b(t)){if(e.value.size!==t.value.size)return c(!1);for(let[s,r]of e.value){let i=t.value.get(s);if(i===void 0||!oe(r,i).value)return c(!1)}return c(!0)}if(!us(e,t))return c(!1);let o=e.value===t.value;return c(o)}function tt(e,t){let o=M(e)&&I(e.value[0]);return o&&t!==void 0?e.value[0].value===t:o}function is(e,t){if(e!==t)throw new Error(`Unexpected value '${e}', wanted ${t}`)}function me(e,t){is(e.value,t)}function Ce(e,t){return{continue:{ast:e,env:t},return:void 0}}function ie(e){return{continue:void 0,return:e}}function j(e){if(te(e))return as(e);if(H(e))return ys(e);if(b(e))return ls(e);if(X(e))return cs(e);if(R(e))return Ns(e);if(z(e))return ms(e);if(M(e))return fs(e);if(E(e))return As(e);if(v(e))return vs(e);if(w(e))return hs(e);if(I(e))return xs(e);if(D(e))return bs(e);if(se(e))return ds(e);throw new Error("Unmatched object")}function as(e){return pe(j(e.value))}function ys(e){return c(e.value)}function ls(e){let t=F(new Map(e.value));return t.metadata=j(e.metadata??N()),t}function ds(e){let t=e.value,o=e.attributes,s=e.children,r=xe(t,new Map(o),s.map(j));return r.metadata=j(e.metadata??N()),r}function cs(e){return P(j(e.value))}function Ns(e){let t=k(e.value);if(t.isMacro=e.isMacro,t.metadata=j(e.metadata??N()),e.closureMeta){let o=e.closureMeta;t.closureMeta={ast:j(o.ast),env:o.env,parameters:o.parameters.map(s=>S(s.value))}}return t}function ms(e){return Ne(e.value)}function fs(e){let t=g(e.value.map(o=>j(o)));return t.metadata=j(e.metadata??N()),t}function As(e){return N()}function vs(e){return a(e.value)}function hs(e){return d(e.value)}function xs(e){return S(e.value)}function bs(e){let t=m(e.value.map(o=>j(o)));return t.metadata=j(e.metadata??N()),t}function $e(e,t,o){e.set(Z(t),o)}function je(e,t){e.delete(Z(t))}function Oe(e,t){return e.has(Z(t))}function We(e,t){return e.get(Z(t))}function _e(e){let t=[...e.keys()];return g(t.map(o=>mt(o)))}function Z(e){let t=e;if(z(t))return t.value;let o=e;return w(o)?`"${o.value}"`:e.value}function mt(e){return e.endsWith(":")?Ne(e):e.startsWith('"')?d(e.slice(1,-1)):S(e)}function Me(e){let t=ps(e)?e.value:e;return t.startsWith(":")||t.endsWith(":")?t.replaceAll(":",""):t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):t}function ot(e){let t=[];for(let[o,s]of e.entries())t.push(mt(o),s);return t}function Pe(e){return e.replaceAll("\\","\\\\").replaceAll('"','\\"').replaceAll(`
`,"\\n")}function Q(e){if(te(e))return gs(e);if(H(e))return Ss(e);if(b(e))return Ge(e);if(X(e))return ws(e);if(R(e))return Cs(e);if(z(e))return Ms(e);if(M(e))return Es(e);if(E(e))return Ts();if(v(e))return ae(e);if(w(e))return ge(e);if(I(e))return Vs(e);if(D(e))return Fs(e);throw new Error("Could not unwrap object.")}function gs(e){return Q(e.value)}function Ss(e){return e.value}function ws(e){let t=w(e.value)?e.value.value:String(Q(e.value));return new Error(t)}function Cs(e){return(...t)=>p(Q(e.value(...t)))}function Ms(e){return e.value}function Es(e){return e.value.map(Q)}function Ge(e){let t={};for(let[o,s]of e.value.entries())t[o]=Q(s);return t}function Ts(){return null}function ae(e){return e.value}function ge(e){return e.value}function Vs(e){return e.value}function Fs(e){return e.value.map(Q)}function p(e){if(G(e))return e;switch(typeof e){case"undefined":return N();case"number":return a(e);case"string":return e.startsWith('"')?d(e):e.startsWith(":")?Ne(e):S(e);case"boolean":return c(e);case"symbol":return d(JSON.stringify(e));case"function":return k((...t)=>{try{return p(e(...t.map(o=>o.value)))}catch(o){return o instanceof Error?P(d(o.message)):P(d(JSON.stringify(o)))}});case"object":{if(e instanceof Error)return P(d(e.message));if(e===null)return N();if(Array.isArray(e)){let s=e.map(r=>p(r));return g(s)}if(e instanceof Map){let s=new Map;for(let[r,i]of e.entries()){let y=String(r),h=p(i);s.set(y,h)}return F(s)}let t=e,o=new Map;for(let[s,r]of Object.entries(t)){let i=String(s),y=p(r);o.set(i,y)}return F(o)}default:{let t=String(e);return P(d(`unknown type ${t}`))}}}var ne=class{value=new Map;outer;binds=[];exprs=[];constructor(t=void 0,o=[],s=[]){this.outer=t,this.binds=o,this.exprs=s;for(let r=0;r<o.length;r++){let i=o[r];if(i.value==="&"){let h=o[r+1];if(h){let V=s.slice(r),ns=Z(h);this.value.set(ns,g(V));break}}let y=Z(i);this.value.set(y,s[r])}}serialize(){let t=F(),o=F();this.outer&&(o=this.outer.serialize());let s=this.value.entries();for(let[r,i]of s)t.value.set(r,i);return t.value.set("__outer__",o),t}set(t,o){let s=Z(t);return this.value.set(s,o),o}findEnv(t){let o=Z(t);if(this.value.has(o))return this;if(we(this.outer))return this.outer.findEnv(t)}get(t){let o=this.findEnv(t);if(o===void 0)throw new Error(`'${t.value}' not found`);let s=Z(t),r=o.value.get(s);return Be(r),r}};function q(e,t=!1){if(w(e))return t?`"${Pe(e.value)}"`:e.value;if(z(e)||H(e)||v(e)||I(e))return String(e.value);let o=e;if(te(o))return`(atom ${q(o.value)})`;if(X(e))return q(e.value,t);if(R(e))return"#<fn>";if(U(e)){let s=M(e),r=e.value.map(i=>q(i,t)).join(" ");return s?`(${r})`:`[${r}]`}if(se(e))return fe(e,t);if(b(e))return`{${ot(e.value).map(r=>q(r,t)).join(" ")}}`;if(E(e))return"nil";throw new Error(`unmatched object ${JSON.stringify(e)}`)}var Ds=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]);function fe(e,t=!1){if(se(e)){let s=e.value,r=Ds.has(s),i="";if(e.attributes.size>0&&(i=" "+Array.from(e.attributes).map(([h,V])=>h==="style"?Is(V,t):`${Me(h)}="${fe(V,t)}"`).join(" ")),r)return`<${s}${i} />`;let y=[];if(e.children.length>0){let h=[];s==="style"?h=e.children.map(V=>Ls(V,t)):s==="script"?h=e.children.map(V=>ze(V,t)):h=e.children.map(V=>fe(V,t)),y.push(h.join(" "))}return s==="!doctype"?`<!doctype html>
${y.join(" ")}`:`<${s}${i}>${y.join(" ")}</${s}>`}if(w(e))return t?`"${Pe(e.value)}"`:e.value;if(z(e)||H(e)||v(e)||I(e))return String(e.value);let o=e;if(te(o))return`(atom ${fe(o.value)})`;if(X(e))return fe(e.value,t);if(R(e))return"#<fn>";if(U(e)){let s=M(e),r=e.value.map(i=>fe(i,t)).join(" ");return s?`(${r})`:`[${r}]`}if(b(e))return`{${ot(e.value).map(r=>fe(r,t)).join(" ")}}`;if(E(e))return"nil";throw new Error(`unmatched object ${JSON.stringify(e)}`)}function ze(e,t=!1){if(se(e))return`(const el = document.createElement("${e.value}"); document.body.appendChild(el);)`;if(M(e)){let o=e.value,s=o[0],r=o.slice(1);return`(${s.value}(${r.map(i=>ze(i)).join(", ")}))`}return D(e)?`[${e.value.map(s=>ze(s)).join(",")}]`:R(e)?`(${e.value.toString()})`:w(e)||z(e)||I(e)?`"${e.value}"`:H(e)||v(e)?String(e.value):b(e)?`{${Object.entries(e.value).map(([s,r])=>{let i=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(s)?s:`"${s}"`,y=ze(r,t);return`${i}: ${y}`}).join(", ")}}`:E(e)?"null":"/* javascript */"}function Se(e,t=!1){if(w(e))return t?Pe(e.value):e.value;if(z(e))return e.value.slice(1);if(v(e))return String(e.value);if(I(e))return e.value;if(X(e))return Se(e.value,t);if(M(e)||D(e))return e.value.map(o=>Se(o,t)).join(" ");if(b(e))return[...e.value].map(([o,s])=>{let r=Me(o);return E(s)?r:b(s)?`${r} {${Se(s,t)}}`:`${Me(o)}: ${Se(s,t)};`}).join(" ");if(H(e)||te(e)||R(e)||se(e)||E(e))return"";throw new Error("unmatched object")}function Ls(e,t=!1){return Se(e,t)}function Is(e,t=!1){return b(e)?ks(e,t):"{}"}function ks(e,t=!1){return[...e.value].map(([o,s])=>`${Me(o)}: ${Se(s,t)};`).join("")}var Rs=/[\s,=]*(~@|[[\]{}()'`~^@<>]|"(?:\\.|[^\\"])*"?|;.*|\/\/.*|\r?\n|[^\s[\]{}<>('"`,;=)]*)/g,qs=/^-?\d+(\.\d+)?$/,Us=/"(?:\\.|[^\\"])*"/,nt=class{constructor(t,o=0){this.tokens=t;this.pos=o}line=0;next=()=>this.tokens[this.pos++];peek=()=>this.tokens[this.pos];context=()=>{let t=this.pos-10,o=this.pos+10;return this.tokens.slice(t,o).join(" ")}};function Je(e,t){let o=e instanceof Error?e.message:e,s=t.context();return`Error: ${o}
  on line ${t.line} near "${s}"`}function Bs(e){return[...e.matchAll(Rs)].filter(o=>!o[1].startsWith(";")&&!o[1].startsWith("//")&&o[1]!=="").map(o=>o[1])}function Ye(e){try{let t=Bs(e);return t.length===0?N():Te(new nt(t))}catch(t){let o=t instanceof Error?t.message:String(t);return console.log(`Error reading input: ${o}`),N()}}function Te(e){let t=e.peek();if(t===void 0)throw new Error("EOF");function o(s,r){return g([S(s),Te(e),...r?[r]:[]])}switch(t){case`
`:case`\r
`:return e.line++,e.next(),Te(e);case"'":return e.next(),o("quote");case"`":return e.next(),o("quasiquote");case"~":return e.next(),o("unquote");case"~@":return e.next(),o("splice-unquote");case"^":{e.next();let s=Te(e);return o("with-meta",s)}case"@":return e.next(),o("deref");case")":case"]":case"}":case">":{let s=Je(`unexpected '${t}'`,e);throw new Error(s)}case"(":return Qe(e,")");case"[":return Qe(e,"]");case"{":return Qe(e,"}");case"<":return Qe(e,">");default:return Ks(e)}}function Ks(e){let t=e.next();if(t===void 0)throw new Error("unexpected EOF");if(t==="nil")return N();if(t==="false")return c(!1);if(t==="true")return c(!0);if(qs.test(t))return a(Number.parseFloat(t));if(Us.test(t))return d($s(t));if(t.startsWith(":")||t.endsWith(":"))return Ne(t);if(t.startsWith('"')){let o=Je(`expected '"', got EOF`,e);throw new Error(o)}return S(t)}function $s(e){return e.slice(1,-1).replaceAll(/\\(.)/g,(t,o)=>o==="n"?`
`:o)}function Qe(e,t){let o=[];for(e.next();;){let s=e.peek();if(s===void 0){let r=Je(`expected '${t}', got EOF`,e);throw new Error(r)}if(s===t){e.next();break}o.push(Te(e))}switch(t){case">":case")":return g(o);case"]":return m(o);case"}":{let s=F();for(let r=0;r<o.length;r+=2){let i=o[r];$(i);let y=o[r+1],h=Z(i);s.value.set(h,y)}return s}default:{let s=Je(`unknown end value: ${t}`,e);throw new Error(s)}}}var ft=new Map,At=[["eq",He],["equals",He],["equal",He],["throw",Qt],["nil?",to],["true?",oo],["false?",so],["symbol",pt],["Symbol.new",pt],["symbol?",ro],["keyword",uo],["keyword?",po],["number?",io],["macro?",yo],["pr-str",vt],["str",ht],["prn",xt],["println",ut],["console.log",ut],["read-string",bt],["string?",no],["trim",gt],["lt",St],["lte",wt],["gt",Ct],["gte",Mt],["add",Et],["subtract",Tt],["multiply",Vt],["divide",Ft],["time-ms",Dt],["assoc",mo],["contains?",vo],["dissoc",fo],["get",Ao],["hash-map",it],["keys",ho],["map?",No],["vals",xo],["list",Lt],["list?",It],["apply",Jt],["fn?",ao],["concat",Rt],["conj",Ht],["cons",kt],["count",Ot],["empty?",jt],["first",Bt],["last",Kt],["join",go],["map",Yt],["nth",Ut],["rest",$t],["seq",Xt],["sequential?",bo],["vec",qt],["vector",lo],["vector?",co],["meta",Zt],["with-meta",eo],["atom",Wt],["atom?",_t],["deref",Pt],["reset!",Gt],["swap!",zt]];for(let[e,t]of At)ft.set(S(e),k(t));function He(...e){return n(e.length,2),oe(e[0],e[1])}function vt(...e){let t=e.map(o=>q(o,!0)).join(" ");return d(t)}function ht(...e){let t=e.map(o=>q(o,!1)).join("");return d(t)}function xt(...e){let t=e.map(o=>q(o,!0)).join(" ");return console.log(t),N()}function ut(...e){let t=e.map(o=>q(o,!1)).join(" ");return console.log(t),N()}function bt(...e){n(e.length,1);let t=e[0];return l(t),Ye(t.value)}function gt(...e){n(e.length,1);let t=e[0];return l(t),d(t.value.trim())}function St(...e){n(e.length,2,`
args: ${JSON.stringify(e,null,"  ")}`);let t=e[0];u(t);let o=e[1];return u(o),c(t.value<o.value)}function wt(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),c(t.value<=o.value)}function Ct(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),c(t.value>o.value)}function Mt(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),c(t.value>=o.value)}function Et(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),a(t.value+o.value)}function Tt(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),a(t.value-o.value)}function Vt(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),a(t.value*o.value)}function Ft(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),a(t.value/o.value)}function Dt(...e){return n(e.length,0),a(new Date().getTime())}function Lt(...e){for(let t of e)f(t);return g(e)}function It(...e){return n(e.length,1),c(M(e[0]))}function kt(...e){return n(e.length,2),J(e[1]),new ve([e[0],...e[1].value])}function Rt(...e){let t=[];for(let o of e)J(o),t.push(...o.value);return g(t)}function qt(...e){return M(e[0])?m(e[0].value):e[0]}function Ut(...e){if(n(e.length,2),U(e[0])&&v(e[1])){let t=e[1].value,o=e[0],s=e[0].value.length;if(s>0&&t<s)return o.value[t]}throw new Error("out of range")}function Bt(...e){return n(e.length,1),U(e[0])&&e[0].value.length>0?e[0].value[0]:N()}function Kt(...e){return n(e.length,1),U(e[0])&&e[0].value.length>0?e[0].value[e[0].value.length-1]:N()}function $t(...e){return n(e.length,1),U(e[0])?g(e[0].value.slice(1)):g([])}function jt(...e){n(e.length,1);let t=e[0];return J(t),c(t.value.length===0)}function Ot(...e){n(e.length,1);let t=e[0];if(E(t))return a(0);if(b(e[0]))return a(e[0].value.size);if(U(e[0]))return a(e[0].value.length);throw new TypeError("Invalid argument type")}function Wt(...e){n(e.length,1);let t=e[0];return pe(t)}function _t(...e){n(e.length,1);let t=e[0];return c(te(t))}function Pt(...e){n(e.length,1);let t=e[0];return O(t),t.value}function Gt(...e){n(e.length,2);let t=e[0],o=e[1];return O(t),t.value=o,o}function zt(...e){T(e.length,2);let t=e[0];O(t);let o=e[1];C(o);let s=e.slice(2);return t.value=o.value(t.value,...s),t.value}function Qt(...e){throw n(e.length,1),f(e[0]),P(e[0])}function Jt(...e){let t=e.length;T(t,2),C(e[0]);let o=e[t-1];return J(o),e[0].value(...e.slice(1,-1),...o.value)}function Yt(...e){let t=e.length;n(t,2),C(e[0]),J(e[1]);let o=e[0],r=e[1].value.map(i=>o.value(i));return g(r)}function Ht(...e){T(e.length,2),J(e[0]);let[t,...o]=e;return M(t)?g([...o.reverse(),...t.value]):m([...e[0].value,...o])}function Xt(...e){n(e.length,1);let t=e[0];return M(t)&&t.value.length>0?t:D(t)&&t.value.length>0?g([...t.value]):w(t)&&t.value.length>0?g(t.value.split("").map(o=>d(o))):N()}function Zt(...e){return n(e.length,1),et(e[0]),e[0].metadata??N()}function eo(...e){n(e.length,2),et(e[0]),f(e[1]);let t=j(e[0]);return t.metadata=e[1],t}function to(...e){return n(e.length,1),c(E(e[0]))}function oo(...e){return n(e.length,1),c(H(e[0])&&e[0].value)}function so(...e){return n(e.length,1),c(H(e[0])&&!e[0].value)}function no(...e){return n(e.length,1),c(w(e[0]))}function pt(...e){return n(e.length,1),l(e[0]),S(e[0].value)}function ro(...e){return n(e.length,1),c(I(e[0]))}function uo(...e){n(e.length,1),$(e[0]);let t=e[0];if(z(t))return t;let o=e[0];return Ne(`:${o.value}`)}function po(...e){return n(e.length,1),c(z(e[0]))}function io(...e){return n(e.length,1),c(v(e[0]))}function ao(...e){return n(e.length,1),c(R(e[0])&&!e[0].isMacro)}function yo(...e){return n(e.length,1),c(R(e[0])?e[0].isMacro:!1)}function lo(...e){return m(e)}function co(...e){return n(e.length,1),c(D(e[0]))}function it(...e){if(e.length===0)return F();if(e.length===1&&b(e[0]))return F(new Map(e[0].value));be(e.length);let t=F();for(let o=0;o<e.length;o+=2){let s=e[o];$(s),$e(t.value,s,e[o+1])}return t}function No(...e){return n(e.length,1),c(b(e[0]))}function mo(...e){T(e.length,1),B(e[0]);let t=e.slice(1),o=F(new Map(e[0].value)),s=it(...t);for(let[r,i]of s.value.entries())o.value.set(r,i);return o}function fo(...e){T(e.length,1),B(e[0]);let t=F(new Map(e[0].value));for(let o of e.splice(1))$(o),je(t.value,o);return t}function Ao(...e){n(e.length,2);let t=e[0];if(!b(t))return N();let o=e[1];$(o);let s=We(t.value,o);return s!==void 0?s:N()}function vo(...e){n(e.length,2);let t=e[0],o=e[1];return B(t),$(o),c(Oe(t.value,o))}function ho(...e){return n(e.length,1),B(e[0]),_e(e[0].value)}function xo(...e){return n(e.length,1),B(e[0]),g([...e[0].value.values()])}function bo(...e){return c(U(e[0]))}function go(...e){A(e.length,1,2),J(e[0]);let t=w(e[1])?e[1].value:" ",o=e[0].value.map(s=>q(s,!1)).join(t);return d(o)}function js(...e){T(e.length,2);let[t,...o]=e,s=o.pop();Be(s),C(s);let r=o.length;for(let i=0;i<r;i++){let y=o[i];if(W(y),n(y.value.length,2),C(y.value[1]),oe(t,y.value[0]).value)return y.value[1].value()}return s.value()}var ye={add:Et,apply:Jt,applyToSequence:Yt,assoc:mo,atom:Wt,concat:Rt,conj:Ht,cons:kt,contains:vo,deref:Pt,dissoc:fo,divide:Ft,empty:jt,eq:He,firstNodeInList:Bt,get:Ao,gt:Ct,gte:Mt,hashMap:it,isAtom:_t,isFalse:so,isFn:ao,isKeyword:po,isListNode:It,isMacro:yo,isMap:No,isNil:to,isNumber:io,isSequentialNode:bo,isString:no,isSymbolNode:ro,isTrue:oo,isVector:co,join:go,keys:ho,keyword:uo,lastNodeInList:Kt,length:Ot,list:Lt,lt:St,lte:wt,meta:Zt,multiply:Vt,ns:ft,nsValues:At,nth:Ut,printEscapedString:vt,printEscapedStringToScreen:xt,printUnescapedString:ht,printUnescapedStringToScreen:ut,readString:bt,reset:Gt,rest:$t,seq:Xt,subtract:Tt,swap:zt,switchCase:js,symbol:pt,throwError:Qt,timeMs:Dt,trim:gt,vals:xo,vec:qt,vector:lo,withMeta:eo};var Ws=new Set(["!doctype","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","imgmap","input","kbd","label","legend","li","link","main","mark","menu","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","portal","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"]),Xe=new Map;for(let e of Ws)Xe.set(S(e),k(_s(e)));function _s(e){return(...t)=>Ps(S(e),...t)}function Ps(...e){T(e.length,1);let t=e[0];K(t);let o=new Map,s=[];return b(e[1])?(e[1].value.forEach((r,i)=>o.set(i,r)),e.slice(2).forEach(r=>s.push(r))):e.slice(1).forEach(r=>s.push(r)),xe(t.value,o,s)}function Gs(...e){n(e.length,1),l(e[0]);let t=e[0].value,o=document.querySelector(t);if(o===null)return N();let r=Array.from(o.attributes).reduce((i,y)=>i.set(y.name,d(y.value)),new Map);return xe(o.tagName,r,[])}Xe.set(S("document.querySelector"),k(Gs));var To=[["Array",zs],["Array.from",wo],["Array.isArray",Js],["Array.of",wo],["Array.prototype.at",Qs],["Array.prototype.concat",Ys],["Array.prototype.copyWithin",Hs],["Array.prototype.entries",Xs],["Array.prototype.every",Zs],["Array.prototype.fill",en],["Array.prototype.filter",tn],["Array.prototype.find",on],["Array.prototype.findIndex",sn],["Array.prototype.findLast",nn],["Array.prototype.findLastIndex",rn],["Array.prototype.flat",un],["Array.prototype.flatMap",pn],["Array.prototype.includes",an],["Array.prototype.indexOf",yn],["Array.prototype.join",ln],["Array.prototype.keys",dn],["Array.prototype.length",fn],["Array.prototype.map",cn],["Array.prototype.pop",Nn],["Array.prototype.push",mn],["Array.prototype.reduce",An],["Array.prototype.reverse",Co],["Array.prototype.shift",vn],["Array.prototype.slice",hn],["Array.prototype.some",xn],["Array.prototype.sort",Mo],["Array.prototype.splice",Eo],["Array.prototype.toReversed",Co],["Array.prototype.toSorted",Mo],["Array.prototype.toSpliced",Eo],["Array.prototype.unshift",bn],["Array.prototype.values",gn],["Array.prototype.with",Sn],["Array.toString",ye.printEscapedString]];function zs(...e){if(T(e.length,1),e.length===1&&v(e[0])){let t=Array(e[0].value).fill(N());return m(t)}return m(e)}function wo(...e){A(e.length,1,3),x(e[0]),e.length>=2&&C(e[1]),e.length===3&&f(e[2]);let t=Array.from(e[0].value,e[1]?.value,e[2]?.value);return m(t)}function Qs(...e){n(e.length,2),x(e[0]),u(e[1]);let t=e[0].value,o=e[1].value,s=t.at(o);return s?p(s):N()}function Js(...e){n(e.length,1),f(e[0]);let t=D(e[0]);return c(t)}function Ys(...e){T(e.length,1),Y(e,he);let t=e[0].value.concat(...e.slice(1).map(o=>o.value));return m(t)}function Hs(...e){A(e.length,1,4),x(e[0]),u(e[1]),u(e[2]);let t=e[0].value,o=e[1].value,s=e[2].value,r=v(e[3])?e[3].value:void 0,i=t.copyWithin(o,s,r);return m(i)}function Xs(...e){n(e.length,1),x(e[0]);let t=e[0].value.map((o,s)=>{let r=a(s);return m([r,o])});return m(t)}function Zs(...e){n(e.length,2),x(e[0]),C(e[1]);let t=e[0].value,o=e[1].value,s=t.every((r,i,y)=>o(a(i),r,m(y)).value);return c(s)}function en(...e){A(e.length,2,4),x(e[0]),f(e[1]);let t=e[0].value.map(Q),o=e[1].value,s;e.length>=3&&(u(e[2]),s=e[2].value);let r;e.length===4&&(u(e[3]),r=e[3].value);let i=t.fill(o,s,r);return m(i.map(p))}function tn(...e){n(e.length,2),C(e[0]),x(e[1]);let t=e[0],s=e[1].value.filter(r=>!!t.value(r).value);return m(s)}function on(...e){n(e.length,2),x(e[0]),C(e[1]);let t=e[0].value,o=e[1].value;return t.find((r,i,y)=>o(r,a(i),m(y)).value)??N()}function sn(...e){n(e.length,2),x(e[0]),C(e[1]);let t=e[0].value,o=e[1].value,s=t.findIndex((r,i,y)=>o(r,a(i),m(y)).value);return a(s)}function nn(...e){n(e.length,2),x(e[0]),C(e[1]);let t=e[0].value,o=e[1].value;return t.findLast((r,i,y)=>o(r,a(i),m(y)).value)??N()}function rn(...e){n(e.length,2),x(e[0]),C(e[1]);let t=e[0].value,o=e[1].value,s=t.findLastIndex((r,i,y)=>o(r,a(i),m(y)).value);return a(s)}function un(...e){n(e.length,1),x(e[0]);let t=e[0].value;function o(r){return r.reduce((i,y)=>i.concat(D(y)?o(y.value):y),[])}let s=o(t);return m(s)}function pn(...e){n(e.length,2),x(e[0]),C(e[1]);let t=e[0].value,o=e[1].value;function s(y){return y.reduce((h,V)=>h.concat(D(V)?s(V.value):V),[])}let r=t.map((y,h,V)=>o(y,a(h),m(V))),i=s(r);return m(i)}function an(...e){n(e.length,2),x(e[0]),f(e[1]);let t=e[0],o=e[1],s=t.value.some(r=>oe(r,o).value);return c(s)}function yn(...e){n(e.length,2),x(e[0]),f(e[1]);let t=e[0],o=e[1];for(let[s,r]of t.value.entries())if(oe(r,o).value)return a(s);return a(-1)}function ln(...e){A(e.length,1,2),J(e[0]);let t=w(e[1])?e[1].value:" ",o=e[0].value.map(s=>q(s,!1)).join(t);return d(o)}function dn(...e){n(e.length,1),x(e[0]);let o=e[0].value.map((s,r)=>a(r));return m(o)}function cn(...e){A(e.length,2,3),x(e[0]),C(e[1]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=t.map((i,y,h)=>{let V=o(i,a(y),s);return p(V)});return m(r)}function Nn(...e){n(e.length,1),x(e[0]);let t=e[0],o=t.value[t.value.length-1];return p(o)}function mn(...e){if(T(e.length,2),!e.every(G))throw new TypeError("Invalid arguments.");return x(e[0]),m([...e[0].value,...e.slice(1)])}function fn(...e){n(e.length,1),x(e[0]);let t=e[0];return a(t.value.length)}function An(...e){n(e.length,3),C(e[0]),x(e[1]);let t=e[0],o=e[1],s=e[2];for(let r of o.value)s=t.value(s,r);return s}function Co(...e){n(e.length,1),x(e[0]);let o=e[0].value.toReversed();return m(o)}function vn(...e){n(e.length,1),x(e[0]);let o=e[0].value[0];return o||N()}function hn(...e){A(e.length,1,3),x(e[0]);let t=0;e[1]!==void 0&&(u(e[1]),t=e[1].value);let o=e[0].value.length;return e[2]!==void 0&&(u(e[2]),o=e[2].value),m(e[0].value.slice(t,o))}function xn(...e){n(e.length,2),x(e[0]),C(e[1]);let t=e[0].value,o=e[1].value,s=t.some((r,i,y)=>o(r,a(i),m(y)).value);return c(s)}function Mo(...e){n(e.length,2),x(e[0]),C(e[1]);let t=e[0].value,o=e[1].value,s=t.toSorted((r,i)=>{let y=o(r,i);return u(y),y.value});return m(s)}function Eo(...e){A(e.length,2,4),x(e[0]),u(e[1]);let t=e[0].value,o=e[1].value;if(e.length<3){let y=t.toSpliced(o);return m(y)}u(e[2]);let s=e[2].value,r=e.slice(3),i=t.toSpliced(o,s,...r);return m(i)}function bn(...e){n(e.length,2),x(e[1]);let t=[e[0],...e[1].value];return m(t)}function gn(...e){n(e.length,1),x(e[0]);let o=e[0].value.map(s=>s);return m(o)}function Sn(...e){n(e.length,3),x(e[0]),u(e[1]),f(e[2]);let t=e[0],o=e[1],s=e[2],r=t.value.with(o.value,s);return m(r)}var Vo=[["Boolean",wn]];function wn(...e){return n(e.length,1),f(e[0]),c(!!e[0].value)}var Fo=[["decodeURI",Cn],["decodeURIComponent",Mn],["encodeURI",En],["encodeURIComponent",Tn]];function Cn(...e){n(e.length,1),l(e[0]);let t=decodeURI(e[0].value);return d(t)}function Mn(...e){n(e.length,1),l(e[0]);let t=decodeURIComponent(e[0].value);return d(t)}function En(...e){n(e.length,1),l(e[0]);let t=encodeURI(e[0].value);return d(t)}function Tn(...e){n(e.length,1),l(e[0]);let t=encodeURIComponent(e[0].value);return d(t)}var Do=[["Date",Vn],["Date.now",Fn],["Date.parse",Dn],["Date.UTC",Ln],["Date.prototype.getDate",In],["Date.prototype.getDay",kn],["Date.prototype.getFullYear",Rn],["Date.prototype.getHours",qn],["Date.prototype.getMilliseconds",Un],["Date.prototype.getMinutes",Bn],["Date.prototype.getMonth",Kn],["Date.prototype.getSeconds",$n],["Date.prototype.getTime",jn],["Date.prototype.getTimezoneOffset",On],["Date.prototype.getUTCDate",Wn],["Date.prototype.getUTCDay",_n],["Date.prototype.getUTCFullYear",Pn],["Date.prototype.getUTCHours",Gn],["Date.prototype.getUTCMilliseconds",zn],["Date.prototype.getUTCMinutes",Qn],["Date.prototype.getUTCMonth",Jn],["Date.prototype.getUTCSeconds",Yn],["Date.prototype.setDate",Hn],["Date.prototype.setFullYear",Xn],["Date.prototype.setHours",Zn],["Date.prototype.setMilliseconds",er],["Date.prototype.setMinutes",tr],["Date.prototype.setMonth",or],["Date.prototype.setSeconds",sr],["Date.prototype.setTime",nr],["Date.prototype.setUTCDate",rr],["Date.prototype.setUTCFullYear",ur],["Date.prototype.setUTCHours",pr],["Date.prototype.setUTCMilliseconds",ir],["Date.prototype.setUTCMinutes",ar],["Date.prototype.setUTCMonth",yr],["Date.prototype.setUTCSeconds",lr],["Date.prototype.toDateString",dr],["Date.prototype.toISOString",cr],["Date.prototype.toJSON",Nr],["Date.prototype.toLocaleDateString",mr],["Date.prototype.toLocaleString",fr],["Date.prototype.toLocaleTimeString",Ar],["Date.prototype.toString",vr],["Date.prototype.toTimeString",hr],["Date.prototype.toUTCString",xr]];function Vn(...e){let t=e.map(Q),o=t.length>0?new Date(...t):new Date;return a(o.getTime())}function Fn(...e){return a(Date.now())}function Dn(...e){n(e.length,1),l(e[0]);let t=Date.parse(e[0].value);return a(t)}function Ln(...e){let t=e.map(Q),o=Date.UTC(...t);return Number.isNaN(o)?N():a(o)}function In(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getDate())}function kn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getDay())}function Rn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getFullYear())}function qn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getHours())}function Un(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getMilliseconds())}function Bn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getMinutes())}function Kn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getMonth())}function $n(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getSeconds())}function jn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getTime())}function On(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getTimezoneOffset())}function Wn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCDate())}function _n(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCDay())}function Pn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCFullYear())}function Gn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCHours())}function zn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCMilliseconds())}function Qn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCMinutes())}function Jn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCMonth())}function Yn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCSeconds())}function Hn(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setDate(e[1].value),a(t.getTime())}function Xn(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setFullYear(e[1].value),a(t.getTime())}function Zn(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setHours(e[1].value),a(t.getTime())}function er(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setMilliseconds(e[1].value),a(t.getTime())}function tr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setMinutes(e[1].value),a(t.getTime())}function or(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setMonth(e[1].value),a(t.getTime())}function sr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setSeconds(e[1].value),a(t.getTime())}function nr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setTime(e[1].value),a(t.getTime())}function rr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCDate(e[1].value),a(t.getTime())}function ur(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCFullYear(e[1].value),a(t.getTime())}function pr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCHours(e[1].value),a(t.getTime())}function ir(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCMilliseconds(e[1].value),a(t.getTime())}function ar(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCMinutes(e[1].value),a(t.getTime())}function yr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCMonth(e[1].value),a(t.getTime())}function lr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCSeconds(e[1].value),a(t.getTime())}function dr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toDateString())}function cr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toISOString())}function Nr(...e){A(e.length,1,2),u(e[0]),e[1]&&l(e[1]);let t=new Date(e[0].value);return d(t.toJSON())}function mr(...e){A(e.length,1,3),u(e[0]);let t=new Date(e[0].value),o=e.slice(1).map(Q);return d(t.toLocaleDateString(...o))}function fr(...e){A(e.length,1,3),u(e[0]);let t=new Date(e[0].value),o=e.slice(1).map(Q);return d(t.toLocaleString(...o))}function Ar(...e){A(e.length,1,3),u(e[0]);let t=new Date(e[0].value),o=e.slice(1).map(Q);return d(t.toLocaleTimeString(...o))}function vr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toString())}function hr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toTimeString())}function xr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toUTCString())}var Lo=[["Error",br],["Error.prototype.message",gr],["Error.prototype.cause",Sr],["Error.prototype.name",wr]];function br(...e){A(e.length,1,3);let t=e[0];l(t);let o;if(e[1]!==void 0){if(!w(e[1])&&!E(e[1]))throw new TypeError("Second argument must be a string or nil.");w(e[1])&&(Ae.assertErrorName(e[1]),o=e[1])}let s;return e[2]!==void 0&&(f(e[2]),s=e[2]),P(t,o,s)}function gr(...e){return n(e.length,1),Ue(e[0]),e[0].value}function Sr(...e){return n(e.length,1),Ue(e[0]),e[0].cause??N()}function wr(...e){return n(e.length,1),Ue(e[0]),e[0].name}var ko=[["Function",Io],["Function.isFunction",ye.isFn],["Function.prototype.apply",Cr],["Function.prototype.bind",Er],["Function.prototype.call",Mr],["js-eval",Io]];function Io(...e){n(e.length,1),l(e[0]);try{let t=new Function(`'use strict'; return (${e[0].value})`)();return p(t)}catch(t){return t instanceof Error?P(d(t.message)):P(d(JSON.stringify(t)))}}function Cr(...e){n(e.length,2),C(e[0]),x(e[1]);let t=e[0].value.apply(null,e[1].value);return p(t)}function Mr(...e){T(e.length,1),C(e[0]);let t=e[0].value.call(null,...e.slice(1));return p(t)}function Er(...e){T(e.length,2),C(e[0]),f(e[1]);let t=e[0].value.bind(e[1],...e.slice(2));return p(t)}var Ro=[["Map.isMap",Tr],["Map.new",qo],["Map.prototype.delete",Dr],["Map.prototype.entries",Vr],["Map.prototype.get",Lr],["Map.prototype.has",Ir],["Map.prototype.keys",kr],["Map.prototype.set",Fr],["Map.prototype.size",qr],["Map.prototype.values",Rr]];function Tr(...e){return n(e.length,1),c(b(e[0]))}function qo(...e){if(e.length===0)return F();if(e.length===1&&b(e[0]))return F(new Map(e[0].value));be(e.length);let t=F();for(let o=0;o<e.length;o+=2){let s=e[o];$(s),$e(t.value,s,e[o+1])}return t}function Vr(...e){n(e.length,1),B(e[0]);let t=e[0].value.entries(),o=m();for(let[s,r]of t){let i=m([p(s),p(r)]);o.value.push(i)}return o}function Fr(...e){T(e.length,1),B(e[0]);let t=e.slice(1),o=F(new Map(e[0].value)),s=qo(...t);for(let[r,i]of s.value.entries())o.value.set(r,i);return o}function Dr(...e){T(e.length,1),B(e[0]);let t=F(new Map(e[0].value));for(let o of e.splice(1))$(o),je(t.value,o);return t}function Lr(...e){n(e.length,2);let t=e[0];if(!b(t))return N();let o=e[1];$(o);let s=We(t.value,o);return s!==void 0?s:N()}function Ir(...e){n(e.length,2);let t=e[0],o=e[1];return B(t),$(o),c(Oe(t.value,o))}function kr(...e){return n(e.length,1),B(e[0]),_e(e[0].value)}function Rr(...e){return n(e.length,1),B(e[0]),g([...e[0].value.values()])}function qr(...e){n(e.length,1);let t=e[0];if(E(t))return a(0);if(b(e[0]))return a(e[0].value.size);if(U(e[0]))return a(e[0].value.length);throw new TypeError("Invalid argument type")}var Uo=[["Math.abs",Ur],["Math.acos",Br],["Math.acosh",Kr],["Math.asin",$r],["Math.asinh",jr],["Math.atan",Or],["Math.atan2",Wr],["Math.atanh",_r],["Math.cbrt",Pr],["Math.ceil",Gr],["Math.clz32",zr],["Math.cos",Qr],["Math.cosh",Jr],["Math.exp",Yr],["Math.expm1",Hr],["Math.floor",Xr],["Math.fround",Zr],["Math.hypot",eu],["Math.imul",tu],["Math.log",ou],["Math.log10",su],["Math.log1p",nu],["Math.log2",ru],["Math.max",uu],["Math.min",pu],["Math.pow",iu],["Math.random",au],["Math.round",yu],["Math.sign",lu],["Math.sin",du],["Math.sinh",cu],["Math.sqrt",Nu],["Math.tan",mu],["Math.tanh",fu],["Math.trunc",Au],["Math.E",vu],["Math.LN10",hu],["Math.LN2",xu],["Math.LOG10E",bu],["Math.LOG2E",gu],["Math.PI",Su],["Math.SQRT1_2",wu],["Math.SQRT2",Cu]];function Ur(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.abs(t);return p(o)}function Br(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.acos(t);return p(o)}function Kr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.acosh(t);return p(o)}function $r(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.asin(t);return p(o)}function jr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.asinh(t);return p(o)}function Or(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.atan(t);return p(o)}function Wr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=e[0].value,o=e[1].value,s=Math.atan2(t,o);return p(s)}function _r(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.atanh(t);return p(o)}function Pr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.cbrt(t);return p(o)}function Gr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.ceil(t);return p(o)}function zr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.clz32(t);return p(o)}function Qr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.cos(t);return p(o)}function Jr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.cosh(t);return p(o)}function Yr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.exp(t);return p(o)}function Hr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.expm1(t);return p(o)}function Xr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.floor(t);return p(o)}function Zr(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.fround(t);return p(o)}function eu(...e){Y(e,ee);let t=e.map(ae),o=Math.hypot(...t);return p(o)}function tu(...e){n(e.length,2),u(e[0]),u(e[1]);let t=e[0].value,o=e[1].value,s=Math.imul(t,o);return p(s)}function ou(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.log(t);return p(o)}function su(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.log10(t);return p(o)}function nu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.log1p(t);return p(o)}function ru(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.log2(t);return p(o)}function uu(...e){Y(e,ee);let t=e.map(ae),o=Math.max(...t);return p(o)}function pu(...e){Y(e,ee);let t=e.map(ae),o=Math.min(...t);return p(o)}function iu(...e){if(e.length===2&&v(e[0])&&v(e[1])){let t=e[0].value,o=e[1].value,s=t**o;return p(s)}throw new TypeError('Invalid arguments to "Math.pow"')}function au(...e){if(e.length===0){let t=Math.random();return p(t)}throw new TypeError('Invalid arguments to "Math.random"')}function yu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.round(t);return p(o)}function lu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.sign(t);return p(o)}function du(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.sin(t);return p(o)}function cu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.sinh(t);return p(o)}function Nu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.sqrt(t);return p(o)}function mu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.tan(t);return p(o)}function fu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.tanh(t);return p(o)}function Au(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.trunc(t);return p(o)}function vu(...e){if(e.length===0)return p(Math.E);throw new TypeError('Invalid arguments to "Math.E"')}function hu(...e){if(e.length===0)return p(Math.LN10);throw new TypeError('Invalid arguments to "Math.LN10"')}function xu(...e){if(e.length===0)return p(Math.LN2);throw new TypeError('Invalid arguments to "Math.LN2"')}function bu(...e){if(e.length===0)return p(Math.LOG10E);throw new TypeError('Invalid arguments to "Math.LOG10E"')}function gu(...e){if(e.length===0)return p(Math.LOG2E);throw new TypeError('Invalid arguments to "Math.LOG2E"')}function Su(...e){if(e.length===0)return p(Math.PI);throw new TypeError('Invalid arguments to "Math.PI"')}function wu(...e){if(e.length===0)return p(Math.SQRT1_2);throw new TypeError('Invalid arguments to "Math.SQRT1_2"')}function Cu(...e){if(e.length===0)return p(Math.SQRT2);throw new TypeError('Invalid arguments to "Math.SQRT2"')}var Bo=[["Number",Mu],["Number.isFinite",Eu],["Number.isInteger",Tu],["Number.isNaN",Vu],["Number.isSafeInteger",Fu],["Number.parseFloat",Du],["Number.parseInt",Lu],["Number.prototype.toExponential",ju],["Number.prototype.toFixed",Ou],["Number.prototype.toPrecision",Wu],["Number.prototype.toString",_u],["Number.EPSILON",Iu],["Number.MAX_SAFE_INTEGER",ku],["Number.MAX_VALUE",Ru],["Number.MIN_SAFE_INTEGER",qu],["Number.MIN_VALUE",Uu],["Number.NaN",Bu],["Number.NEGATIVE_INFINITY",Ku],["Number.POSITIVE_INFINITY",$u]];function Mu(...e){if(e.length===1&&G(e[0])){let t=e[0].value,o=Number(t);return p(o)}throw new TypeError('Invalid arguments to "Number"')}function Eu(...e){if(e.length===1&&G(e[0])){let t=e[0].value,o=Number.isFinite(t);return p(o)}throw new TypeError('Invalid arguments to "Number.isFinite"')}function Tu(...e){if(e.length===1&&G(e[0])){let t=e[0].value,o=Number.isInteger(t);return p(o)}throw new TypeError('Invalid arguments to "Number.isInteger"')}function Vu(...e){if(e.length===1&&G(e[0])){let t=e[0].value,o=Number.isNaN(t);return p(o)}throw new TypeError('Invalid arguments to "Number.isNaN"')}function Fu(...e){if(e.length===1&&G(e[0])){let t=e[0].value,o=Number.isSafeInteger(t);return p(o)}throw new TypeError('Invalid arguments to "Number.isSafeInteger"')}function Du(...e){n(e.length,1),l(e[0]);let t=ge(e[0]),o=Number.parseFloat(t);return p(o)}function Lu(...e){A(e.length,1,2),l(e[0]);let t=e[0].value;if(e.length===2){u(e[1]);let s=e[1].value,r=Number.parseInt(t,s);return a(r)}let o=Number.parseInt(t);return a(o)}function Iu(...e){if(e.length===0){let t=Number.EPSILON;return p(t)}throw new TypeError('Invalid arguments to "Number.EPSILON"')}function ku(...e){if(e.length===0){let t=Number.MAX_SAFE_INTEGER;return p(t)}throw new TypeError('Invalid arguments to "Number.MAX_SAFE_INTEGER"')}function Ru(...e){if(e.length===0){let t=Number.MAX_VALUE;return p(t)}throw new TypeError('Invalid arguments to "Number.MAX_VALUE"')}function qu(...e){if(e.length===0){let t=Number.MIN_SAFE_INTEGER;return p(t)}throw new TypeError('Invalid arguments to "Number.MIN_SAFE_INTEGER"')}function Uu(...e){if(e.length===0){let t=Number.MIN_VALUE;return p(t)}throw new TypeError('Invalid arguments to "Number.MIN_VALUE"')}function Bu(...e){if(e.length===0){let t=Number.NaN;return p(t)}throw new TypeError('Invalid arguments to "Number.NaN"')}function Ku(...e){if(e.length===0){let t=Number.NEGATIVE_INFINITY;return p(t)}throw new TypeError('Invalid arguments to "Number.NEGATIVE_INFINITY"')}function $u(...e){if(e.length===0){let t=Number.POSITIVE_INFINITY;return p(t)}throw new TypeError('Invalid arguments to "Number.POSITIVE_INFINITY"')}function ju(...e){if(A(e.length,1,2),u(e[0]),e.length===2){u(e[1]);let o=e[1].value,s=e[0].value.toExponential(o);return d(s)}let t=e[0].value.toExponential();return d(t)}function Ou(...e){if(A(e.length,1,2),u(e[0]),e.length===2){u(e[1]);let o=e[1].value,s=e[0].value.toFixed(o);return d(s)}let t=e[0].value.toFixed();return d(t)}function Wu(...e){if(A(e.length,1,2),u(e[0]),e.length===2){u(e[1]);let o=e[1].value,s=e[0].value.toPrecision(o);return d(s)}let t=e[0].value.toPrecision();return d(t)}function _u(...e){if(A(e.length,1,2),u(e[0]),e.length===2){u(e[1]);let o=e[1].value,s=e[0].value.toString(o);return d(s)}let t=e[0].value.toString();return d(t)}var Ko=[["neq",op],["nullish",rp],["power",up],["remainder",zu],["rshift",Zu],["lshift",Xu],["rshift-unsigned",ep],["bit-and",Qu],["bit-or",Ju],["bit-xor",Yu],["bit-not",Hu],["and",Pu],["or",Gu],["not",tp],["inc",sp],["dec",np]];function Pu(...e){for(let o of e)if(!Ke(o,!0))return c(!1);return c(!0)}function Gu(...e){for(let t of e)if(Ke(t))return c(!0);return c(!1)}function zu(e,t){if(v(e)&&v(t))return a((e.value%t.value+t.value)%t.value);throw new TypeError("not a number")}function Qu(e,t){if(v(e)&&v(t))return a(e.value&t.value);throw new TypeError("not a number")}function Ju(e,t){if(v(e)&&v(t))return a(e.value|t.value);throw new TypeError("not a number")}function Yu(e,t){if(v(e)&&v(t))return a(e.value^t.value);throw new TypeError("not a number")}function Hu(e){if(v(e))return a(~e.value);throw new TypeError("not a number")}function Xu(e,t){if(v(e)&&v(t))return a(e.value<<t.value);throw new TypeError("not a number")}function Zu(e,t){if(v(e)&&v(t))return a(e.value>>t.value);throw new TypeError("not a number")}function ep(e,t){if(v(e)&&v(t))return a(e.value>>>t.value);throw new TypeError("not a number")}function tp(e){return c(!e.value)}function op(...e){n(e.length,2);let t=oe(e[0],e[1]);return c(!t.value)}function sp(...e){A(e.length,1,2),u(e[0]);let t="postfix";if(e[1]!==void 0){if(l(e[1]),e[1].value!=="prefix"&&e[1].value!=="postfix")throw new TypeError(`Invalid affix ${String(e[1].value)}. The affix must be "prefix" or "postfix"`);t=e[1].value}if(t==="postfix")return m([a(e[0].value+1),a(e[0].value)]);if(t==="prefix")return m([a(e[0].value+1),a(e[0].value+1)]);throw new Error("Unhandled error in decrement")}function np(...e){A(e.length,1,2),u(e[0]);let t="postfix";if(e[1]!==void 0){if(l(e[1]),e[1].value!=="prefix"&&e[1].value!=="postfix")throw new TypeError(`Invalid affix ${String(e[1].value)}. The affix must be "prefix" or "postfix"`);t=e[1].value}if(t==="postfix")return m([a(e[0].value-1),a(e[0].value)]);if(t==="prefix")return m([a(e[0].value-1),a(e[0].value-1)]);throw new Error("Unhandled error in decrement")}function rp(e,t){return e.value==null?t:e}function up(e,t){if(v(e)&&v(t))return a(e.value**t.value);throw new TypeError("not a number")}var $o=[["RegExp.new",pp],["RegExp.prototype.exec",ip],["RegExp.prototype.test",ap]];function pp(...e){A(e.length,1,2),l(e[0]);let t=e[0].value;if(e.length===2){l(e[1]);let s=e[1].value,r=new RegExp(t,s);return pe(r)}let o=new RegExp(t);return pe(o)}function ip(...e){n(e.length,2),O(e[0]);let t=e[0].value;ue(t),l(e[1]);let o=e[1].value,s=t.exec(o);return s?m(s.map(p)):N()}function ap(...e){n(e.length,2),O(e[0]),ue(e[0].value),l(e[1]);let t=e[0].value.test(e[1].value);return c(t)}var Wo=[["String",ye.printUnescapedString],["String.fromCharCode",yp],["String.fromCodePoint",lp],["String.prototype.at",jo],["String.prototype.charAt",jo],["String.prototype.charCodeAt",Oo],["String.prototype.codePointAt",Oo],["String.prototype.concat",dp],["String.prototype.endsWith",cp],["String.prototype.includes",Np],["String.prototype.indexOf",mp],["String.prototype.isWellFormed",fp],["String.prototype.lastIndexOf",Ap],["String.prototype.length",vp],["String.prototype.localeCompare",hp],["String.prototype.match",xp],["String.prototype.matchAll",bp],["String.prototype.normalize",gp],["String.prototype.padEnd",Sp],["String.prototype.padStart",wp],["String.prototype.repeat",Cp],["String.prototype.replace",Mp],["String.prototype.replaceAll",Ep],["String.prototype.search",Tp],["String.prototype.slice",Vp],["String.prototype.split",Fp],["String.prototype.startsWith",Dp],["String.prototype.toLocaleLowerCase",Lp],["String.prototype.toLocaleUpperCase",Ip],["String.prototype.toLowerCase",kp],["String.prototype.toUpperCase",Rp],["String.prototype.toWellFormed",qp],["String.prototype.trim",Up],["String.prototype.trimEnd",Bp],["String.prototype.trimStart",Kp],["String.raw",$p]];function yp(...e){n(e.length,1),x(e[0]),Y(e[0].value,ee);let t=e[0].value.map(ae),o=String.fromCharCode(...t);return d(o)}function lp(...e){Y(e,ee);let t=e.map(ae),o=String.fromCodePoint(...t);return d(o)}function jo(...e){n(e.length,2),l(e[0]),u(e[1]);let t=String.prototype.at.call(e[0].value,e[1].value);return t===void 0?N():d(t)}function Oo(...e){n(e.length,2),l(e[0]),u(e[1]);let t=String.prototype.codePointAt.call(e[0].value,e[1].value);return t===void 0?N():a(t)}function dp(...e){T(e.length,2),Y(e,ce);let t=e[0].value,o=e.slice(1).map(ge),s=String.prototype.concat.call(t,...o);return d(s)}function cp(...e){A(e.length,2,3),l(e[0]),l(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.endsWith.call(t,o,s);return p(r)}function Np(...e){A(e.length,2,3),l(e[0]),l(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.includes.call(t,o,s);return p(r)}function mp(...e){A(e.length,2,3),l(e[0]),l(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.indexOf.call(t,o,s);return p(r)}function fp(...e){n(e.length,1),l(e[0]);let t=e[0].value,o=String.prototype.isWellFormed.call(t);return p(o)}function Ap(...e){A(e.length,2,3),l(e[0]),l(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.lastIndexOf.call(t,o,s);return p(r)}function vp(...e){n(e.length,1),f(e[0]);let o=e[0].value.length;return p(o)}function hp(...e){A(e.length,2,4),l(e[0]),l(e[1]);let t=e[0].value,o=e[1].value,s,r;if(e.length>2){let y=e[2];w(y)?s=y.value:D(y)?(Y(y.value,ce),s=y.value.map(ge)):(ct(y),s=void 0)}if(e.length>3){let y=e[3];B(y),r=Ge(y)}let i=String.prototype.localeCompare.call(t,o,s,r);return p(i)}function xp(...e){n(e.length,2),l(e[0]),O(e[1]),ue(e[1].value);let t=e[0].value,o=e[1].value,s=String.prototype.match.call(t,o);return p(s)}function bp(...e){n(e.length,2),l(e[0]),O(e[1]),ue(e[1].value);let t=e[0].value,o=e[1].value,s=String.prototype.matchAll.call(t,o);return p(s)}function gp(...e){A(e.length,1,2),f(e[0]),e.length===2&&l(e[1]);let t=e[0].value,o=e.length===2?e[1].value:void 0,s=String.prototype.normalize.call(t,o);return p(s)}function Sp(...e){A(e.length,2,3),f(e[0]),u(e[1]),e.length===3&&l(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.padEnd.call(t,o,s);return p(r)}function wp(...e){A(e.length,2,3),f(e[0]),u(e[1]),e.length===3&&l(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.padStart.call(t,o,s);return p(r)}function Cp(...e){n(e.length,2),l(e[0]),u(e[1]);let t=e[0].value,o=e[1].value,s=String.prototype.repeat.call(t,o);return p(s)}function Mp(...e){n(e.length,3),l(e[0]);let t="";w(e[1])||(O(e[1]),ue(e[1].value)),t=e[1].value;let o;if(w(e[2]))o=e[2].value;else throw new Error("Function replacers are not implemented for String.prototype.replace");let r=e[0].value.replace(t,o);return p(r)}function Ep(...e){n(e.length,3),l(e[0]);let t="";w(e[1])||(O(e[1]),ue(e[1].value)),t=e[1].value;let o;if(w(e[2]))o=e[2].value;else throw new Error("Function replacers are not implemented for String.prototype.replaceAll");let r=e[0].value.replaceAll(t,o);return p(r)}function Tp(...e){n(e.length,2),l(e[0]),O(e[1]),ue(e[1].value);let t=e[0].value,o=e[1].value,s=String.prototype.search.call(t,o);return p(s)}function Vp(...e){A(e.length,1,3),f(e[0]),e.length>1&&u(e[1]),e.length>2&&u(e[2]);let t=e[0].value,o=e.length>1?e[1].value:void 0,s=e.length>2?e[2].value:void 0,r=String.prototype.slice.call(t,o,s);return p(r)}function Fp(...e){A(e.length,2,3),l(e[0]),l(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=t.split(o,s);return p(r)}function Dp(...e){A(e.length,2,3),f(e[0]),l(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length>2?e[2].value:void 0,r=String.prototype.startsWith.call(t,o,s);return p(r)}function Lp(...e){A(e.length,1,2),f(e[0]),e.length===2&&(E(e[1])||l(e[1]));let t=e[0].value,o=e.length===2&&!E(e[1])?e[1].value:void 0,s=String.prototype.toLocaleLowerCase.call(t,o);return p(s)}function Ip(...e){A(e.length,1,2),f(e[0]),e.length===2&&(E(e[1])||l(e[1]));let t=e[0].value,o=e.length===2&&!E(e[1])?e[1].value:void 0,s=String.prototype.toLocaleUpperCase.call(t,o);return p(s)}function kp(...e){n(e.length,1),f(e[0]);let t=e[0].value,o=String.prototype.toLowerCase.call(t);return p(o)}function Rp(...e){n(e.length,1),f(e[0]);let t=e[0].value,o=String.prototype.toUpperCase.call(t);return p(o)}function qp(...e){n(e.length,1),f(e[0]);let t=e[0].value,o=String.prototype.toWellFormed.call(t);return p(o)}function Up(...e){n(e.length,1),f(e[0]);let t=e[0].value,o=String.prototype.trim.call(t);return p(o)}function Bp(...e){n(e.length,1),f(e[0]);let t=e[0].value,o=String.prototype.trimEnd.call(t);return p(o)}function Kp(...e){n(e.length,1),f(e[0]);let t=e[0].value,o=String.prototype.trimStart.call(t);return p(o)}function $p(...e){n(e.length,2),B(e[0]),x(e[1]);let t=Ge(e[0]),o=e[1].value,s=String.raw(t,...o);return p(s)}var _o=[["Symbol",jp],["Symbol.for",Op],["Symbol.keyFor",Wp]];function jp(...e){A(e.length,0,1),e.length===1&&l(e[0]);let t=e.length===1?e[0].value:void 0,o=Symbol(t);return pe(o)}function Op(...e){n(e.length,1),l(e[0]);let t=e[0].value,o=Symbol.for(t);return pe(o)}function Wp(...e){n(e.length,1),O(e[0]),Nt(e[0].value);let t=e[0].value,o=Symbol.keyFor(t);return o?d(o):N()}var _p=[...To,...Vo,...Fo,...Ko,...Do,...Lo,...ko,...Ro,...Uo,...Bo,...$o,...Wo,..._o],Ve=new Map;for(let[e,t]of _p)if(Ve.set(S(e),k(t)),e.includes(".prototype.")){let o=e.replace(".prototype.","::");Ve.set(S(o),k(t))}else if(e.includes(".prototype[")){let o=e.replace(".prototype[","::[");Ve.set(S(o),k(t))}function Pp(e){W(e),A(e.value.length,2,3);let t=e.value[0];if(K(t),t.value!=="try"&&t.value!=="try*")throw new Error("use `try` or `try*` in try/catch expressions");if(f(e.value[1]),e.value[2]){W(e.value[2]),n(e.value[2].value.length,3),K(e.value[2].value[0]);let o=e.value[2].value[0];if(o.value!=="catch"&&o.value!=="catch*")throw new Error("use `catch` or `catch*` in try/catch expressions");K(e.value[2].value[1]),f(e.value[2].value[2])}}function Gp(e){W(e),n(e.value.length,3),K(e.value[0]);let t=e.value[0];if(t.value!=="def!"&&t.value!=="globalThis"&&t.value!=="var")throw new Error("use `def!`, `globalThis`, or `var` in def! expressions");$(e.value[1]),f(e.value[2])}function zp(e){W(e),n(e.value.length,3),K(e.value[0]);let t=e.value[0];if(t.value!=="let*"&&t.value!=="let"&&t.value!=="const")throw new Error("use `let*`, `let`, or `const` in let* expressions");J(e.value[1]),f(e.value[2]),be(e.value[1].value.length);for(let o=0;o<e.value[1].value.length;o+=2)K(e.value[1].value[o]),f(e.value[1].value[o+1])}function Qp(e){W(e),n(e.value.length,2),K(e.value[0]),me(e.value[0],"quote"),f(e.value[1])}function Jp(e){let t="quasiquoteexpand";W(e),n(e.value.length,2),K(e.value[0]),me(e.value[0],t),f(e.value[1])}function Yp(e){let t="quasiquote";W(e),n(e.value.length,2),K(e.value[0]),me(e.value[0],t),f(e.value[1])}function Hp(e){let t="defmacro!";W(e),n(e.value.length,3),K(e.value[0]),me(e.value[0],t),$(e.value[1]),f(e.value[2])}function Xp(e){let t="do";W(e),T(e.value.length,1),K(e.value[0]),me(e.value[0],t);for(let o of e.value.slice(1))f(o)}function Zp(e){let t="if";W(e),A(e.value.length,3,4),K(e.value[0]),me(e.value[0],t),f(e.value[1]),f(e.value[2]),we(e.value[3])&&f(e.value[3])}function ei(e){W(e),n(e.value.length,3),K(e.value[0]);let t=e.value[0];if(!["fn*","function","=>"].includes(t.value))throw new Error("use `fn*`, `function`, of `=>` in fn* expressions");J(e.value[1]),Y(e.value[1].value,de),f(e.value[2])}function ti(e){return Ye(e)}function yt(e){if(b(e)||I(e))return g([S("quote"),e]);if(!U(e))return e;if(tt(e,"unquote"))return e.value[1];let s=g([]);for(let r=e.value.length-1;r>=0;r--){let i=e.value[r];s=tt(i,"splice-unquote")?g([S("concat"),i.value[1],s]):g([S("cons"),yt(i),s])}return D(e)&&(s=g([S("vec"),s])),s}function oi(e,t){if(!M(e)||!(e.value[0]instanceof de))return!1;let o=e.value[0],s=t.findEnv(o);if(!we(s))return!1;let r=s.get(o);return R(r)?r.isMacro:!1}function Go(e,t){let o=e;for(;oi(o,t);){let s=o,r=s.value[0];o=t.get(r).value(...s.value.slice(1))}return o}function at(e,t){if(I(e))return t.get(e);if(D(e)){let o=e.value.map(s=>_(s,t));return m(o)}if(M(e)){let o=e.value.map(s=>_(s,t));return g(o)}if(b(e)){let o=new Map;for(let[s,r]of e.value.entries())o.set(s,_(r,t));return F(o)}if(se(e)){let o=e.value,s=Array.from(e.attributes).reduce((i,[y,h])=>i.set(y,_(h,t)),new Map),r=e.children.map(i=>_(i,t));return xe(o,s,r)}return e}function _(e,t){for(;;){if(M(e)===!1)return at(e,t);if(e.value.length===0)return e;if(e=Go(e,t),M(e)===!1)return at(e,t);if(e.value.length===0)return e;let o=I(e.value[0])?e.value[0].value:"goto_default_clause",s;switch(o){case"var":case"def!":{s=si(e,t);break}case"let":case"const":case"let*":{s=ni(e,t);break}case"quote":{s=ri(e,t);break}case"quasiquoteexpand":{s=ui(e,t);break}case"quasiquote":{s=pi(e,t);break}case"defmacro!":{s=ii(e,t);break}case"macroexpand":{s=ie(Go(e.value[1],t));break}case"try":case"try*":{s=yi(e,t);break}case"do":{s=ai(e,t);break}case"if":{s=li(e,t);break}case"=>":case"function":case"fn*":{s=di(e,t);break}default:s=ci(e,t)}if(s.return)return s.return;e=s.continue.ast,t=s.continue.env}}function si(e,t){Gp(e);let o=e.value[1],s=e.value[2],r=_(s,t);return ie(t.set(o,r))}function ni(e,t){zp(e);let o=e.value[1],s=o.value.length,r=new ne(t);for(let i=0;i<s;i+=2){let y=o.value[i],h=o.value[i+1],V=_(h,r);r.set(y,V)}return Ce(e.value[2],r)}function ri(e,t){return Qp(e),ie(e.value[1])}function ui(e,t){return Jp(e),ie(yt(e.value[1]))}function pi(e,t){Yp(e);let o=yt(e.value[1]);return Ce(o,t)}function ii(e,t){Hp(e);let o=e.value[1],s=e.value[2],r=_(s,t),i=j(r);return R(i)&&(i.isMacro=!0),ie(t.set(o,i))}function ai(e,t){Xp(e);let o=N();for(let s=1;s<e.value.length;s++)o=_(e.value[s],t);return{continue:{ast:o,env:t},return:void 0}}function yi(e,t){Pp(e);try{return{return:_(e.value[1],t),continue:void 0}}catch(o){if(!e.value[2])throw o;let s=e.value[2].value[1],r=e.value[2].value[2],i;X(o)?i=o:o instanceof Error?i=d(o.message):i=d(JSON.stringify(o));let y=P(i),h=new ne(t,[s],[y]);return{return:_(r,h),continue:void 0}}}function li(e,t){Zp(e);let o=e.value[1],s=_(o,t);if(s.value!==!1&&s.value!==null){let r=e.value[2];return Ce(r,t)}if(e.value[3]!==void 0){let r=e.value[3];return Ce(r,t)}return ie(N())}function di(e,t){ei(e);let o=e.value[1].value,s=e.value[2],r=t,y=k((...h)=>{let V=new ne(r,o,h);return _(s,V)},{ast:s,env:r,parameters:o});return ie(y)}function ci(e,t){let o=at(e,t);W(o);let s=o.value[0];if(R(s)){let r=o.value.slice(1);if(s.closureMeta){let y=s.closureMeta.ast,h=new ne(s.closureMeta.env,s.closureMeta.parameters,r);return{continue:{ast:y,env:h},return:void 0}}return{return:s.value(...r),continue:void 0}}return{return:s,continue:void 0}}function Ni(e){return q(e,!0)}function le(e,t){return Ni(_(ti(e),t))}function zo(){let e=new ne(void 0);for(let[t,o]of ye.ns.entries())e.set(t,o);for(let[t,o]of Ve.entries())e.set(t,o);for(let[t,o]of Xe.entries())e.set(t,o);return e.set(S("eval"),k((...t)=>(n(t.length,1),_(t[0],e)))),e.set(S("dump"),k((...t)=>{let o=e.serialize();return console.log(q(o,!0)),N()})),le("(def! not (fn* (a) (if a false true)))",e),le(`(defmacro! cond
      (fn* (& xs)
       (if (gt (count xs) 0) (list 'if (first xs)
                                  (if (gt (count xs) 1) (nth xs 1)
                                      (throw "odd number of forms to cond"))
                                  (cons 'cond (rest (rest xs)))))))`,e),e}var Jo="user> ";function Yo(e,t){let o=null;try{o=re.open(t,"w"),o!==null&&o.puts(e)}catch(s){throw o!==null&&o.close(),new Error(`Error writing to file: ${s}`)}}function lt(...e){n(e.length,1);let t=e[0];l(t);let o=Xo(t.value);return o==null?N():d(o)}function Ho(...e){n(e.length,1),l(e[0]);let t=[],[o,s]=Qo.readdir(e[0].value);if(+s>0)throw new Error(`Error reading directory: ${s}`);for(let r of o)r==="."||r===".."||t.push(d(r));return m(t)}function Ze(...e){n(e.length,1);let t=e[0];l(t);let o=re.loadFile(t.value);if(o===null)throw new Error("No such file or directory. xxx");return d(o)}function dt(...e){n(e.length,2);let t=e[0];l(t);let o=e[1];return l(o),Yo(o.value,t.value),N()}function Xo(e=Jo){re.out.puts(e);let t=re.in.getline()?.trim();console.log(t),console.log(e)}function*Zo(e=Jo){for(;;){re.out.puts(e);let t=re.in.getline()?.trim();t&&(yield t)}}function es(e){return function(...o){n(o.length,1),l(o[0]);let s=Ze(o[0]);l(s);let r=new ne(e),i=le(`(do ${s.value})
nil`,r);return d(i)}}function ts(){let e=zo(),t=es(e),o=[["readFile",Ze],["slurp",Ze],["load-file",t],["import",t],["readln",lt],["prompt",lt],["readir",Ho],["spit",dt],["writeFile",dt]];for(let[s,r]of o)e.set(S(s),k(r));return e}function os(e=""){return e.replace(/\\/g,"/")}async function mi(...e){let t=ts(),o=os(e[0]),s=e.slice(1).map(r=>d(r));if(t.set(S("*ARGV*"),g(s)),t.set(S("*host-language*"),d("Ensemble")),o){le(`(import "${o}")`,t);return}le('(println (str "Welcome to " *host-language* "! Press Ctrl/Cmd+C to exit."))',t);for await(let r of Zo("user> "))if(!(r===""||r===null))try{let i=le(r,t);console.log(i)}catch(i){X(i)?console.log(`error: ${q(i,!1)}`):i instanceof Error&&console.log(i)}}var ss={displayPrompt:Xo,initMain:ts,loadFileWithEnv:es,main:mi,readir:Ho,readline:Zo,readln:lt,rep:le,slurp:Ze,spit:dt,toPosixPath:os,writeToFile:Yo};ss.main(...scriptArgs);
