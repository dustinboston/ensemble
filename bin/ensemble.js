var Vs=Object.defineProperty;var Fs=(e,t)=>{for(var o in t)Vs(e,o,{get:t[o],enumerable:!0})};import*as vs from"qjs:os";import*as ie from"qjs:std";var V={};Fs(V,{AtomNode:()=>Ee,BooleanNode:()=>Te,DomNode:()=>Ve,ErrorNode:()=>fe,FunctionNode:()=>Fe,KeywordNode:()=>De,ListNode:()=>Ae,MapNode:()=>Le,NilNode:()=>Ie,NumberNode:()=>ee,StringNode:()=>de,SymbolNode:()=>le,VectorNode:()=>ve,append:()=>Ws,assertArgumentCount:()=>n,assertAstNode:()=>N,assertAtomNode:()=>W,assertBooleanNode:()=>Is,assertDefined:()=>Re,assertDomNode:()=>Ls,assertEq:()=>Rs,assertEqual:()=>ft,assertErrorNode:()=>ke,assertEvenArgumentCount:()=>xe,assertFunctionNode:()=>C,assertGreaterThanEqual:()=>js,assertIsOneOf:()=>Ks,assertKeywordNode:()=>ks,assertListNode:()=>_,assertMapKeyNode:()=>$,assertMapNode:()=>B,assertMetadataType:()=>Ge,assertMinimumArgumentCount:()=>T,assertNilNode:()=>tt,assertNullOrUndefined:()=>qs,assertNumberNode:()=>u,assertRegExp:()=>ne,assertSequential:()=>H,assertSequentialValues:()=>X,assertStringNode:()=>y,assertSymWithValue:()=>Ne,assertSymbol:()=>ot,assertSymbolNode:()=>K,assertTrue:()=>Bs,assertUndefined:()=>Us,assertVariableArgumentCount:()=>A,assertVectorNode:()=>h,continueResult:()=>we,convertMapKeyToString:()=>Z,convertStringToMapKey:()=>st,copy:()=>O,copyAtomNode:()=>At,copyBooleanNode:()=>vt,copyDomNode:()=>xt,copyErrorNode:()=>bt,copyFunctionNode:()=>gt,copyKeywordNode:()=>St,copyListNode:()=>wt,copyMapNode:()=>ht,copyNilNode:()=>Ct,copyNumberNode:()=>Mt,copyStringNode:()=>Et,copySymbolNode:()=>Tt,copyVectorNode:()=>Vt,createAtomNode:()=>re,createBooleanNode:()=>c,createDomNode:()=>he,createErrorNode:()=>k,createFunctionNode:()=>R,createKeywordNode:()=>ce,createListNode:()=>b,createMapNode:()=>F,createNilNode:()=>f,createNumberNode:()=>a,createStringNode:()=>d,createSymbolNode:()=>S,createVectorNode:()=>m,deleteMapElement:()=>Be,getBareMapKey:()=>Ce,getMapElement:()=>$e,getMapKeys:()=>je,getMapValues:()=>_s,hasMapElement:()=>Ke,htmlEncode:()=>Gs,isAstNode:()=>P,isAstTruthy:()=>Ue,isAtomNode:()=>se,isBooleanNode:()=>J,isDefined:()=>Se,isDomNode:()=>oe,isEqualTo:()=>te,isErrorNode:()=>Y,isFunctionNode:()=>U,isKeywordNode:()=>G,isListNode:()=>M,isMapKeyNode:()=>mt,isMapNode:()=>g,isNilNode:()=>E,isNumberNode:()=>v,isSameClass:()=>Nt,isSequentialNode:()=>q,isStringNode:()=>w,isSymbolNode:()=>I,isTypedVector:()=>$s,isVectorNode:()=>D,listStartsWithSymbol:()=>ze,mapFlat:()=>Qe,normalizeWhitespace:()=>zs,prepend:()=>Os,returnResult:()=>ae,setMapElement:()=>qe,slash:()=>Oe,splitAtFirstDot:()=>Ps,toAst:()=>p,toErrorNode:()=>Js,unwrap:()=>z,unwrapAtomNode:()=>Ft,unwrapBooleanNode:()=>Dt,unwrapDomNode:()=>Qs,unwrapErrorNode:()=>Lt,unwrapFunctionNode:()=>It,unwrapKeywordNode:()=>kt,unwrapListNode:()=>Rt,unwrapMapNode:()=>We,unwrapNilNode:()=>Ut,unwrapNumberNode:()=>ye,unwrapStringNode:()=>be,unwrapSymbolNode:()=>qt,unwrapVectorNode:()=>Bt});var Ee=class{constructor(t){this.value=t}},Te=class{constructor(t){this.value=t}},Ve=class{constructor(t,o=new Map,s=[],r){this.value=t;this.attributes=o;this.children=s;this.metadata=r}},Ds=["Error","AggregateError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],fe=class e{constructor(t,o,s=f()){this.value=t;o!==void 0&&e.isErrorName(o)&&(this.name=o),s!==void 0&&(this.cause=s)}name=d("Error");cause;static isErrorName(t){let o=t.value;return Ds.includes(o)}static assertErrorName(t){if(!e.isErrorName(t))throw new TypeError("Error type must be 'Error', 'AggregateError', 'RangeError', 'ReferenceError', 'SyntaxError', 'TypeError', or 'URIError'.")}},Fe=class{constructor(t,o,s=!1,r){this.value=t;this.closureMeta=o;this.isMacro=s;this.metadata=r}},De=class{constructor(t){this._value=t;this._value=t.replaceAll(":","")}get value(){return this._value+":"}set value(t){this._value=t.replaceAll(":","")+":"}get bare(){return this._value}},Ae=class{constructor(t,o){this.value=t;this.metadata=o}},Le=class{constructor(t=new Map,o){this.value=t;this.metadata=o}},Ie=class{constructor(t=null){this.value=t}},ee=class{constructor(t){this.value=t}},le=class{constructor(t){this.value=t}},de=class{constructor(t){this.value=t}},ve=class{constructor(t,o){this.value=t;this.metadata=o}};function Ls(e){if(!oe(e))throw new TypeError("Invalid DomNode")}function N(e){if(!P(e))throw new TypeError("Invalid AstNode")}function W(e){if(!se(e))throw new TypeError("Invalid AtomNode")}function Is(e){if(!J(e))throw new TypeError("Invalid BooleanNode")}function B(e){if(!g(e))throw new TypeError("Invalid MapNode")}function ke(e){if(!Y(e))throw new TypeError("Invalid ErrorNode")}function C(e){if(!U(e))throw new TypeError("Invalid FunctionNode")}function ks(e){if(!G(e))throw new TypeError("Invalid KeywordNode")}function _(e){if(!M(e))throw new TypeError("Invalid ListNode")}function tt(e){if(!E(e))throw new TypeError("Invalid NilNode")}function u(e){if(!v(e))throw new TypeError("Invalid NumberNode")}function y(e){if(!w(e))throw new TypeError("Invalid StringNode")}function K(e){if(!I(e))throw new TypeError("Invalid SymbolNode")}function h(e){if(!D(e))throw new TypeError("Invalid VectorNode")}function ne(e){if(!(e instanceof RegExp))throw new Error("Expected a RegExp object.")}function ot(e){if(typeof e!="symbol")throw new Error("Expected a Symbol object.")}function he(e,t,o,s){return new Ve(e,t,o,s)}function re(e){return new Ee(e)}function c(e){return new Te(e)}function F(e,t){return new Le(e,t)}function k(e,t,o){return N(e),new fe(e,t,o)}function R(e,t,o,s){return new Fe(e,t,o,s)}function ce(e){return new De(e)}function b(e,t){return new Ae(e,t)}function f(e){return new Ie(e)}function a(e){return new ee(e)}function d(e){return new de(e)}function S(e){return new le(e)}function m(e=[],t){return new ve(e,t)}function oe(e){return e instanceof Ve}function P(e){return se(e)||J(e)||oe(e)||Y(e)||U(e)||G(e)||M(e)||g(e)||E(e)||v(e)||w(e)||I(e)||D(e)}function se(e){return e instanceof Ee}function J(e){return e instanceof Te&&typeof e.value=="boolean"}function g(e){return e instanceof Le&&e.value instanceof Map}function Y(e){return e instanceof fe&&P(e.value)}function U(e){return e instanceof Fe&&typeof e.value=="function"}function G(e){return e instanceof De&&typeof e.value=="string"&&e.value.endsWith(":")}function M(e){return e instanceof Ae&&e.value.every(P)}function E(e){return e instanceof Ie&&e.value===null}function v(e){return e instanceof ee&&typeof e.value=="number"}function w(e){return e instanceof de&&typeof e.value=="string"}function I(e){return e instanceof le&&typeof e.value=="string"}function D(e){return e instanceof ve&&e.value.every(P)}function Nt(e,t){return Object.getPrototypeOf(e)===Object.getPrototypeOf(t)}function Rs(e,t){if(!te(e,t))throw new Error("Values are not equal")}function Re(e){if(e===void 0)throw new Error("Value is undefined")}function Us(e){if(e!==void 0)throw new Error("Value is not undefined")}function qs(e){if(e!=null)throw new Error("Value is not null or undefined")}function Se(e){return e!==void 0}function Bs(e){if(e===!1)throw new Error("Value is not true")}function Ue(e,t=!1){if(J(e))return e.value;let o=e;return se(o)?P(o.value)?Ue(o.value):!!o.value:E(e)?!1:v(e)?t?!!e.value:!0:!!e.value}function q(e){return M(e)||D(e)}function H(e){if(!M(e)&&!D(e))throw new TypeError("Invalid sequential type")}function $(e){if(!(w(e)||I(e)||G(e)))throw new TypeError("Invalid dictionary key")}function mt(e){return w(e)||I(e)||G(e)}function Ge(e){if(!U(e)&&!M(e)&&!D(e)&&!g(e)&&!oe(e))throw new TypeError("Invalid metadata type")}function n(e,t,o){if(e!==t){let s=`Wanted ${t} arguments but got ${e}`;throw o&&(s+=` ${o}`),new Error(s)}}function A(e,t,o){if(e<t||e>o)throw new Error("Unexpected number of arguments")}function T(e,t){if(e<t)throw new Error("Unexpected minimum number of arguments")}function xe(e){if(e%2!==0)throw new Error("Uneven number of arguments")}function X(e,t){for(let o of e)if(!(o instanceof t))throw new TypeError("All values must be of the same type")}function Ks(e,t){if(!t.some(o=>e instanceof o))throw new TypeError("Invalid type")}function $s(e,t){return e.value.every(o=>o instanceof t)}function te(e,t){if(q(e)&&q(t)){if(e.value.length!==t.value.length)return c(!1);for(let s=0;s<e.value.length;s++)if(!te(e.value[s],t.value[s]).value)return c(!1);return c(!0)}if(g(e)&&g(t)){if(e.value.size!==t.value.size)return c(!1);for(let[s,r]of e.value){let i=t.value.get(s);if(i===void 0||!te(r,i).value)return c(!1)}return c(!0)}if(!Nt(e,t))return c(!1);let o=e.value===t.value;return c(o)}function ze(e,t){let o=M(e)&&I(e.value[0]);return o&&t!==void 0?e.value[0].value===t:o}function ft(e,t){if(e!==t)throw new Error(`Unexpected value '${e}', wanted ${t}`)}function js(e,t){if(e>=t)throw new Error("Unexpected value")}function Ne(e,t){ft(e.value,t)}function we(e,t){return{continue:{ast:e,env:t},return:void 0}}function ae(e){return{continue:void 0,return:e}}var Os=(e,t)=>[t,...e],Ws=(e,t)=>[...e,t];function O(e){if(se(e))return At(e);if(J(e))return vt(e);if(g(e))return ht(e);if(Y(e))return bt(e);if(U(e))return gt(e);if(G(e))return St(e);if(M(e))return wt(e);if(E(e))return Ct(e);if(v(e))return Mt(e);if(w(e))return Et(e);if(I(e))return Tt(e);if(D(e))return Vt(e);if(oe(e))return xt(e);throw new Error("Unmatched object")}function At(e){return re(O(e.value))}function vt(e){return c(e.value)}function ht(e){let t=F(new Map(e.value));return t.metadata=O(e.metadata??f()),t}function xt(e){let t=e.value,o=e.attributes,s=e.children,r=he(t,new Map(o),s.map(O));return r.metadata=O(e.metadata??f()),r}function bt(e){return k(O(e.value))}function gt(e){let t=R(e.value);if(t.isMacro=e.isMacro,t.metadata=O(e.metadata??f()),e.closureMeta){let o=e.closureMeta;t.closureMeta={ast:O(o.ast),env:o.env,parameters:o.parameters.map(s=>S(s.value))}}return t}function St(e){return ce(e.value)}function wt(e){let t=b(e.value.map(o=>O(o)));return t.metadata=O(e.metadata??f()),t}function Ct(e){return f()}function Mt(e){return a(e.value)}function Et(e){return d(e.value)}function Tt(e){return S(e.value)}function Vt(e){let t=m(e.value.map(o=>O(o)));return t.metadata=O(e.metadata??f()),t}function qe(e,t,o){e.set(Z(t),o)}function Be(e,t){e.delete(Z(t))}function Ke(e,t){return e.has(Z(t))}function $e(e,t){return e.get(Z(t))}function je(e){let t=[...e.keys()];return b(t.map(o=>st(o)))}function Z(e){let t=e;if(G(t))return t.value;let o=e;return w(o)?`"${o.value}"`:e.value}function st(e){return e.endsWith(":")?ce(e):e.startsWith('"')?d(e.slice(1,-1)):S(e)}function Ce(e){let t=mt(e)?e.value:e;return t.startsWith(":")||t.endsWith(":")?t.replaceAll(":",""):t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):t}function _s(e){let t=[...e.values()];return b(t)}function Qe(e){let t=[];for(let[o,s]of e.entries())t.push(st(o),s);return t}function Ps(e){let t=e.indexOf(".");return[e.slice(0,t),e.slice(t+1)]}function Gs(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&apos;")}function zs(e){return e.replaceAll(`
`," ").replaceAll(/\s{2,}/g," ")}function Oe(e){return e.replaceAll("\\","\\\\").replaceAll('"','\\"').replaceAll(`
`,"\\n")}function z(e){if(se(e))return Ft(e);if(J(e))return Dt(e);if(g(e))return We(e);if(Y(e))return Lt(e);if(U(e))return It(e);if(G(e))return kt(e);if(M(e))return Rt(e);if(E(e))return Ut();if(v(e))return ye(e);if(w(e))return be(e);if(I(e))return qt(e);if(D(e))return Bt(e);throw new Error("Could not unwrap object.")}function Ft(e){return z(e.value)}function Dt(e){return e.value}function Qs(e){return e.value}function Lt(e){let t=w(e.value)?e.value.value:String(z(e.value));return new Error(t)}function It(e){return(...t)=>p(z(e.value(...t)))}function kt(e){return e.value}function Rt(e){return e.value.map(z)}function We(e){let t={};for(let[o,s]of e.value.entries())t[o]=z(s);return t}function Ut(){return null}function ye(e){return e.value}function be(e){return e.value}function qt(e){return e.value}function Bt(e){return e.value.map(z)}function p(e){if(P(e))return e;switch(typeof e){case"undefined":return f();case"number":return a(e);case"string":return e.startsWith('"')?d(e):e.startsWith(":")?ce(e):S(e);case"boolean":return c(e);case"symbol":return d(JSON.stringify(e));case"function":return R((...t)=>{try{return p(e(...t.map(o=>o.value)))}catch(o){return o instanceof Error?k(d(o.message)):k(d(JSON.stringify(o)))}});case"object":{if(e instanceof Error)return k(d(e.message));if(e===null)return f();if(Array.isArray(e)){let s=e.map(r=>p(r));return b(s)}if(e instanceof Map){let s=new Map;for(let[r,i]of e.entries()){let l=String(r),x=p(i);s.set(l,x)}return F(s)}let t=e,o=new Map;for(let[s,r]of Object.entries(t)){let i=String(s),l=p(r);o.set(i,l)}return F(o)}default:{let t=String(e);return k(d(`unknown type ${t}`))}}}function Js(e){return Y(e)?e:P(e)?k(e):e instanceof Error?k(d(e.message)):k(d(String(e)))}var ue=class{value=new Map;outer;binds=[];exprs=[];constructor(t=void 0,o=[],s=[]){this.outer=t,this.binds=o,this.exprs=s;for(let r=0;r<o.length;r++){let i=o[r];if(i.value==="&"){let x=o[r+1];if(x){let L=s.slice(r),Ts=Z(x);this.value.set(Ts,b(L));break}}let l=Z(i);this.value.set(l,s[r])}}serialize(){let t=F(),o=F();this.outer&&(o=this.outer.serialize());let s=this.value.entries();for(let[r,i]of s)t.value.set(r,i);return t.value.set("__outer__",o),t}set(t,o){let s=Z(t);return this.value.set(s,o),o}findEnv(t){let o=Z(t);if(this.value.has(o))return this;if(Se(this.outer))return this.outer.findEnv(t)}get(t){let o=this.findEnv(t);if(o===void 0)throw new Error(`'${t.value}' not found`);let s=Z(t),r=o.value.get(s);return Re(r),r}};function j(e,t=!1){if(w(e))return t?`"${Oe(e.value)}"`:e.value;if(G(e)||J(e)||v(e)||I(e))return String(e.value);let o=e;if(se(o))return`(atom ${j(o.value)})`;if(Y(e))return j(e.value,t);if(U(e))return"#<fn>";if(q(e)){let s=M(e),r=e.value.map(i=>j(i,t)).join(" ");return s?`(${r})`:`[${r}]`}if(oe(e))return ge(e,t);if(g(e))return`{${Qe(e.value).map(r=>j(r,t)).join(" ")}}`;if(E(e))return"nil";throw new Error(`unmatched object ${JSON.stringify(e)}`)}var Ys=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]);function ge(e,t=!1){if(oe(e)){let s=e.value,r=Ys.has(s),i="";if(e.attributes.size>0&&(i=" "+Array.from(e.attributes).map(([x,L])=>x==="style"?Xs(L,t):`${Ce(x)}="${ge(L,t)}"`).join(" ")),r)return`<${s}${i} />`;let l=[];if(e.children.length>0){let x=[];s==="style"?x=e.children.map(L=>Hs(L,t)):s==="script"?x=e.children.map(L=>Je(L,t)):x=e.children.map(L=>ge(L,t)),l.push(x.join(" "))}return s==="!doctype"?`<!doctype html>
${l.join(" ")}`:`<${s}${i}>${l.join(" ")}</${s}>`}if(w(e))return t?`"${Oe(e.value)}"`:e.value;if(G(e)||J(e)||v(e)||I(e))return String(e.value);let o=e;if(se(o))return`(atom ${ge(o.value)})`;if(Y(e))return ge(e.value,t);if(U(e))return"#<fn>";if(q(e)){let s=M(e),r=e.value.map(i=>ge(i,t)).join(" ");return s?`(${r})`:`[${r}]`}if(g(e))return`{${Qe(e.value).map(r=>ge(r,t)).join(" ")}}`;if(E(e))return"nil";throw new Error(`unmatched object ${JSON.stringify(e)}`)}function Je(e,t=!1){if(oe(e))return`(const el = document.createElement("${e.value}"); document.body.appendChild(el);)`;if(M(e)){let o=e.value,s=o[0],r=o.slice(1);return`(${s.value}(${r.map(i=>Je(i)).join(", ")}))`}return D(e)?`[${e.value.map(s=>Je(s)).join(",")}]`:U(e)?`(${e.value.toString()})`:w(e)||G(e)||I(e)?`"${e.value}"`:J(e)||v(e)?String(e.value):g(e)?`{${Object.entries(e.value).map(([s,r])=>{let i=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(s)?s:`"${s}"`,l=Je(r,t);return`${i}: ${l}`}).join(", ")}}`:E(e)?"null":"/* javascript */"}function Me(e,t=!1){if(w(e))return t?Oe(e.value):e.value;if(G(e))return e.value.slice(1);if(v(e))return String(e.value);if(I(e))return e.value;if(Y(e))return Me(e.value,t);if(M(e)||D(e))return e.value.map(o=>Me(o,t)).join(" ");if(g(e))return[...e.value].map(([o,s])=>{let r=Ce(o);return E(s)?r:g(s)?`${r} {${Me(s,t)}}`:`${Ce(o)}: ${Me(s,t)};`}).join(" ");if(J(e)||se(e)||U(e)||oe(e)||E(e))return"";throw new Error("unmatched object")}function Hs(e,t=!1){return Me(e,t)}function Xs(e,t=!1){return g(e)?Zs(e,t):"{}"}function Zs(e,t=!1){return[...e.value].map(([o,s])=>`${Ce(o)}: ${Me(s,t)};`).join("")}var en=/[\s,]*(~@|[[\]{}()'`~^@<]|"(?:\\.|[^\\"])*"?|;.*|\/\/.*|\/>|[^\s[\]{}('"`,;)]*)/g,tn=/^-?\d+(\.\d+)?$/,on=/"(?:\\.|[^\\"])*"/,rt=class{constructor(t,o=0){this.tokens=t;this.pos=o}next=()=>this.tokens[this.pos++];peek=()=>this.tokens[this.pos]};function sn(e){return[...e.matchAll(en)].filter(o=>!o[1].startsWith(";")&&!o[1].startsWith("//")&&o[1]!=="").map(o=>o[1])}function Xe(e){let t=sn(e);return t.length===0?f():He(new rt(t))}function He(e){let t=e.peek();if(t===void 0)throw new Error("EOF");function o(s,r){return b([S(s),He(e),...r?[r]:[]])}switch(t){case"'":return e.next(),o("quote");case"`":return e.next(),o("quasiquote");case"~":return e.next(),o("unquote");case"~@":return e.next(),o("splice-unquote");case"^":{e.next();let s=He(e);return o("with-meta",s)}case"@":return e.next(),o("deref");case")":case"]":case"}":case"/>":throw new Error(`unexpected '${t}'`);case"(":return Ye(e,")");case"[":return Ye(e,"]");case"{":return Ye(e,"}");case"<":return Ye(e,"/>");default:return nn(e)}}function nn(e){let t=e.next();if(t===void 0)throw new Error("unexpected EOF");if(t==="nil")return f();if(t==="false")return c(!1);if(t==="true")return c(!0);if(tn.test(t))return a(Number.parseFloat(t));if(on.test(t))return d(rn(t));if(t.startsWith(":")||t.endsWith(":"))return ce(t);if(t.startsWith('"'))throw new Error(`expected '"', got EOF`);return S(t)}function rn(e){return e.slice(1,-1).replaceAll(/\\(.)/g,(t,o)=>o==="n"?`
`:o)}function Ye(e,t){let o=[];for(e.next();;){let s=e.peek();if(s===void 0)throw new Error(`expected '${t}', got EOF`);if(s===t){e.next();break}o.push(He(e))}switch(t){case"/>":case")":return b(o);case"]":return m(o);case"}":{let s=F();for(let r=0;r<o.length;r+=2){let i=o[r];$(i);let l=o[r+1],x=Z(i);s.value.set(x,l)}return s}default:throw new Error("unknown end value")}}var Kt=new Map,$t=[["=",jt],["throw",ho],["nil?",Mo],["true?",Eo],["false?",To],["symbol",it],["Symbol.new",it],["symbol?",Fo],["keyword",Do],["keyword?",Lo],["number?",Io],["macro?",Ro],["pr-str",Ot],["str",Wt],["prn",_t],["println",pt],["console.log",pt],["read-string",Pt],["string?",Vo],["trim",Gt],["<",zt],["<=",Qt],[">",Jt],[">=",Yt],["+",Ht],["-",Xt],["*",Zt],["/",eo],["time-ms",to],["assoc",Ko],["contains?",Oo],["dissoc",$o],["get",jo],["hash-map",at],["keys",Wo],["map?",Bo],["vals",_o],["list",oo],["list?",so],["apply",xo],["fn?",ko],["concat",ro],["conj",go],["cons",no],["count",co],["empty?",lo],["first",io],["last",ao],["join",Go],["map",bo],["nth",po],["rest",yo],["seq",So],["sequential?",Po],["vec",uo],["vector",Uo],["vector?",qo],["meta",wo],["with-meta",Co],["atom",No],["atom?",mo],["deref",fo],["reset!",Ao],["swap!",vo]];for(let[e,t]of $t)Kt.set(S(e),R(t));function jt(...e){return n(e.length,2),te(e[0],e[1])}function Ot(...e){let t=e.map(o=>j(o,!0)).join(" ");return d(t)}function Wt(...e){let t=e.map(o=>j(o,!1)).join("");return d(t)}function _t(...e){let t=e.map(o=>j(o,!0)).join(" ");return console.log(t),f()}function pt(...e){let t=e.map(o=>j(o,!1)).join(" ");return console.log(t),f()}function Pt(...e){n(e.length,1);let t=e[0];return y(t),Xe(t.value)}function Gt(...e){n(e.length,1);let t=e[0];return y(t),d(t.value.trim())}function zt(...e){n(e.length,2,`
args: ${JSON.stringify(e,null,"  ")}`);let t=e[0];u(t);let o=e[1];return u(o),c(t.value<o.value)}function Qt(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),c(t.value<=o.value)}function Jt(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),c(t.value>o.value)}function Yt(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),c(t.value>=o.value)}function Ht(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),a(t.value+o.value)}function Xt(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),a(t.value-o.value)}function Zt(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),a(t.value*o.value)}function eo(...e){n(e.length,2);let t=e[0];u(t);let o=e[1];return u(o),a(t.value/o.value)}function to(...e){return n(e.length,0),a(new Date().getTime())}function oo(...e){for(let t of e)N(t);return b(e)}function so(...e){return n(e.length,1),c(M(e[0]))}function no(...e){return n(e.length,2),H(e[1]),new Ae([e[0],...e[1].value])}function ro(...e){let t=[];for(let o of e)H(o),t.push(...o.value);return b(t)}function uo(...e){return M(e[0])?m(e[0].value):e[0]}function po(...e){if(n(e.length,2),q(e[0])&&v(e[1])){let t=e[1].value,o=e[0],s=e[0].value.length;if(s>0&&t<s)return o.value[t]}throw new Error("out of range")}function io(...e){return n(e.length,1),q(e[0])&&e[0].value.length>0?e[0].value[0]:f()}function ao(...e){return n(e.length,1),q(e[0])&&e[0].value.length>0?e[0].value[e[0].value.length-1]:f()}function yo(...e){return n(e.length,1),q(e[0])?b(e[0].value.slice(1)):b([])}function lo(...e){n(e.length,1);let t=e[0];return H(t),c(t.value.length===0)}function co(...e){n(e.length,1);let t=e[0];if(E(t))return a(0);if(g(e[0]))return a(e[0].value.size);if(q(e[0]))return a(e[0].value.length);throw new TypeError("Invalid argument type")}function No(...e){n(e.length,1);let t=e[0];return re(t)}function mo(...e){n(e.length,1);let t=e[0];return c(se(t))}function fo(...e){n(e.length,1);let t=e[0];return W(t),t.value}function Ao(...e){n(e.length,2);let t=e[0],o=e[1];return W(t),t.value=o,o}function vo(...e){T(e.length,2);let t=e[0];W(t);let o=e[1];C(o);let s=e.slice(2);return t.value=o.value(t.value,...s),t.value}function ho(...e){throw n(e.length,1),N(e[0]),k(e[0])}function xo(...e){let t=e.length;T(t,2),C(e[0]);let o=e[t-1];return H(o),e[0].value(...e.slice(1,-1),...o.value)}function bo(...e){let t=e.length;n(t,2),C(e[0]),H(e[1]);let o=e[0],r=e[1].value.map(i=>o.value(i));return b(r)}function go(...e){T(e.length,2),H(e[0]);let[t,...o]=e;return M(t)?b([...o.reverse(),...t.value]):m([...e[0].value,...o])}function So(...e){n(e.length,1);let t=e[0];return M(t)&&t.value.length>0?t:D(t)&&t.value.length>0?b([...t.value]):w(t)&&t.value.length>0?b(t.value.split("").map(o=>d(o))):f()}function wo(...e){return n(e.length,1),Ge(e[0]),e[0].metadata??f()}function Co(...e){n(e.length,2),Ge(e[0]),N(e[1]);let t=O(e[0]);return t.metadata=e[1],t}function Mo(...e){return n(e.length,1),c(E(e[0]))}function Eo(...e){return n(e.length,1),c(J(e[0])&&e[0].value)}function To(...e){return n(e.length,1),c(J(e[0])&&!e[0].value)}function Vo(...e){return n(e.length,1),c(w(e[0]))}function it(...e){return n(e.length,1),y(e[0]),S(e[0].value)}function Fo(...e){return n(e.length,1),c(I(e[0]))}function Do(...e){n(e.length,1),$(e[0]);let t=e[0];if(G(t))return t;let o=e[0];return ce(`:${o.value}`)}function Lo(...e){return n(e.length,1),c(G(e[0]))}function Io(...e){return n(e.length,1),c(v(e[0]))}function ko(...e){return n(e.length,1),c(U(e[0])&&!e[0].isMacro)}function Ro(...e){return n(e.length,1),c(U(e[0])?e[0].isMacro:!1)}function Uo(...e){return m(e)}function qo(...e){return n(e.length,1),c(D(e[0]))}function at(...e){if(e.length===0)return F();if(e.length===1&&g(e[0]))return F(new Map(e[0].value));xe(e.length);let t=F();for(let o=0;o<e.length;o+=2){let s=e[o];$(s),qe(t.value,s,e[o+1])}return t}function Bo(...e){return n(e.length,1),c(g(e[0]))}function Ko(...e){T(e.length,1),B(e[0]);let t=e.slice(1),o=F(new Map(e[0].value)),s=at(...t);for(let[r,i]of s.value.entries())o.value.set(r,i);return o}function $o(...e){T(e.length,1),B(e[0]);let t=F(new Map(e[0].value));for(let o of e.splice(1))$(o),Be(t.value,o);return t}function jo(...e){n(e.length,2);let t=e[0];if(!g(t))return f();let o=e[1];$(o);let s=$e(t.value,o);return s!==void 0?s:f()}function Oo(...e){n(e.length,2);let t=e[0],o=e[1];return B(t),$(o),c(Ke(t.value,o))}function Wo(...e){return n(e.length,1),B(e[0]),je(e[0].value)}function _o(...e){return n(e.length,1),B(e[0]),b([...e[0].value.values()])}function Po(...e){return c(q(e[0]))}function Go(...e){A(e.length,1,2),H(e[0]);let t=w(e[1])?e[1].value:" ",o=e[0].value.map(s=>j(s,!1)).join(t);return d(o)}function un(...e){T(e.length,2);let[t,...o]=e,s=o.pop();Re(s),C(s);let r=o.length;for(let i=0;i<r;i++){let l=o[i];if(_(l),n(l.value.length,2),C(l.value[1]),te(t,l.value[0]).value)return l.value[1].value()}return s.value()}var pe={add:Ht,apply:xo,applyToSequence:bo,assoc:Ko,atom:No,concat:ro,conj:go,cons:no,contains:Oo,deref:fo,dissoc:$o,divide:eo,empty:lo,eq:jt,firstNodeInList:io,get:jo,gt:Jt,gte:Yt,hashMap:at,isAtom:mo,isFalse:To,isFn:ko,isKeyword:Lo,isListNode:so,isMacro:Ro,isMap:Bo,isNil:Mo,isNumber:Io,isSequentialNode:Po,isString:Vo,isSymbolNode:Fo,isTrue:Eo,isVector:qo,join:Go,keys:Wo,keyword:Do,lastNodeInList:ao,length:co,list:oo,lt:zt,lte:Qt,meta:wo,multiply:Zt,ns:Kt,nsValues:$t,nth:po,printEscapedString:Ot,printEscapedStringToScreen:_t,printUnescapedString:Wt,printUnescapedStringToScreen:pt,readString:Pt,reset:Ao,rest:yo,seq:So,subtract:Xt,swap:vo,switchCase:un,symbol:it,throwError:ho,timeMs:to,trim:Gt,vals:_o,vec:uo,vector:Uo,withMeta:Co};var an=new Set(["!doctype","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","imgmap","input","kbd","label","legend","li","link","main","mark","menu","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","portal","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"]),Ze=new Map;for(let e of an)Ze.set(S(e),R(yn(e)));function yn(e){return(...t)=>ln(S(e),...t)}function ln(...e){T(e.length,1);let t=e[0];K(t);let o=new Map,s=[];return g(e[1])?(e[1].value.forEach((r,i)=>o.set(i,r)),e.slice(2).forEach(r=>s.push(r))):e.slice(1).forEach(r=>s.push(r)),he(t.value,o,s)}function dn(...e){n(e.length,1),y(e[0]);let t=e[0].value,o=document.querySelector(t);if(o===null)return f();let r=Array.from(o.attributes).reduce((i,l)=>i.set(l.name,d(l.value)),new Map);return he(o.tagName,r,[])}Ze.set(S("document.querySelector"),R(dn));var Xo=[["Array",cn],["Array.from",Qo],["Array.isArray",mn],["Array.of",Qo],["Array.prototype.at",Nn],["Array.prototype.concat",fn],["Array.prototype.copyWithin",An],["Array.prototype.entries",vn],["Array.prototype.every",hn],["Array.prototype.fill",xn],["Array.prototype.filter",bn],["Array.prototype.find",gn],["Array.prototype.findIndex",Sn],["Array.prototype.findLast",wn],["Array.prototype.findLastIndex",Cn],["Array.prototype.flat",Mn],["Array.prototype.flatMap",En],["Array.prototype.includes",Tn],["Array.prototype.indexOf",Vn],["Array.prototype.join",Fn],["Array.prototype.keys",Dn],["Array.prototype.length",Rn],["Array.prototype.map",Ln],["Array.prototype.pop",In],["Array.prototype.push",kn],["Array.prototype.reduce",Un],["Array.prototype.reverse",Jo],["Array.prototype.shift",qn],["Array.prototype.slice",Bn],["Array.prototype.some",Kn],["Array.prototype.sort",Yo],["Array.prototype.splice",Ho],["Array.prototype.toReversed",Jo],["Array.prototype.toSorted",Yo],["Array.prototype.toSpliced",Ho],["Array.prototype.unshift",$n],["Array.prototype.values",jn],["Array.prototype.with",On],["Array.toString",pe.printEscapedString]];function cn(...e){if(T(e.length,1),e.length===1&&v(e[0])){let t=Array(e[0].value).fill(f());return m(t)}return m(e)}function Qo(...e){A(e.length,1,3),h(e[0]),e.length>=2&&C(e[1]),e.length===3&&N(e[2]);let t=Array.from(e[0].value,e[1]?.value,e[2]?.value);return m(t)}function Nn(...e){n(e.length,2),h(e[0]),u(e[1]);let t=e[0].value,o=e[1].value,s=t.at(o);return s?p(s):f()}function mn(...e){n(e.length,1),N(e[0]);let t=D(e[0]);return c(t)}function fn(...e){T(e.length,1),X(e,ve);let t=e[0].value.concat(...e.slice(1).map(o=>o.value));return m(t)}function An(...e){A(e.length,1,4),h(e[0]),u(e[1]),u(e[2]);let t=e[0].value,o=e[1].value,s=e[2].value,r=v(e[3])?e[3].value:void 0,i=t.copyWithin(o,s,r);return m(i)}function vn(...e){n(e.length,1),h(e[0]);let t=e[0].value.map((o,s)=>{let r=a(s);return m([r,o])});return m(t)}function hn(...e){n(e.length,2),h(e[0]),C(e[1]);let t=e[0].value,o=e[1].value,s=t.every((r,i,l)=>o(a(i),r,m(l)).value);return c(s)}function xn(...e){A(e.length,2,4),h(e[0]),N(e[1]);let t=e[0].value.map(z),o=e[1].value,s;e.length>=3&&(u(e[2]),s=e[2].value);let r;e.length===4&&(u(e[3]),r=e[3].value);let i=t.fill(o,s,r);return m(i.map(p))}function bn(...e){n(e.length,2),C(e[0]),h(e[1]);let t=e[0],s=e[1].value.filter(r=>!!t.value(r).value);return m(s)}function gn(...e){n(e.length,2),h(e[0]),C(e[1]);let t=e[0].value,o=e[1].value;return t.find((r,i,l)=>o(r,a(i),m(l)).value)??f()}function Sn(...e){n(e.length,2),h(e[0]),C(e[1]);let t=e[0].value,o=e[1].value,s=t.findIndex((r,i,l)=>o(r,a(i),m(l)).value);return a(s)}function wn(...e){n(e.length,2),h(e[0]),C(e[1]);let t=e[0].value,o=e[1].value;return t.findLast((r,i,l)=>o(r,a(i),m(l)).value)??f()}function Cn(...e){n(e.length,2),h(e[0]),C(e[1]);let t=e[0].value,o=e[1].value,s=t.findLastIndex((r,i,l)=>o(r,a(i),m(l)).value);return a(s)}function Mn(...e){n(e.length,1),h(e[0]);let t=e[0].value;function o(r){return r.reduce((i,l)=>i.concat(D(l)?o(l.value):l),[])}let s=o(t);return m(s)}function En(...e){n(e.length,2),h(e[0]),C(e[1]);let t=e[0].value,o=e[1].value;function s(l){return l.reduce((x,L)=>x.concat(D(L)?s(L.value):L),[])}let r=t.map((l,x,L)=>o(l,a(x),m(L))),i=s(r);return m(i)}function Tn(...e){n(e.length,2),h(e[0]),N(e[1]);let t=e[0],o=e[1],s=t.value.some(r=>te(r,o).value);return c(s)}function Vn(...e){n(e.length,2),h(e[0]),N(e[1]);let t=e[0],o=e[1];for(let[s,r]of t.value.entries())if(te(r,o).value)return a(s);return a(-1)}function Fn(...e){A(e.length,1,2),H(e[0]);let t=w(e[1])?e[1].value:" ",o=e[0].value.map(s=>j(s,!1)).join(t);return d(o)}function Dn(...e){n(e.length,1),h(e[0]);let o=e[0].value.map((s,r)=>a(r));return m(o)}function Ln(...e){A(e.length,2,3),h(e[0]),C(e[1]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=t.map((i,l,x)=>{let L=o(i,a(l),s);return p(L)});return m(r)}function In(...e){n(e.length,1),h(e[0]);let t=e[0],o=t.value[t.value.length-1];return p(o)}function kn(...e){if(T(e.length,2),!e.every(P))throw new TypeError("Invalid arguments.");return h(e[0]),m([...e[0].value,...e.slice(1)])}function Rn(...e){n(e.length,1),h(e[0]);let t=e[0];return a(t.value.length)}function Un(...e){n(e.length,3),C(e[0]),h(e[1]);let t=e[0],o=e[1],s=e[2];for(let r of o.value)s=t.value(s,r);return s}function Jo(...e){n(e.length,1),h(e[0]);let o=e[0].value.toReversed();return m(o)}function qn(...e){n(e.length,1),h(e[0]);let o=e[0].value[0];return o||f()}function Bn(...e){A(e.length,1,3),h(e[0]);let t=0;e[1]!==void 0&&(u(e[1]),t=e[1].value);let o=e[0].value.length;return e[2]!==void 0&&(u(e[2]),o=e[2].value),m(e[0].value.slice(t,o))}function Kn(...e){n(e.length,2),h(e[0]),C(e[1]);let t=e[0].value,o=e[1].value,s=t.some((r,i,l)=>o(r,a(i),m(l)).value);return c(s)}function Yo(...e){n(e.length,2),h(e[0]),C(e[1]);let t=e[0].value,o=e[1].value,s=t.toSorted((r,i)=>{let l=o(r,i);return u(l),l.value});return m(s)}function Ho(...e){A(e.length,2,4),h(e[0]),u(e[1]);let t=e[0].value,o=e[1].value;if(e.length<3){let l=t.toSpliced(o);return m(l)}u(e[2]);let s=e[2].value,r=e.slice(3),i=t.toSpliced(o,s,...r);return m(i)}function $n(...e){n(e.length,2),h(e[1]);let t=[e[0],...e[1].value];return m(t)}function jn(...e){n(e.length,1),h(e[0]);let o=e[0].value.map(s=>s);return m(o)}function On(...e){n(e.length,3),h(e[0]),u(e[1]),N(e[2]);let t=e[0],o=e[1],s=e[2],r=t.value.with(o.value,s);return m(r)}var Zo=[["Boolean",Wn]];function Wn(...e){return n(e.length,1),N(e[0]),c(!!e[0].value)}var es=[["decodeURI",_n],["decodeURIComponent",Pn],["encodeURI",Gn],["encodeURIComponent",zn]];function _n(...e){n(e.length,1),y(e[0]);let t=decodeURI(e[0].value);return d(t)}function Pn(...e){n(e.length,1),y(e[0]);let t=decodeURIComponent(e[0].value);return d(t)}function Gn(...e){n(e.length,1),y(e[0]);let t=encodeURI(e[0].value);return d(t)}function zn(...e){n(e.length,1),y(e[0]);let t=encodeURIComponent(e[0].value);return d(t)}var ts=[["Date",Qn],["Date.now",Jn],["Date.parse",Yn],["Date.UTC",Hn],["Date.prototype.getDate",Xn],["Date.prototype.getDay",Zn],["Date.prototype.getFullYear",er],["Date.prototype.getHours",tr],["Date.prototype.getMilliseconds",or],["Date.prototype.getMinutes",sr],["Date.prototype.getMonth",nr],["Date.prototype.getSeconds",rr],["Date.prototype.getTime",ur],["Date.prototype.getTimezoneOffset",pr],["Date.prototype.getUTCDate",ir],["Date.prototype.getUTCDay",ar],["Date.prototype.getUTCFullYear",yr],["Date.prototype.getUTCHours",lr],["Date.prototype.getUTCMilliseconds",dr],["Date.prototype.getUTCMinutes",cr],["Date.prototype.getUTCMonth",Nr],["Date.prototype.getUTCSeconds",mr],["Date.prototype.setDate",fr],["Date.prototype.setFullYear",Ar],["Date.prototype.setHours",vr],["Date.prototype.setMilliseconds",hr],["Date.prototype.setMinutes",xr],["Date.prototype.setMonth",br],["Date.prototype.setSeconds",gr],["Date.prototype.setTime",Sr],["Date.prototype.setUTCDate",wr],["Date.prototype.setUTCFullYear",Cr],["Date.prototype.setUTCHours",Mr],["Date.prototype.setUTCMilliseconds",Er],["Date.prototype.setUTCMinutes",Tr],["Date.prototype.setUTCMonth",Vr],["Date.prototype.setUTCSeconds",Fr],["Date.prototype.toDateString",Dr],["Date.prototype.toISOString",Lr],["Date.prototype.toJSON",Ir],["Date.prototype.toLocaleDateString",kr],["Date.prototype.toLocaleString",Rr],["Date.prototype.toLocaleTimeString",Ur],["Date.prototype.toString",qr],["Date.prototype.toTimeString",Br],["Date.prototype.toUTCString",Kr]];function Qn(...e){let t=e.map(z),o=t.length>0?new Date(...t):new Date;return a(o.getTime())}function Jn(...e){return a(Date.now())}function Yn(...e){n(e.length,1),y(e[0]);let t=Date.parse(e[0].value);return a(t)}function Hn(...e){let t=e.map(z),o=Date.UTC(...t);return Number.isNaN(o)?f():a(o)}function Xn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getDate())}function Zn(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getDay())}function er(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getFullYear())}function tr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getHours())}function or(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getMilliseconds())}function sr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getMinutes())}function nr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getMonth())}function rr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getSeconds())}function ur(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getTime())}function pr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getTimezoneOffset())}function ir(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCDate())}function ar(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCDay())}function yr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCFullYear())}function lr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCHours())}function dr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCMilliseconds())}function cr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCMinutes())}function Nr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCMonth())}function mr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return a(t.getUTCSeconds())}function fr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setDate(e[1].value),a(t.getTime())}function Ar(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setFullYear(e[1].value),a(t.getTime())}function vr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setHours(e[1].value),a(t.getTime())}function hr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setMilliseconds(e[1].value),a(t.getTime())}function xr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setMinutes(e[1].value),a(t.getTime())}function br(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setMonth(e[1].value),a(t.getTime())}function gr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setSeconds(e[1].value),a(t.getTime())}function Sr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setTime(e[1].value),a(t.getTime())}function wr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCDate(e[1].value),a(t.getTime())}function Cr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCFullYear(e[1].value),a(t.getTime())}function Mr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCHours(e[1].value),a(t.getTime())}function Er(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCMilliseconds(e[1].value),a(t.getTime())}function Tr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCMinutes(e[1].value),a(t.getTime())}function Vr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCMonth(e[1].value),a(t.getTime())}function Fr(...e){n(e.length,2),u(e[0]),u(e[1]);let t=new Date(e[0].value);return t.setUTCSeconds(e[1].value),a(t.getTime())}function Dr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toDateString())}function Lr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toISOString())}function Ir(...e){A(e.length,1,2),u(e[0]),e[1]&&y(e[1]);let t=new Date(e[0].value);return d(t.toJSON())}function kr(...e){A(e.length,1,3),u(e[0]);let t=new Date(e[0].value),o=e.slice(1).map(z);return d(t.toLocaleDateString(...o))}function Rr(...e){A(e.length,1,3),u(e[0]);let t=new Date(e[0].value),o=e.slice(1).map(z);return d(t.toLocaleString(...o))}function Ur(...e){A(e.length,1,3),u(e[0]);let t=new Date(e[0].value),o=e.slice(1).map(z);return d(t.toLocaleTimeString(...o))}function qr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toString())}function Br(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toTimeString())}function Kr(...e){n(e.length,1),u(e[0]);let t=new Date(e[0].value);return d(t.toUTCString())}var os=[["Error",$r],["Error.prototype.message",jr],["Error.prototype.cause",Or],["Error.prototype.name",Wr]];function $r(...e){A(e.length,1,3);let t=e[0];y(t);let o;if(e[1]!==void 0){if(!w(e[1])&&!E(e[1]))throw new TypeError("Second argument must be a string or nil.");w(e[1])&&(fe.assertErrorName(e[1]),o=e[1])}let s;return e[2]!==void 0&&(N(e[2]),s=e[2]),k(t,o,s)}function jr(...e){return n(e.length,1),ke(e[0]),e[0].value}function Or(...e){return n(e.length,1),ke(e[0]),e[0].cause??f()}function Wr(...e){return n(e.length,1),ke(e[0]),e[0].name}var ns=[["Function",ss],["Function.isFunction",pe.isFn],["Function.prototype.apply",_r],["Function.prototype.bind",Gr],["Function.prototype.call",Pr],["js-eval",ss]];function ss(...e){n(e.length,1),y(e[0]);try{let t=new Function(`'use strict'; return (${e[0].value})`)();return p(t)}catch(t){return t instanceof Error?k(d(t.message)):k(d(JSON.stringify(t)))}}function _r(...e){n(e.length,2),C(e[0]),h(e[1]);let t=e[0].value.apply(null,e[1].value);return p(t)}function Pr(...e){T(e.length,1),C(e[0]);let t=e[0].value.call(null,...e.slice(1));return p(t)}function Gr(...e){T(e.length,2),C(e[0]),N(e[1]);let t=e[0].value.bind(e[1],...e.slice(2));return p(t)}var rs=[["Map.isMap",zr],["Map.new",us],["Map.prototype.delete",Yr],["Map.prototype.entries",Qr],["Map.prototype.get",Hr],["Map.prototype.has",Xr],["Map.prototype.keys",Zr],["Map.prototype.set",Jr],["Map.prototype.size",tu],["Map.prototype.values",eu]];function zr(...e){return n(e.length,1),c(g(e[0]))}function us(...e){if(e.length===0)return F();if(e.length===1&&g(e[0]))return F(new Map(e[0].value));xe(e.length);let t=F();for(let o=0;o<e.length;o+=2){let s=e[o];$(s),qe(t.value,s,e[o+1])}return t}function Qr(...e){n(e.length,1),B(e[0]);let t=e[0].value.entries(),o=m();for(let[s,r]of t){let i=m([p(s),p(r)]);o.value.push(i)}return o}function Jr(...e){T(e.length,1),B(e[0]);let t=e.slice(1),o=F(new Map(e[0].value)),s=us(...t);for(let[r,i]of s.value.entries())o.value.set(r,i);return o}function Yr(...e){T(e.length,1),B(e[0]);let t=F(new Map(e[0].value));for(let o of e.splice(1))$(o),Be(t.value,o);return t}function Hr(...e){n(e.length,2);let t=e[0];if(!g(t))return f();let o=e[1];$(o);let s=$e(t.value,o);return s!==void 0?s:f()}function Xr(...e){n(e.length,2);let t=e[0],o=e[1];return B(t),$(o),c(Ke(t.value,o))}function Zr(...e){return n(e.length,1),B(e[0]),je(e[0].value)}function eu(...e){return n(e.length,1),B(e[0]),b([...e[0].value.values()])}function tu(...e){n(e.length,1);let t=e[0];if(E(t))return a(0);if(g(e[0]))return a(e[0].value.size);if(q(e[0]))return a(e[0].value.length);throw new TypeError("Invalid argument type")}var ps=[["Math.abs",ou],["Math.acos",su],["Math.acosh",nu],["Math.asin",ru],["Math.asinh",uu],["Math.atan",pu],["Math.atan2",iu],["Math.atanh",au],["Math.cbrt",yu],["Math.ceil",lu],["Math.clz32",du],["Math.cos",cu],["Math.cosh",Nu],["Math.exp",mu],["Math.expm1",fu],["Math.floor",Au],["Math.fround",vu],["Math.hypot",hu],["Math.imul",xu],["Math.log",bu],["Math.log10",gu],["Math.log1p",Su],["Math.log2",wu],["Math.max",Cu],["Math.min",Mu],["Math.pow",Eu],["Math.random",Tu],["Math.round",Vu],["Math.sign",Fu],["Math.sin",Du],["Math.sinh",Lu],["Math.sqrt",Iu],["Math.tan",ku],["Math.tanh",Ru],["Math.trunc",Uu],["Math.E",qu],["Math.LN10",Bu],["Math.LN2",Ku],["Math.LOG10E",$u],["Math.LOG2E",ju],["Math.PI",Ou],["Math.SQRT1_2",Wu],["Math.SQRT2",_u]];function ou(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.abs(t);return p(o)}function su(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.acos(t);return p(o)}function nu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.acosh(t);return p(o)}function ru(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.asin(t);return p(o)}function uu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.asinh(t);return p(o)}function pu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.atan(t);return p(o)}function iu(...e){n(e.length,2),u(e[0]),u(e[1]);let t=e[0].value,o=e[1].value,s=Math.atan2(t,o);return p(s)}function au(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.atanh(t);return p(o)}function yu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.cbrt(t);return p(o)}function lu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.ceil(t);return p(o)}function du(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.clz32(t);return p(o)}function cu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.cos(t);return p(o)}function Nu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.cosh(t);return p(o)}function mu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.exp(t);return p(o)}function fu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.expm1(t);return p(o)}function Au(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.floor(t);return p(o)}function vu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.fround(t);return p(o)}function hu(...e){X(e,ee);let t=e.map(ye),o=Math.hypot(...t);return p(o)}function xu(...e){n(e.length,2),u(e[0]),u(e[1]);let t=e[0].value,o=e[1].value,s=Math.imul(t,o);return p(s)}function bu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.log(t);return p(o)}function gu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.log10(t);return p(o)}function Su(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.log1p(t);return p(o)}function wu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.log2(t);return p(o)}function Cu(...e){X(e,ee);let t=e.map(ye),o=Math.max(...t);return p(o)}function Mu(...e){X(e,ee);let t=e.map(ye),o=Math.min(...t);return p(o)}function Eu(...e){if(e.length===2&&v(e[0])&&v(e[1])){let t=e[0].value,o=e[1].value,s=t**o;return p(s)}throw new TypeError('Invalid arguments to "Math.pow"')}function Tu(...e){if(e.length===0){let t=Math.random();return p(t)}throw new TypeError('Invalid arguments to "Math.random"')}function Vu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.round(t);return p(o)}function Fu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.sign(t);return p(o)}function Du(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.sin(t);return p(o)}function Lu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.sinh(t);return p(o)}function Iu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.sqrt(t);return p(o)}function ku(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.tan(t);return p(o)}function Ru(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.tanh(t);return p(o)}function Uu(...e){n(e.length,1),u(e[0]);let t=e[0].value,o=Math.trunc(t);return p(o)}function qu(...e){if(e.length===0)return p(Math.E);throw new TypeError('Invalid arguments to "Math.E"')}function Bu(...e){if(e.length===0)return p(Math.LN10);throw new TypeError('Invalid arguments to "Math.LN10"')}function Ku(...e){if(e.length===0)return p(Math.LN2);throw new TypeError('Invalid arguments to "Math.LN2"')}function $u(...e){if(e.length===0)return p(Math.LOG10E);throw new TypeError('Invalid arguments to "Math.LOG10E"')}function ju(...e){if(e.length===0)return p(Math.LOG2E);throw new TypeError('Invalid arguments to "Math.LOG2E"')}function Ou(...e){if(e.length===0)return p(Math.PI);throw new TypeError('Invalid arguments to "Math.PI"')}function Wu(...e){if(e.length===0)return p(Math.SQRT1_2);throw new TypeError('Invalid arguments to "Math.SQRT1_2"')}function _u(...e){if(e.length===0)return p(Math.SQRT2);throw new TypeError('Invalid arguments to "Math.SQRT2"')}var is=[["Number",Pu],["Number.isFinite",Gu],["Number.isInteger",zu],["Number.isNaN",Qu],["Number.isSafeInteger",Ju],["Number.parseFloat",Yu],["Number.parseInt",Hu],["Number.prototype.toExponential",up],["Number.prototype.toFixed",pp],["Number.prototype.toPrecision",ip],["Number.prototype.toString",ap],["Number.EPSILON",Xu],["Number.MAX_SAFE_INTEGER",Zu],["Number.MAX_VALUE",ep],["Number.MIN_SAFE_INTEGER",tp],["Number.MIN_VALUE",op],["Number.NaN",sp],["Number.NEGATIVE_INFINITY",np],["Number.POSITIVE_INFINITY",rp]];function Pu(...e){if(e.length===1&&P(e[0])){let t=e[0].value,o=Number(t);return p(o)}throw new TypeError('Invalid arguments to "Number"')}function Gu(...e){if(e.length===1&&P(e[0])){let t=e[0].value,o=Number.isFinite(t);return p(o)}throw new TypeError('Invalid arguments to "Number.isFinite"')}function zu(...e){if(e.length===1&&P(e[0])){let t=e[0].value,o=Number.isInteger(t);return p(o)}throw new TypeError('Invalid arguments to "Number.isInteger"')}function Qu(...e){if(e.length===1&&P(e[0])){let t=e[0].value,o=Number.isNaN(t);return p(o)}throw new TypeError('Invalid arguments to "Number.isNaN"')}function Ju(...e){if(e.length===1&&P(e[0])){let t=e[0].value,o=Number.isSafeInteger(t);return p(o)}throw new TypeError('Invalid arguments to "Number.isSafeInteger"')}function Yu(...e){n(e.length,1),y(e[0]);let t=be(e[0]),o=Number.parseFloat(t);return p(o)}function Hu(...e){A(e.length,1,2),y(e[0]);let t=e[0].value;if(e.length===2){u(e[1]);let s=e[1].value,r=Number.parseInt(t,s);return a(r)}let o=Number.parseInt(t);return a(o)}function Xu(...e){if(e.length===0){let t=Number.EPSILON;return p(t)}throw new TypeError('Invalid arguments to "Number.EPSILON"')}function Zu(...e){if(e.length===0){let t=Number.MAX_SAFE_INTEGER;return p(t)}throw new TypeError('Invalid arguments to "Number.MAX_SAFE_INTEGER"')}function ep(...e){if(e.length===0){let t=Number.MAX_VALUE;return p(t)}throw new TypeError('Invalid arguments to "Number.MAX_VALUE"')}function tp(...e){if(e.length===0){let t=Number.MIN_SAFE_INTEGER;return p(t)}throw new TypeError('Invalid arguments to "Number.MIN_SAFE_INTEGER"')}function op(...e){if(e.length===0){let t=Number.MIN_VALUE;return p(t)}throw new TypeError('Invalid arguments to "Number.MIN_VALUE"')}function sp(...e){if(e.length===0){let t=Number.NaN;return p(t)}throw new TypeError('Invalid arguments to "Number.NaN"')}function np(...e){if(e.length===0){let t=Number.NEGATIVE_INFINITY;return p(t)}throw new TypeError('Invalid arguments to "Number.NEGATIVE_INFINITY"')}function rp(...e){if(e.length===0){let t=Number.POSITIVE_INFINITY;return p(t)}throw new TypeError('Invalid arguments to "Number.POSITIVE_INFINITY"')}function up(...e){if(A(e.length,1,2),u(e[0]),e.length===2){u(e[1]);let o=e[1].value,s=e[0].value.toExponential(o);return d(s)}let t=e[0].value.toExponential();return d(t)}function pp(...e){if(A(e.length,1,2),u(e[0]),e.length===2){u(e[1]);let o=e[1].value,s=e[0].value.toFixed(o);return d(s)}let t=e[0].value.toFixed();return d(t)}function ip(...e){if(A(e.length,1,2),u(e[0]),e.length===2){u(e[1]);let o=e[1].value,s=e[0].value.toPrecision(o);return d(s)}let t=e[0].value.toPrecision();return d(t)}function ap(...e){if(A(e.length,1,2),u(e[0]),e.length===2){u(e[1]);let o=e[1].value,s=e[0].value.toString(o);return d(s)}let t=e[0].value.toString();return d(t)}var as=[["===",pe.eq],["!==",bp],["??",Mp],["**",Ep],["%",dp],[">>",vp],["<<",Ap],[">>>",hp],["/&",cp],["/|",Np],["/^",mp],["/~",fp],["&&",yp],["||",lp],["!",xp],["++",gp],["--",Sp],["typeof",wp],["instanceof",Cp]];function yp(...e){for(let o of e)if(!Ue(o,!0))return c(!1);return c(!0)}function lp(...e){for(let t of e)if(Ue(t))return c(!0);return c(!1)}function dp(e,t){if(v(e)&&v(t))return a((e.value%t.value+t.value)%t.value);throw new TypeError("not a number")}function cp(e,t){if(v(e)&&v(t))return a(e.value&t.value);throw new TypeError("not a number")}function Np(e,t){if(v(e)&&v(t))return a(e.value|t.value);throw new TypeError("not a number")}function mp(e,t){if(v(e)&&v(t))return a(e.value^t.value);throw new TypeError("not a number")}function fp(e){if(v(e))return a(~e.value);throw new TypeError("not a number")}function Ap(e,t){if(v(e)&&v(t))return a(e.value<<t.value);throw new TypeError("not a number")}function vp(e,t){if(v(e)&&v(t))return a(e.value>>t.value);throw new TypeError("not a number")}function hp(e,t){if(v(e)&&v(t))return a(e.value>>>t.value);throw new TypeError("not a number")}function xp(e){return c(!e.value)}function bp(...e){n(e.length,2);let t=te(e[0],e[1]);return c(!t.value)}function gp(...e){A(e.length,1,2),u(e[0]);let t="postfix";if(e[1]!==void 0){if(y(e[1]),e[1].value!=="prefix"&&e[1].value!=="postfix")throw new TypeError(`Invalid affix ${String(e[1].value)}. The affix must be "prefix" or "postfix"`);t=e[1].value}if(t==="postfix")return m([a(e[0].value+1),a(e[0].value)]);if(t==="prefix")return m([a(e[0].value+1),a(e[0].value+1)]);throw new Error("Unhandled error in decrement")}function Sp(...e){A(e.length,1,2),u(e[0]);let t="postfix";if(e[1]!==void 0){if(y(e[1]),e[1].value!=="prefix"&&e[1].value!=="postfix")throw new TypeError(`Invalid affix ${String(e[1].value)}. The affix must be "prefix" or "postfix"`);t=e[1].value}if(t==="postfix")return m([a(e[0].value-1),a(e[0].value)]);if(t==="prefix")return m([a(e[0].value-1),a(e[0].value-1)]);throw new Error("Unhandled error in decrement")}function wp(...e){n(e.length,2),N(e[0]),y(e[1]);let t=typeof e[0].value;if(t!=="bigint"&&t!=="boolean"&&t!=="function"&&t!=="number"&&t!=="object"&&t!=="string"&&t!=="symbol"&&t!=="undefined")throw new Error(`Invalid type: "${e[1].value}". Type must be one of bigint, boolean, function, number, object, string, symbol, or undefined`);return c(t===e[1].value)}function Cp(...e){n(e.length,2),N(e[0]),y(e[1]);let t=e[0],o=e[1].value,s;if(o==="AstNode"||o==="AtomNode"||o==="BooleanNode"||o==="ErrorNode"||o==="FunctionNode"||o==="KeywordNode"||o==="ListNode"||o==="MapNode"||o==="NilNode"||o==="NumberNode"||o==="StringNode"||o==="SymbolNode"||o==="VectorNode")s=V[e[1].value];else if(Object.hasOwn(globalThis,e[1].value))s=globalThis[e[1].value];else throw new TypeError(`Unknown instance: "${e[1].value}"`);return c(t instanceof s)}function Mp(e,t){return e.value==null?t:e}function Ep(e,t){if(v(e)&&v(t))return a(e.value**t.value);throw new TypeError("not a number")}var ys=[["RegExp.new",Tp],["RegExp.prototype.exec",Vp],["RegExp.prototype.test",Fp]];function Tp(...e){A(e.length,1,2),y(e[0]);let t=e[0].value;if(e.length===2){y(e[1]);let s=e[1].value,r=new RegExp(t,s);return re(r)}let o=new RegExp(t);return re(o)}function Vp(...e){n(e.length,2),W(e[0]);let t=e[0].value;ne(t),y(e[1]);let o=e[1].value,s=t.exec(o);return s?m(s.map(p)):f()}function Fp(...e){n(e.length,2),W(e[0]),ne(e[0].value),y(e[1]);let t=e[0].value.test(e[1].value);return c(t)}var cs=[["String",pe.printUnescapedString],["String.fromCharCode",Dp],["String.fromCodePoint",Lp],["String.prototype.at",ls],["String.prototype.charAt",ls],["String.prototype.charCodeAt",ds],["String.prototype.codePointAt",ds],["String.prototype.concat",Ip],["String.prototype.endsWith",kp],["String.prototype.includes",Rp],["String.prototype.indexOf",Up],["String.prototype.isWellFormed",qp],["String.prototype.lastIndexOf",Bp],["String.prototype.length",Kp],["String.prototype.localeCompare",$p],["String.prototype.match",jp],["String.prototype.matchAll",Op],["String.prototype.normalize",Wp],["String.prototype.padEnd",_p],["String.prototype.padStart",Pp],["String.prototype.repeat",Gp],["String.prototype.replace",zp],["String.prototype.replaceAll",Qp],["String.prototype.search",Jp],["String.prototype.slice",Yp],["String.prototype.split",Hp],["String.prototype.startsWith",Xp],["String.prototype.toLocaleLowerCase",Zp],["String.prototype.toLocaleUpperCase",ei],["String.prototype.toLowerCase",ti],["String.prototype.toUpperCase",oi],["String.prototype.toWellFormed",si],["String.prototype.trim",ni],["String.prototype.trimEnd",ri],["String.prototype.trimStart",ui],["String.raw",pi]];function Dp(...e){n(e.length,1),h(e[0]),X(e[0].value,ee);let t=e[0].value.map(ye),o=String.fromCharCode(...t);return d(o)}function Lp(...e){X(e,ee);let t=e.map(ye),o=String.fromCodePoint(...t);return d(o)}function ls(...e){n(e.length,2),y(e[0]),u(e[1]);let t=String.prototype.at.call(e[0].value,e[1].value);return t===void 0?f():d(t)}function ds(...e){n(e.length,2),y(e[0]),u(e[1]);let t=String.prototype.codePointAt.call(e[0].value,e[1].value);return t===void 0?f():a(t)}function Ip(...e){T(e.length,2),X(e,de);let t=e[0].value,o=e.slice(1).map(be),s=String.prototype.concat.call(t,...o);return d(s)}function kp(...e){A(e.length,2,3),y(e[0]),y(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.endsWith.call(t,o,s);return p(r)}function Rp(...e){A(e.length,2,3),y(e[0]),y(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.includes.call(t,o,s);return p(r)}function Up(...e){A(e.length,2,3),y(e[0]),y(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.indexOf.call(t,o,s);return p(r)}function qp(...e){n(e.length,1),y(e[0]);let t=e[0].value,o=String.prototype.isWellFormed.call(t);return p(o)}function Bp(...e){A(e.length,2,3),y(e[0]),y(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.lastIndexOf.call(t,o,s);return p(r)}function Kp(...e){n(e.length,1),N(e[0]);let o=e[0].value.length;return p(o)}function $p(...e){A(e.length,2,4),y(e[0]),y(e[1]);let t=e[0].value,o=e[1].value,s,r;if(e.length>2){let l=e[2];w(l)?s=l.value:D(l)?(X(l.value,de),s=l.value.map(be)):(tt(l),s=void 0)}if(e.length>3){let l=e[3];B(l),r=We(l)}let i=String.prototype.localeCompare.call(t,o,s,r);return p(i)}function jp(...e){n(e.length,2),y(e[0]),W(e[1]),ne(e[1].value);let t=e[0].value,o=e[1].value,s=String.prototype.match.call(t,o);return p(s)}function Op(...e){n(e.length,2),y(e[0]),W(e[1]),ne(e[1].value);let t=e[0].value,o=e[1].value,s=String.prototype.matchAll.call(t,o);return p(s)}function Wp(...e){A(e.length,1,2),N(e[0]),e.length===2&&y(e[1]);let t=e[0].value,o=e.length===2?e[1].value:void 0,s=String.prototype.normalize.call(t,o);return p(s)}function _p(...e){A(e.length,2,3),N(e[0]),u(e[1]),e.length===3&&y(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.padEnd.call(t,o,s);return p(r)}function Pp(...e){A(e.length,2,3),N(e[0]),u(e[1]),e.length===3&&y(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=String.prototype.padStart.call(t,o,s);return p(r)}function Gp(...e){n(e.length,2),y(e[0]),u(e[1]);let t=e[0].value,o=e[1].value,s=String.prototype.repeat.call(t,o);return p(s)}function zp(...e){n(e.length,3),y(e[0]);let t="";w(e[1])||(W(e[1]),ne(e[1].value)),t=e[1].value;let o;if(w(e[2]))o=e[2].value;else throw new Error("Function replacers are not implemented for String.prototype.replace");let r=e[0].value.replace(t,o);return p(r)}function Qp(...e){n(e.length,3),y(e[0]);let t="";w(e[1])||(W(e[1]),ne(e[1].value)),t=e[1].value;let o;if(w(e[2]))o=e[2].value;else throw new Error("Function replacers are not implemented for String.prototype.replaceAll");let r=e[0].value.replaceAll(t,o);return p(r)}function Jp(...e){n(e.length,2),y(e[0]),W(e[1]),ne(e[1].value);let t=e[0].value,o=e[1].value,s=String.prototype.search.call(t,o);return p(s)}function Yp(...e){A(e.length,1,3),N(e[0]),e.length>1&&u(e[1]),e.length>2&&u(e[2]);let t=e[0].value,o=e.length>1?e[1].value:void 0,s=e.length>2?e[2].value:void 0,r=String.prototype.slice.call(t,o,s);return p(r)}function Hp(...e){A(e.length,2,3),y(e[0]),y(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length===3?e[2].value:void 0,r=t.split(o,s);return p(r)}function Xp(...e){A(e.length,2,3),N(e[0]),y(e[1]),e.length===3&&u(e[2]);let t=e[0].value,o=e[1].value,s=e.length>2?e[2].value:void 0,r=String.prototype.startsWith.call(t,o,s);return p(r)}function Zp(...e){A(e.length,1,2),N(e[0]),e.length===2&&(E(e[1])||y(e[1]));let t=e[0].value,o=e.length===2&&!E(e[1])?e[1].value:void 0,s=String.prototype.toLocaleLowerCase.call(t,o);return p(s)}function ei(...e){A(e.length,1,2),N(e[0]),e.length===2&&(E(e[1])||y(e[1]));let t=e[0].value,o=e.length===2&&!E(e[1])?e[1].value:void 0,s=String.prototype.toLocaleUpperCase.call(t,o);return p(s)}function ti(...e){n(e.length,1),N(e[0]);let t=e[0].value,o=String.prototype.toLowerCase.call(t);return p(o)}function oi(...e){n(e.length,1),N(e[0]);let t=e[0].value,o=String.prototype.toUpperCase.call(t);return p(o)}function si(...e){n(e.length,1),N(e[0]);let t=e[0].value,o=String.prototype.toWellFormed.call(t);return p(o)}function ni(...e){n(e.length,1),N(e[0]);let t=e[0].value,o=String.prototype.trim.call(t);return p(o)}function ri(...e){n(e.length,1),N(e[0]);let t=e[0].value,o=String.prototype.trimEnd.call(t);return p(o)}function ui(...e){n(e.length,1),N(e[0]);let t=e[0].value,o=String.prototype.trimStart.call(t);return p(o)}function pi(...e){n(e.length,2),B(e[0]),h(e[1]);let t=We(e[0]),o=e[1].value,s=String.raw(t,...o);return p(s)}var Ns=[["Symbol",ii],["Symbol.for",ai],["Symbol.keyFor",yi]];function ii(...e){A(e.length,0,1),e.length===1&&y(e[0]);let t=e.length===1?e[0].value:void 0,o=Symbol(t);return re(o)}function ai(...e){n(e.length,1),y(e[0]);let t=e[0].value,o=Symbol.for(t);return re(o)}function yi(...e){n(e.length,1),W(e[0]),ot(e[0].value);let t=e[0].value,o=Symbol.keyFor(t);return o?d(o):f()}var li=[...Xo,...Zo,...es,...as,...ts,...os,...ns,...rs,...ps,...is,...ys,...cs,...Ns],Pe=new Map;for(let[e,t]of li)if(Pe.set(S(e),R(t)),e.includes(".prototype.")){let o=e.replace(".prototype.","::");Pe.set(S(o),R(t))}else if(e.includes(".prototype[")){let o=e.replace(".prototype[","::[");Pe.set(S(o),R(t))}function di(e){_(e),A(e.value.length,2,3);let t=e.value[0];if(K(t),t.value!=="try"&&t.value!=="try*")throw new Error("use `try` or `try*` in try/catch expressions");if(N(e.value[1]),e.value[2]){_(e.value[2]),n(e.value[2].value.length,3),K(e.value[2].value[0]);let o=e.value[2].value[0];if(o.value!=="catch"&&o.value!=="catch*")throw new Error("use `catch` or `catch*` in try/catch expressions");K(e.value[2].value[1]),N(e.value[2].value[2])}}function ci(e){_(e),n(e.value.length,3),K(e.value[0]);let t=e.value[0];if(t.value!=="def!"&&t.value!=="globalThis"&&t.value!=="var")throw new Error("use `def!`, `globalThis`, or `var` in def! expressions");$(e.value[1]),N(e.value[2])}function Ni(e){_(e),n(e.value.length,3),K(e.value[0]);let t=e.value[0];if(t.value!=="let*"&&t.value!=="let"&&t.value!=="const")throw new Error("use `let*`, `let`, or `const` in let* expressions");H(e.value[1]),N(e.value[2]),xe(e.value[1].value.length);for(let o=0;o<e.value[1].value.length;o+=2)K(e.value[1].value[o]),N(e.value[1].value[o+1])}function mi(e){_(e),n(e.value.length,2),K(e.value[0]),Ne(e.value[0],"quote"),N(e.value[1])}function fi(e){let t="quasiquoteexpand";_(e),n(e.value.length,2),K(e.value[0]),Ne(e.value[0],t),N(e.value[1])}function Ai(e){let t="quasiquote";_(e),n(e.value.length,2),K(e.value[0]),Ne(e.value[0],t),N(e.value[1])}function vi(e){let t="defmacro!";_(e),n(e.value.length,3),K(e.value[0]),Ne(e.value[0],t),$(e.value[1]),N(e.value[2])}function hi(e){let t="do";_(e),T(e.value.length,1),K(e.value[0]),Ne(e.value[0],t);for(let o of e.value.slice(1))N(o)}function xi(e){let t="if";_(e),A(e.value.length,3,4),K(e.value[0]),Ne(e.value[0],t),N(e.value[1]),N(e.value[2]),Se(e.value[3])&&N(e.value[3])}function bi(e){_(e),n(e.value.length,3),K(e.value[0]);let t=e.value[0];if(!["fn*","function","=>"].includes(t.value))throw new Error("use `fn*`, `function`, of `=>` in fn* expressions");H(e.value[1]),X(e.value[1].value,le),N(e.value[2])}function gi(e){return Xe(e)}function lt(e){if(g(e)||I(e))return b([S("quote"),e]);if(!q(e))return e;if(ze(e,"unquote"))return e.value[1];let s=b([]);for(let r=e.value.length-1;r>=0;r--){let i=e.value[r];s=ze(i,"splice-unquote")?b([S("concat"),i.value[1],s]):b([S("cons"),lt(i),s])}return D(e)&&(s=b([S("vec"),s])),s}function Si(e,t){if(!M(e)||!(e.value[0]instanceof le))return!1;let o=e.value[0],s=t.findEnv(o);if(!Se(s))return!1;let r=s.get(o);return U(r)?r.isMacro:!1}function fs(e,t){let o=e;for(;Si(o,t);){let s=o,r=s.value[0];o=t.get(r).value(...s.value.slice(1))}return o}function yt(e,t){if(I(e))return t.get(e);if(D(e)){let o=e.value.map(s=>Q(s,t));return m(o)}if(M(e)){let o=e.value.map(s=>Q(s,t));return b(o)}if(g(e)){let o=new Map;for(let[s,r]of e.value.entries())o.set(s,Q(r,t));return F(o)}if(oe(e)){let o=e.value,s=Array.from(e.attributes).reduce((i,[l,x])=>i.set(l,Q(x,t)),new Map),r=e.children.map(i=>Q(i,t));return he(o,s,r)}return e}function Q(e,t){for(;;){if(M(e)===!1)return yt(e,t);if(e.value.length===0)return e;if(e=fs(e,t),M(e)===!1)return yt(e,t);if(e.value.length===0)return e;let o=I(e.value[0])?e.value[0].value:"goto_default_clause",s;switch(o){case"var":case"def!":{s=wi(e,t);break}case"let":case"const":case"let*":{s=Ci(e,t);break}case"quote":{s=Mi(e,t);break}case"quasiquoteexpand":{s=Ei(e,t);break}case"quasiquote":{s=Ti(e,t);break}case"defmacro!":{s=Vi(e,t);break}case"macroexpand":{s=ae(fs(e.value[1],t));break}case"try":case"try*":{s=Di(e,t);break}case"do":{s=Fi(e,t);break}case"if":{s=Li(e,t);break}case"=>":case"function":case"fn*":{s=Ii(e,t);break}default:s=ki(e,t)}if(s.return)return s.return;e=s.continue.ast,t=s.continue.env}}function wi(e,t){ci(e);let o=e.value[1],s=e.value[2],r=Q(s,t);return ae(t.set(o,r))}function Ci(e,t){Ni(e);let o=e.value[1],s=o.value.length,r=new ue(t);for(let i=0;i<s;i+=2){let l=o.value[i],x=o.value[i+1],L=Q(x,r);r.set(l,L)}return we(e.value[2],r)}function Mi(e,t){return mi(e),ae(e.value[1])}function Ei(e,t){return fi(e),ae(lt(e.value[1]))}function Ti(e,t){Ai(e);let o=lt(e.value[1]);return we(o,t)}function Vi(e,t){vi(e);let o=e.value[1],s=e.value[2],r=Q(s,t),i=O(r);return U(i)&&(i.isMacro=!0),ae(t.set(o,i))}function Fi(e,t){hi(e);let o=f();for(let s=1;s<e.value.length;s++)o=Q(e.value[s],t);return{continue:{ast:o,env:t},return:void 0}}function Di(e,t){di(e);try{return{return:Q(e.value[1],t),continue:void 0}}catch(o){if(!e.value[2])throw o;let s=e.value[2].value[1],r=e.value[2].value[2],i;Y(o)?i=o:o instanceof Error?i=d(o.message):i=d(JSON.stringify(o));let l=k(i),x=new ue(t,[s],[l]);return{return:Q(r,x),continue:void 0}}}function Li(e,t){xi(e);let o=e.value[1],s=Q(o,t);if(s.value!==!1&&s.value!==null){let r=e.value[2];return we(r,t)}if(e.value[3]!==void 0){let r=e.value[3];return we(r,t)}return ae(f())}function Ii(e,t){bi(e);let o=e.value[1].value,s=e.value[2],r=t,l=R((...x)=>{let L=new ue(r,o,x);return Q(s,L)},{ast:s,env:r,parameters:o});return ae(l)}function ki(e,t){let o=yt(e,t);_(o);let s=o.value[0];if(U(s)){let r=o.value.slice(1);if(s.closureMeta){let l=s.closureMeta.ast,x=new ue(s.closureMeta.env,s.closureMeta.parameters,r);return{continue:{ast:l,env:x},return:void 0}}return{return:s.value(...r),continue:void 0}}return{return:s,continue:void 0}}function Ri(e){return j(e,!0)}function me(e,t){return Ri(Q(gi(e),t))}function As(){let e=new ue(void 0);for(let[t,o]of pe.ns.entries())e.set(t,o);for(let[t,o]of Pe.entries())e.set(t,o);for(let[t,o]of Ze.entries())e.set(t,o);return e.set(S("eval"),R((...t)=>(n(t.length,1),Q(t[0],e)))),e.set(S("dump"),R((...t)=>{let o=e.serialize();return console.log(j(o,!0)),f()})),me("(def! not (fn* (a) (if a false true)))",e),me(`(defmacro! cond
      (fn* (& xs)
       (if (> (count xs) 0) (list 'if (first xs)
                                  (if (> (count xs) 1) (nth xs 1)
                                      (throw "odd number of forms to cond"))
                                  (cons 'cond (rest (rest xs)))))))`,e),e}var hs="user> ";function xs(e,t){let o=null;try{o=ie.open(t,"w"),o!==null&&o.puts(e)}catch(s){throw o!==null&&o.close(),new Error(`Error writing to file: ${s}`)}}function dt(...e){n(e.length,1);let t=e[0];y(t);let o=gs(t.value);return o==null?f():d(o)}function bs(...e){n(e.length,1),y(e[0]);let t=[],[o,s]=vs.readdir(e[0].value);if(+s>0)throw new Error(`Error reading directory: ${s}`);for(let r of o)r==="."||r===".."||t.push(d(r));return m(t)}function et(...e){n(e.length,1);let t=e[0];y(t);let o=ie.loadFile(t.value);if(o===null)throw new Error("No such file or directory. xxx");return d(o)}function ct(...e){n(e.length,2);let t=e[0];y(t);let o=e[1];return y(o),xs(o.value,t.value),f()}function gs(e=hs){ie.out.puts(e);let t=ie.in.getline()?.trim();console.log(t),console.log(e)}function*Ss(e=hs){for(;;){ie.out.puts(e);let t=ie.in.getline()?.trim();t&&(yield t)}}function ws(e){return function(...o){n(o.length,1),y(o[0]);let s=et(o[0]);y(s);let r=new ue(e),i=me(`(do ${s.value})
nil`,r);return d(i)}}function Cs(){let e=As(),t=ws(e),o=[["readFile",et],["slurp",et],["load-file",t],["import",t],["readln",dt],["prompt",dt],["readir",bs],["spit",ct],["writeFile",ct]];for(let[s,r]of o)e.set(S(s),R(r));return e}function Ms(e=""){return e.replace(/\\/g,"/")}async function Ui(...e){let t=Cs(),o=Ms(e[0]),s=e.slice(1).map(r=>d(r));if(t.set(S("*ARGV*"),b(s)),t.set(S("*host-language*"),d("Ensemble")),o){me(`(import "${o}")`,t);return}me('(println (str "Welcome to " *host-language* "! Press Ctrl/Cmd+C to exit."))',t);for await(let r of Ss("user> "))if(!(r===""||r===null))try{let i=me(r,t);console.log(i)}catch(i){Y(i)?console.log(`error: ${j(i,!1)}`):i instanceof Error&&console.log(i)}}var Es={displayPrompt:gs,initMain:Cs,loadFileWithEnv:ws,main:Ui,readir:bs,readline:Ss,readln:dt,rep:me,slurp:et,spit:ct,toPosixPath:Ms,writeToFile:xs};Es.main(...scriptArgs);
